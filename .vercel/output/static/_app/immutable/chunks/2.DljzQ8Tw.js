import{r as Vt,T as js,H as Dr,s as Ge,e as O,d as G,t as Ee,f as A,h as B,l as J,j as Se,k as T,y,U as Oe,z as pe,m as W,o as _,p as Pe,n as $e,V as ge,W as ye,F as Et,q as Q,X as de,Y as se,Z as Lr,_ as Rs,$ as gr,a0 as Ur,A as mr,x as Nr,v as wt}from"./scheduler.B_M5xA-k.js";import{a as le,t as Z,S as Je,i as Ke,b as We,d as Xe,m as Ye,g as Be,c as qe,f as gs,e as Qe,h as bt,j as pr}from"./index.8At0uzev.js";import{_ as lt}from"./preload-helper.D6kgxu3v.js";import{r as Mr,d as Br,w as xe}from"./index.DfSpG__o.js";function Re(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Wt(r,e){le(r,1,1,()=>{e.delete(r.key)})}function Xt(r,e,t,s,i,n,a,o,l,c,u,h){let d=r.length,f=n.length,m=d;const p={};for(;m--;)p[r[m].key]=m;const v=[],D=new Map,S=new Map,j=[];for(m=f;m--;){const g=h(i,n,m),w=t(g);let b=a.get(w);b?s&&j.push(()=>b.p(g,e)):(b=c(w,g),b.c()),D.set(w,v[m]=b),w in p&&S.set(w,Math.abs(m-p[w]))}const I=new Set,U=new Set;function P(g){Z(g,1),g.m(o,u),a.set(g.key,g),u=g.first,f--}for(;d&&f;){const g=v[f-1],w=r[d-1],b=g.key,L=w.key;g===w?(u=g.first,d--,f--):D.has(L)?!a.has(b)||I.has(b)?P(g):U.has(L)?d--:S.get(b)>S.get(L)?(U.add(b),P(g)):(I.add(L),d--):(l(w,a),d--)}for(;d--;){const g=r[d];D.has(g.key)||l(g,a)}for(;f;)P(v[f-1]);return Vt(j),v}async function qr(){}const Fr=!0,Sa=Object.freeze(Object.defineProperty({__proto__:null,load:qr,prerender:Fr},Symbol.toStringTag,{value:"Module"})),Hr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class ms extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Vr extends ms{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zr extends ms{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Gr extends ms{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var as;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(as||(as={}));var Jr=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Kr{constructor(e,{headers:t={},customFetch:s,region:i=as.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Hr(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Jr(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:a}=t;let o={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(o["x-region"]=l);let c;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=a):typeof a=="string"?(o["Content-Type"]="text/plain",c=a):typeof FormData<"u"&&a instanceof FormData?c=a:(o["Content-Type"]="application/json",c=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:c}).catch(m=>{throw new Vr(m)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new zr(u);if(!u.ok)throw new Gr(u);let d=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield u.json():d==="application/octet-stream"?f=yield u.blob():d==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(i){return{data:null,error:i}}})}}var Wr=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},kt=Wr();const Xr=kt.fetch,ps=kt.fetch.bind(kt),_r=kt.Headers,Yr=kt.Request,Qr=kt.Response,$t=Object.freeze(Object.defineProperty({__proto__:null,Headers:_r,Request:Yr,Response:Qr,default:ps,fetch:Xr},Symbol.toStringTag,{value:"Module"}));class Zr extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class en{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ps:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var a,o,l;let c=null,u=null,h=null,d=n.status,f=n.statusText;if(n.ok){if(this.method!=="HEAD"){const D=await n.text();D===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=D:u=JSON.parse(D))}const p=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),v=(o=n.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");p&&v&&v.length>1&&(h=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const p=await n.text();try{c=JSON.parse(p),Array.isArray(c)&&n.status===404&&(u=[],c=null,d=200,f="OK")}catch{n.status===404&&p===""?(d=204,f="No Content"):c={message:p}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,f="OK"),c&&this.shouldThrowOnError)throw new Zr(c)}return{error:c,data:u,count:h,status:d,statusText:f}});return this.shouldThrowOnError||(i=i.catch(n=>{var a,o,l;return{error:{message:`${(a=n==null?void 0:n.name)!==null&&a!==void 0?a:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(o=n==null?void 0:n.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}}class tn extends en{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:n=i}={}){const a=n?`${n}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const n=typeof i>"u"?"offset":`${i}.offset`,a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:n=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${l};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class pt extends tn{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}class sn{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let n=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new pt({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new pt({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:n=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new pt({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new pt({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new pt({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const rn="1.15.1",nn={"X-Client-Info":`postgrest-js/${rn}`};class _s{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},nn),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new sn(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new _s(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:n}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let l;s?(a="HEAD",Object.entries(t).filter(([u,h])=>h!==void 0).forEach(([u,h])=>{o.searchParams.append(u,`${h}`)})):i?(a="GET",Object.entries(t).filter(([u,h])=>h!==void 0).forEach(([u,h])=>{o.searchParams.append(u,`${h}`)})):(a="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new pt({method:a,url:o,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const an="2.9.3",on={"X-Client-Info":`realtime-js/${an}`},ln="1.0.0",vr=1e4,cn=1e3;var vt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(vt||(vt={}));var Ce;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ce||(Ce={}));var je;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(je||(je={}));var os;(function(r){r.websocket="websocket"})(os||(os={}));var nt;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(nt||(nt={}));class yr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class un{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+i));a=a+i;const l=s.decode(e.slice(a,a+n));a=a+n;const c=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class Yt{constructor(e,t,s={},i=vr){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var $s;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})($s||($s={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,i,n,a),this.pendingDiffs.forEach(l=>{this.state=Ot.syncDiff(this.state,l,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ot.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(n,(c,u)=>{a[c]||(l[c]=u)}),this.map(a,(c,u)=>{const h=n[c];if(h){const d=u.map(v=>v.presence_ref),f=h.map(v=>v.presence_ref),m=u.filter(v=>f.indexOf(v.presence_ref)<0),p=h.filter(v=>d.indexOf(v.presence_ref)<0);m.length>0&&(o[c]=m),p.length>0&&(l[c]=p)}else o[c]=u}),this.syncDiff(n,{joins:o,leaves:l},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(o,l)=>{var c;const u=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),u.length>0){const h=e[o].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[o].unshift(...d)}s(o,u,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=c,i(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var re;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(re||(re={}));const xs=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,a)=>(n[a]=hn(a,r,e,i),n),{})},hn=(r,e,t,s)=>{const i=e.find(o=>o.name===r),n=i==null?void 0:i.type,a=t[r];return n&&!s.includes(n)?wr(n,a):ls(a)},wr=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return mn(e,t)}switch(r){case re.bool:return dn(e);case re.float4:case re.float8:case re.int2:case re.int4:case re.int8:case re.numeric:case re.oid:return fn(e);case re.json:case re.jsonb:return gn(e);case re.timestamp:return pn(e);case re.abstime:case re.date:case re.daterange:case re.int4range:case re.int8range:case re.money:case re.reltime:case re.text:case re.time:case re.timestamptz:case re.timetz:case re.tsrange:case re.tstzrange:return ls(e);default:return ls(e)}},ls=r=>r,dn=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},fn=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},gn=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},mn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>wr(e,o))}return r},pn=r=>typeof r=="string"?r.replace(" ","T"):r;var Ds;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ds||(Ds={}));var Ls;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(Ls||(Ls={}));var Us;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Us||(Us={}));class vs{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Yt(this,je.join,this.params,this.timeout),this.rejoinTimer=new yr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ce.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ce.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this._on(je.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new Ot(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const o={},l={broadcast:n,presence:a,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&i!==void 0?i:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,d=(u=h==null?void 0:h.length)!==null&&u!==void 0?u:0,f=[];for(let m=0;m<d;m++){const p=h[m],{filter:{event:v,schema:D,table:S,filter:j}}=p,I=c&&c[m];if(I&&I.event===v&&I.schema===D&&I.table===S&&I.filter===j)f.push(Object.assign(Object.assign({},p),{id:I.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,o={method:"POST",headers:{apikey:(s=this.socket.apiKey)!==null&&s!==void 0?s:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=t.timeout)!==null&&i!==void 0?i:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ce.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(je.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const i=new Yt(this,je.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Yt(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:u}=je;if(s&&[o,l,c,u].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var m,p,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(p=f.filter)===null||p===void 0?void 0:p.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(f=>f.callback(d,s)):(n=this.bindings[a])===null||n===void 0||n.filter(f=>{var m,p,v,D,S,j;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const I=f.id,U=(m=f.filter)===null||m===void 0?void 0:m.event;return I&&((p=t.ids)===null||p===void 0?void 0:p.includes(I))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const I=(S=(D=f==null?void 0:f.filter)===null||D===void 0?void 0:D.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return I==="*"||I===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof d=="object"&&"ids"in d){const m=d.data,{schema:p,table:v,commit_timestamp:D,type:S,errors:j}=m;d=Object.assign(Object.assign({},{schema:p,table:v,commit_timestamp:D,eventType:S,new:{},old:{},errors:j}),this._getPayloadRecords(m))}f.callback(d,s)})}_isClosed(){return this.state===Ce.closed}_isJoined(){return this.state===Ce.joined}_isJoining(){return this.state===Ce.joining}_isLeaving(){return this.state===Ce.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&vs.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(je.close,{},e)}_onError(e){this._on(je.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ce.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=xs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=xs(e.columns,e.old_record)),t}}const _n=()=>{},vn=typeof WebSocket<"u";class yn{constructor(e,t){var s;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=on,this.params={},this.timeout=vr,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=_n,this.conn=null,this.sendBuffer=[],this.serializer=new un,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:l})=>l(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${os.websocket}`,t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new yr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(vn){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new wn(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),lt(()=>import("./browser.DS6YmIL9.js").then(e=>e.b),[],import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case vt.connecting:return nt.Connecting;case vt.open:return nt.Open;case vt.closing:return nt.Closing;default:return nt.Closed}}isConnected(){return this.connectionState()===nt.Open}channel(e,t={config:{}}){const s=new vs(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(je.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ln}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:n,ref:a}=t;(a&&a===this.pendingHeartbeatRef||i===(n==null?void 0:n.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${i} ${a&&"("+a+")"||""}`,n),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(i,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(je.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(cn,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class wn{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=vt.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ys extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function we(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class bn extends ys{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ns extends ys{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var kn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const br=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},En=()=>kn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url)).Response:Response});var St=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const Qt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Sn=(r,e)=>St(void 0,void 0,void 0,function*(){const t=yield En();r instanceof t?r.json().then(s=>{e(new bn(Qt(s),r.status||500))}).catch(s=>{e(new Ns(Qt(s),s))}):e(new Ns(Qt(r),r))}),Tn=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};function zt(r,e,t,s,i,n){return St(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Tn(e,s,i,n)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>Sn(l,o))})})}function cs(r,e,t,s){return St(this,void 0,void 0,function*(){return zt(r,"GET",e,t,s)})}function Ve(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"POST",e,s,i,t)})}function Cn(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"PUT",e,s,i,t)})}function kr(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"DELETE",e,s,i,t)})}var Ae=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const Pn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ms={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class On{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=br(i)}uploadOrUpdate(e,t,s,i){return Ae(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Ms),i),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",a.cacheControl)):(n=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),h=yield u.json();return u.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(n){if(we(n))return{data:null,error:n};throw n}})}upload(e,t,s){return Ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return Ae(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Ms.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",c.cacheControl)):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:u}),d=yield h.json();return h.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(we(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return Ae(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const s=yield Ve(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),i=new URL(this.url+s.url),n=i.searchParams.get("token");if(!n)throw new ys("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}update(e,t,s){return Ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}copy(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:{path:(yield Ve(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,s){return Ae(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield Ve(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if(we(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return Ae(this,void 0,void 0,function*(){try{const i=yield Ve(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(we(i))return{data:null,error:i};throw i}})}download(e,t){return Ae(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield cs(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(we(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${c}`)}}}remove(e){return Ae(this,void 0,void 0,function*(){try{return{data:yield kr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}list(e,t,s){return Ae(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Pn),t),{prefix:e||""});return{data:yield Ve(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(we(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const An="2.5.5",In={"X-Client-Info":`storage-js/${An}`};var dt=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class jn{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},In),t),this.fetch=br(s)}listBuckets(){return dt(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(we(e))return{data:null,error:e};throw e}})}getBucket(e){return dt(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return dt(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return dt(this,void 0,void 0,function*(){try{return{data:yield Cn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}emptyBucket(e){return dt(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}deleteBucket(e){return dt(this,void 0,void 0,function*(){try{return{data:yield kr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}}class Rn extends jn{constructor(e,t={},s){super(e,t,s)}from(e){return new On(this.url,this.headers,e,this.fetch)}}const $n="2.42.1";let Ct="";typeof Deno<"u"?Ct="deno":typeof document<"u"?Ct="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ct="react-native":Ct="node";const xn={"X-Client-Info":`supabase-js-${Ct}/${$n}`},Dn={headers:xn},Ln={schema:"public"},Un={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Nn={};var Mn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const Bn=r=>{let e;return r?e=r:typeof fetch>"u"?e=ps:e=fetch,(...t)=>e(...t)},qn=()=>typeof Headers>"u"?_r:Headers,Fn=(r,e,t)=>{const s=Bn(t),i=qn();return(n,a)=>Mn(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:r;let c=new i(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(n,Object.assign(Object.assign({},a),{headers:c}))})};function Hn(r){return r.replace(/\/$/,"")}function Vn(r,e){const{db:t,auth:s,realtime:i,global:n}=r,{db:a,auth:o,realtime:l,global:c}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),n)}}const Er="2.63.0",zn="http://localhost:9999",Gn="supabase.auth.token",Jn={"X-Client-Info":`gotrue-js/${Er}`},Bs=10,us="X-Supabase-Api-Version",Sr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Kn(r){return Math.round(Date.now()/1e3)+r}function Wn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Ie=()=>typeof document<"u",st={tested:!1,writable:!1},At=()=>{if(!Ie())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(st.tested)return st.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),st.tested=!0,st.writable=!0}catch{st.tested=!0,st.writable=!1}return st.writable};function Zt(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const Tr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Xn=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Cr=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Bt=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},es=async(r,e)=>{await r.removeItem(e)};function Yn(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,i,n,a,o,l,c,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)a=e.indexOf(r.charAt(u++)),o=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),s=a<<2|o>>4,i=(o&15)<<4|l>>2,n=(l&3)<<6|c,t=t+String.fromCharCode(s),l!=64&&i!=0&&(t=t+String.fromCharCode(i)),c!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class Gt{constructor(){this.promise=new Gt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Gt.promiseConstructor=Promise;function qs(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(Yn(s))}async function Qn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Zn(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){s(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function ei(r){return("0"+r.toString(16)).substr(-2)}function ti(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,ei).join("")}async function si(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}function ri(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ni(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await si(r);return ri(t)}async function ft(r,e,t=!1){const s=ti();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await Cr(r,`${e}-code-verifier`,i);const n=await ni(s);return[n,s===n?"plain":"s256"]}const ii=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ai(r){const e=r.headers.get(us);if(!e||!e.match(ii))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class ws extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function K(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class oi extends ws{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function li(r){return K(r)&&r.name==="AuthApiError"}class Pr extends ws{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ct extends ws{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class gt extends ct{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ts extends ct{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qt extends ct{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends ct{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Fs extends ct{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hs extends ct{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ss(r){return K(r)&&r.name==="AuthRetryableFetchError"}class Hs extends ct{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var ci=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};const rt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ui=[502,503,504];async function Vs(r){var e;if(!Xn(r))throw new hs(rt(r),0);if(ui.includes(r.status))throw new hs(rt(r),r.status);let t;try{t=await r.json()}catch(n){throw new Pr(rt(n),n)}let s;const i=ai(r);if(i&&i.getTime()>=Sr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Hs(rt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new Hs(rt(t),r.status,t.weak_password.reasons);throw new oi(rt(t),r.status||500,s)}const hi=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function X(r,e,t,s){var i;const n=Object.assign({},s==null?void 0:s.headers);n[us]||(n[us]=Sr["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const a=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await di(r,e,t+o,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function di(r,e,t,s,i,n){const a=hi(e,s,i,n);let o;try{o=await r(t,Object.assign(Object.assign({},a),{cache:"no-store"}))}catch(l){throw console.error(l),new hs(rt(l),0)}if(o.ok||await Vs(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(l){await Vs(l)}}function He(r){var e;let t=null;pi(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Kn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function zs(r){const e=He(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function ze(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function fi(r){return{data:r,error:null}}function gi(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,a=ci(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function mi(r){return r}function pi(r){return r.access_token&&r.refresh_token&&r.expires_in}var _i=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};class vi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Tr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await X(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await X(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ze})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=_i(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await X(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:gi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(K(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await X(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ze})}catch(t){if(K(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},u=await X(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:mi});if(u.error)throw u.error;const h=await u.json(),d=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(l=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=p}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(K(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await X(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ze})}catch(t){if(K(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await X(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ze})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await X(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ze})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await X(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(K(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await X(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(K(t))return{data:null,error:t};throw t}}}const yi={getItem:r=>At()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{At()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{At()&&globalThis.localStorage.removeItem(r)}};function Gs(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function wi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const mt={debug:!!(globalThis&&At()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Or extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bi extends Or{}async function ki(r,e,t){mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),mt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new bi(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(mt.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}wi();const Ei={url:zn,storageKey:Gn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Jn,flowType:"implicit",debug:!1},Tt=30*1e3,Js=3;async function Ks(r,e,t){return await t()}class jt{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.insecureGetSessionWarningShown=!1,this.instanceID=jt.nextInstanceID,jt.nextInstanceID+=1,this.instanceID>0&&Ie()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Ei),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new vi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Tr(i.fetch),this.lock=i.lock||Ks,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,i.lock?this.lock=i.lock:Ie()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ki:this.lock=Ks,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:At()?this.storage=yi:(this.memoryStorage={},this.storage=Gs(this.memoryStorage)):(this.memoryStorage={},this.storage=Gs(this.memoryStorage)),Ie()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Er}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=Ie()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),(s==null?void 0:s.message)==="Identity is already linked"||(s==null?void 0:s.message)==="Identity is already linked to another user"?{error:s}:(await this._removeSession(),{error:s});const{session:i,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return K(e)?{error:e}:{error:new Pr("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{await this._removeSession();const n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:He}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(K(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,i;try{await this._removeSession();let n;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await ft(this.storage,this.storageKey)),n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:m},xform:He})}else if("phone"in e){const{phone:u,password:h,options:d}=e;n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(i=d==null?void 0:d.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:He})}else throw new qt("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(K(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zs})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zs})}else throw new qt("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ts}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/"),{data:n,error:a}=await X(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:He});return await es(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new ts}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:s,token:i,access_token:n,nonce:a}=e,o=await X(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:He}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ts}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if(await this._removeSession(),"email"in e){const{email:o,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await ft(this.storage,this.storageKey));const{error:h}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:u}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new qt("You must provide either an email or phone number.")}catch(o){if(K(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await X(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:He});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(K(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{await this._removeSession();let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await ft(this.storage,this.storageKey)),await X(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:fi})}catch(n){if(K(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new gt;const{error:i}=await X(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(K(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:a}=await X(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:a,error:o}=await X(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new qt("You must provide either an email or phone number and a type")}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;const e=await this._acquireLock(-1,async()=>this._useSession(async t=>t));return e.data&&this.storage.isServer&&(this.insecureGetSessionWarningShown||(console.warn("Using supabase.auth.getSession() is potentially insecure as it loads data directly from the storage medium (typically cookies) which may not be authentic. Prefer using supabase.auth.getUser() instead. To suppress this warning call supabase.auth.getUser() before you call supabase.auth.getSession()."),this.insecureGetSessionWarningShown=!0)),e}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=e.user;delete e.user,Object.defineProperty(e,"user",{enumerable:!0,get:()=>(e.__suppressUserWarning||console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a),set:o=>{a=o}})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data&&this.storage.isServer&&(this.insecureGetSessionWarningShown=!0),t}async _getUser(e){try{return e?await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ze}):await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:ze})})}catch(t){if(K(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new gt;const a=i.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await ft(this.storage,this.storageKey));const{data:c,error:u}=await X(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:ze});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return qs(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new gt;const t=Date.now()/1e3;let s=t,i=!0,n=null;const a=qs(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(K(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new gt;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!Ie())throw new Ft("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Ft("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Fs("Not a valid PKCE flow url.");const t=Zt(window.location.href);if(e){if(!t.code)throw new Fs("No code detected.");const{data:S,error:j}=await this._exchangeCodeForSession(t.code);if(j)throw j;const I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:S.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ft(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=t;if(!n||!o||!a||!c)throw new Ft("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=Tt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const m=d-h;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,d,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,d,u);const{data:p,error:v}=await this._getUser(n);if(v)throw v;const D={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:h,expires_at:d,refresh_token:a,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:D,redirectType:t.type},error:null}}catch(t){if(K(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Zt(window.location.href);return!!(Ie()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Zt(window.location.href),t=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{error:n};const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(li(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(await this._removeSession(),await es(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Wn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await ft(this.storage,this.storageKey,!0));try{return await X(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(K(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(K(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var a,o,l,c,u;const{data:h,error:d}=n;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await X(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return Ie()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(K(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await X(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(K(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Zn(async i=>(await Qn(i*200),this._debug(t,"refreshing attempt",i),await X(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:He})),(i,n,a)=>a&&a.error&&ss(a.error)&&Date.now()+(i+1)*200-s<Tt)}catch(s){if(this._debug(t,"error",s),K(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Ie()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Bt(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<i+Bs;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Bs}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),ss(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new gt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Gt;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new gt;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),K(n)){const a={session:null,error:n};return ss(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await Cr(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await es(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ie()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Tt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/Tt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Tt}ms, refresh threshold is ${Js} ticks`),i<=Js&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Or)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ie()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,a]=await ft(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await X(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(K(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)return{data:null,error:a};const{data:o,error:l}=await X(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(!((i=o==null?void 0:o.totp)===null||i===void 0)&&i.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(K(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(K(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(K(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:s,totp:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(i.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}}jt.nextInstanceID=0;const Si=jt;class Ti extends Si{constructor(e){super(e)}}var Ci=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Pi{constructor(e,t,s){var i,n,a,o,l,c,u,h;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=Hn(e);this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const f=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,m={db:Ln,realtime:Nn,auth:Object.assign(Object.assign({},Un),{storageKey:f}),global:Dn},p=Vn(s??{},m);this.storageKey=(n=(i=p.auth)===null||i===void 0?void 0:i.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=(a=p.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((l=p.auth)!==null&&l!==void 0?l:{},this.headers,(c=p.global)===null||c===void 0?void 0:c.fetch),this.fetch=Fn(t,this._getAccessToken.bind(this),(u=p.global)===null||u===void 0?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new _s(`${d}/rest/v1`,{headers:this.headers,schema:(h=p.db)===null||h===void 0?void 0:h.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Kr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Rn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ci(this,void 0,void 0,function*(){const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:n,flowType:a,debug:o},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ti({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,debug:o,fetch:c})}_initRealtimeClient(e){return new yn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Oi=(r,e,t)=>new Pi(r,e,t),Ai="https://wypbvklzgwgrjmlnmfzg.supabase.co",Ii="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind5cGJ2a2x6Z3dncmptbG5tZnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI4NTY5MzcsImV4cCI6MjAyODQzMjkzN30.NCndBtOFVDpXc4GgbWIlEFsmBlH_p1OILPDv-RnitpU",he=Oi(Ai,Ii),ot=xe(),it=xe([]),Pt=xe([]),_t=xe([]),at=xe([]),Ar=Mr({maxTeams:4,maxChallenges:25,pointDecrement:1,maxPointDecrement:2}),yt=xe(null),rs=xe(null),Me=xe(!1),It=xe(!1),Ws=xe(!1),ji=Br([it,Pt,_t,Ar],([r,e,t,s])=>r.map(i=>({team:i.id,points:t.filter(n=>n.team===i.id).map(n=>n.challenge).map(n=>e.find(a=>a.id===n).points-s.pointDecrement*(e.find(a=>a.id===n).type==="main"?1:0)*Math.min(t.filter(a=>a.challenge===n).sort((a,o)=>a.created_at-o.created_at).findIndex(a=>a.team===i.id),s.maxPointDecrement)).reduce((n,a)=>n+a,0)})).sort((i,n)=>n.points-i.points));function Ir(r){const e=r-1;return e*e*e+1}function Ht(r,{delay:e=0,duration:t=400,easing:s=Dr}={}){const i=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:s,css:n=>`opacity: ${n*i}`}}function jr(r,{delay:e=0,duration:t=400,easing:s=Ir,x:i=0,y:n=0,opacity:a=0}={}){const o=getComputedStyle(r),l=+o.opacity,c=o.transform==="none"?"":o.transform,u=l*(1-a),[h,d]=js(i),[f,m]=js(n);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${c} translate(${(1-p)*h}${d}, ${(1-p)*f}${m});
			opacity: ${l-u*v}`}}function Rt(r,{delay:e=0,duration:t=400,easing:s=Ir,start:i=0,opacity:n=0}={}){const a=getComputedStyle(r),o=+a.opacity,l=a.transform==="none"?"":a.transform,c=1-i,u=o*(1-n);return{delay:e,duration:t,easing:s,css:(h,d)=>`
			transform: ${l} scale(${1-c*d});
			opacity: ${o-u*d}
		`}}function Ri(r){let e,t,s,i,n,a,o,l,c,u,h,d;return{c(){e=O("div"),t=O("img"),i=G(),n=O("img"),o=G(),l=O("img"),u=G(),h=O("span"),d=Ee(r[0]),this.h()},l(f){e=A(f,"DIV",{class:!0});var m=B(e);t=A(m,"IMG",{class:!0,src:!0,alt:!0}),i=J(m),n=A(m,"IMG",{class:!0,style:!0,src:!0,alt:!0}),o=J(m),l=A(m,"IMG",{class:!0,src:!0,alt:!0}),u=J(m),h=A(m,"SPAN",{class:!0,style:!0});var p=B(h);d=Se(p,r[0]),p.forEach(T),m.forEach(T),this.h()},h(){y(t,"class","empty-orb svelte-12u782k"),Oe(t.src,s="images/interface/Empty Orb.png")||y(t,"src",s),y(t,"alt","points"),y(n,"class","full-orb svelte-12u782k"),pe(n,"--percentage",(1-r[1])*100+"%"),Oe(n.src,a="images/interface/Full Orb.png")||y(n,"src",a),y(n,"alt","points"),y(l,"class","heart svelte-12u782k"),Oe(l.src,c="images/interface/Point Counter.png")||y(l,"src",c),y(l,"alt","points"),y(h,"class","points svelte-12u782k"),pe(h,"color","hsl("+r[2]+", 100%, 50%)"),y(e,"class","frame svelte-12u782k")},m(f,m){W(f,e,m),_(e,t),_(e,i),_(e,n),_(e,o),_(e,l),_(e,u),_(e,h),_(h,d)},p(f,[m]){m&2&&pe(n,"--percentage",(1-f[1])*100+"%"),m&1&&Pe(d,f[0]),m&4&&pe(h,"color","hsl("+f[2]+", 100%, 50%)")},i:$e,o:$e,d(f){f&&T(e)}}}function $i(r,e,t){let s,i,{currentHealth:n=99}=e,{maxHealth:a=100}=e;return r.$$set=o=>{"currentHealth"in o&&t(0,n=o.currentHealth),"maxHealth"in o&&t(3,a=o.maxHealth)},r.$$.update=()=>{r.$$.dirty&9&&t(1,s=n/a),r.$$.dirty&2&&t(2,i=s*120)},[n,s,i,a]}class xi extends Je{constructor(e){super(),Ke(this,e,$i,Ri,Ge,{currentHealth:0,maxHealth:3})}}function Xs(r){let e,t='<img class="crown svelte-36cez0" src="images/Yellow Hat.png" alt="Crown"/>',s,i;return{c(){e=O("div"),e.innerHTML=t,this.h()},l(n){e=A(n,"DIV",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-w11w9r"&&(e.innerHTML=t),this.h()},h(){y(e,"class","crown-container svelte-36cez0")},m(n,a){W(n,e,a),i=!0},i(n){i||(n&&Et(()=>{i&&(s||(s=bt(e,Rt,{},!0)),s.run(1))}),i=!0)},o(n){n&&(s||(s=bt(e,Rt,{},!1)),s.run(0)),i=!1},d(n){n&&T(e),n&&s&&s.end()}}}function Di(r){let e,t,s,i,n,a,o,l,c,u,h,d,f=r[0].name+"",m,p,v,D,S,j,I;u=new xi({props:{maxHealth:r[1],currentHealth:r[2]}});let U=r[3]&&Xs();return{c(){e=O("button"),t=O("div"),s=G(),i=O("div"),n=G(),a=O("div"),o=O("img"),c=G(),We(u.$$.fragment),h=G(),d=O("div"),m=Ee(f),p=G(),U&&U.c(),this.h()},l(P){e=A(P,"BUTTON",{class:!0});var g=B(e);t=A(g,"DIV",{class:!0}),B(t).forEach(T),s=J(g),i=A(g,"DIV",{class:!0,style:!0}),B(i).forEach(T),n=J(g),a=A(g,"DIV",{class:!0});var w=B(a);o=A(w,"IMG",{class:!0,src:!0,alt:!0}),c=J(w),Xe(u.$$.fragment,w),h=J(w),d=A(w,"DIV",{class:!0});var b=B(d);m=Se(b,f),b.forEach(T),w.forEach(T),p=J(g),U&&U.l(g),g.forEach(T),this.h()},h(){y(t,"class","fade svelte-36cez0"),y(i,"class","border svelte-36cez0"),pe(i,"border-image","url('images/interface/Message Border.png') 8 / 8px repeat"),y(o,"class","banner svelte-36cez0"),Oe(o.src,l="images/interface/Banner "+r[0].name+".png")||y(o,"src",l),y(o,"alt","Asgarnia Banner"),y(d,"class","name svelte-36cez0"),y(a,"class","content svelte-36cez0"),y(e,"class","team svelte-36cez0"),e.disabled=v=!r[4],ge(e,"selected",r[0]===r[5]),ge(e,"editable",r[4])},m(P,g){W(P,e,g),_(e,t),_(e,s),_(e,i),_(e,n),_(e,a),_(a,o),_(a,c),Ye(u,a,null),_(a,h),_(a,d),_(d,m),_(e,p),U&&U.m(e,null),S=!0,j||(I=[ye(e,"click",r[6]),ye(e,"dblclick",r[7])],j=!0)},p(P,[g]){(!S||g&1&&!Oe(o.src,l="images/interface/Banner "+P[0].name+".png"))&&y(o,"src",l);const w={};g&2&&(w.maxHealth=P[1]),g&4&&(w.currentHealth=P[2]),u.$set(w),(!S||g&1)&&f!==(f=P[0].name+"")&&Pe(m,f),P[3]?U?g&8&&Z(U,1):(U=Xs(),U.c(),Z(U,1),U.m(e,null)):U&&(Be(),le(U,1,1,()=>{U=null}),qe()),(!S||g&16&&v!==(v=!P[4]))&&(e.disabled=v),(!S||g&33)&&ge(e,"selected",P[0]===P[5]),(!S||g&16)&&ge(e,"editable",P[4])},i(P){S||(Z(u.$$.fragment,P),Z(U),P&&(D||Et(()=>{D=gs(e,jr,{x:-100,duration:300}),D.start()})),S=!0)},o(P){le(u.$$.fragment,P),le(U),S=!1},d(P){P&&T(e),Qe(u),U&&U.d(),j=!1,Vt(I)}}}function Li(r,e,t){let s,i,n,a,o,l;Q(r,rs,f=>t(9,n=f)),Q(r,Me,f=>t(4,a=f)),Q(r,yt,f=>t(5,o=f)),Q(r,ji,f=>t(8,l=f));let{team:c}=e,{maxHealth:u}=e;function h(){a&&(se(yt,o=c,o),se(rs,n=null,n))}function d(){a&&(console.log("isolating team"),se(rs,n=c,n))}return r.$$set=f=>{"team"in f&&t(0,c=f.team),"maxHealth"in f&&t(1,u=f.maxHealth)},r.$$.update=()=>{var f;r.$$.dirty&257&&t(2,s=((f=l.find(m=>m.team===c.id))==null?void 0:f.points)??0),r.$$.dirty&260&&t(3,i=l[0].points===s&&s>0)},[c,u,s,i,a,o,h,d,l]}class Ui extends Je{constructor(e){super(),Ke(this,e,Li,Di,Ge,{team:0,maxHealth:1})}}function Ys(r){let e,t,s,i,n,a,o,l,c,u=":",h,d,f,m,p,v=":",D,S,j;return{c(){e=O("div"),t=O("span"),s=Ee(r[5]),i=G(),n=O("div"),a=O("span"),o=Ee(r[4]),l=G(),c=O("span"),c.textContent=u,h=G(),d=O("span"),f=Ee(r[3]),m=G(),p=O("span"),p.textContent=v,D=G(),S=O("span"),j=Ee(r[2]),this.h()},l(I){e=A(I,"DIV",{class:!0});var U=B(e);t=A(U,"SPAN",{class:!0});var P=B(t);s=Se(P,r[5]),P.forEach(T),i=J(U),n=A(U,"DIV",{class:!0});var g=B(n);a=A(g,"SPAN",{class:!0});var w=B(a);o=Se(w,r[4]),w.forEach(T),l=J(g),c=A(g,"SPAN",{"data-svelte-h":!0}),de(c)!=="svelte-5vnx5k"&&(c.textContent=u),h=J(g),d=A(g,"SPAN",{class:!0});var b=B(d);f=Se(b,r[3]),b.forEach(T),m=J(g),p=A(g,"SPAN",{"data-svelte-h":!0}),de(p)!=="svelte-5vnx5k"&&(p.textContent=v),D=J(g),S=A(g,"SPAN",{class:!0});var L=B(S);j=Se(L,r[2]),L.forEach(T),g.forEach(T),U.forEach(T),this.h()},h(){y(t,"class","days svelte-tm63ju"),y(a,"class","time svelte-tm63ju"),y(d,"class","time svelte-tm63ju"),y(S,"class","time svelte-tm63ju"),y(n,"class","time-container svelte-tm63ju"),y(e,"class","line-1 svelte-tm63ju")},m(I,U){W(I,e,U),_(e,t),_(t,s),_(e,i),_(e,n),_(n,a),_(a,o),_(n,l),_(n,c),_(n,h),_(n,d),_(d,f),_(n,m),_(n,p),_(n,D),_(n,S),_(S,j)},p(I,U){U&32&&Pe(s,I[5]),U&16&&Pe(o,I[4]),U&8&&Pe(f,I[3]),U&4&&Pe(j,I[2])},d(I){I&&T(e)}}}function Ni(r){let e,t,s,i,n=r[0]>0&&Ys(r);return{c(){e=O("div"),n&&n.c(),t=G(),s=O("div"),i=Ee(r[1]),this.h()},l(a){e=A(a,"DIV",{class:!0,style:!0});var o=B(e);n&&n.l(o),t=J(o),s=A(o,"DIV",{class:!0});var l=B(s);i=Se(l,r[1]),l.forEach(T),o.forEach(T),this.h()},h(){y(s,"class","line-2 svelte-tm63ju"),y(e,"class","frame svelte-tm63ju"),pe(e,"background-image","url('images/interface/Button Red.png')")},m(a,o){W(a,e,o),n&&n.m(e,null),_(e,t),_(e,s),_(s,i)},p(a,[o]){a[0]>0?n?n.p(a,o):(n=Ys(a),n.c(),n.m(e,t)):n&&(n.d(1),n=null),o&2&&Pe(i,a[1])},i:$e,o:$e,d(a){a&&T(e),n&&n.d()}}}function Mi(r,e,t){let s,i,n,a,o,l,c;Q(r,Me,p=>t(7,o=p)),Q(r,at,p=>t(8,l=p)),Q(r,ot,p=>t(6,c=p));let u,h="";const d={tournament:c.id,text:"Bingo Over",type:"completion",sender:"System"};async function f(p){if(console.log(l.some(D=>p.text===D.text)),!o||l.some(D=>p.text===D.text))return;const{error:v}=await he.from("messages").insert(p);if(v)return console.error("Error adding message",v),{status:500,error:"Could not add message"}}async function m(p){if(!o)return;const{error:v}=await he.from("messages").delete().eq("text",p.text);if(v)return console.error("Error removing message",v),{status:500,error:"Could not remove message"}}return r.$$.update=()=>{r.$$.dirty&64&&setInterval(()=>{const p=new Date;switch(!0){case p<new Date(c.startTime):t(1,h="To Start"),t(0,u=Math.abs(p-new Date(c.startTime))),m(d);break;case(p>new Date(c.startTime)&&p<new Date(c.endTime)):t(1,h="To End"),t(0,u=Math.abs(p-new Date(c.startTime))),m(d);break;case p>=new Date(c.endTime):t(1,h="Bingo Over"),t(0,u=0),f(d);break}},1e3),r.$$.dirty&1&&t(5,s=`${Math.floor(u/(1e3*60*60*24))}D`),r.$$.dirty&1&&t(4,i=`${Math.floor(u%(1e3*60*60*24)/(1e3*60*60)).toString().padStart(2,"0")}`),r.$$.dirty&1&&t(3,n=`${Math.floor(u%(1e3*60*60)/(1e3*60)).toString().padStart(2,"0")}`),r.$$.dirty&1&&t(2,a=`${Math.floor(u%(1e3*60)/1e3).toString().padStart(2,"0")}`)},[u,h,a,n,i,s,c]}class Bi extends Je{constructor(e){super(),Ke(this,e,Mi,Ni,Ge,{})}}function qi(r){let e,t,s=r[0].sender+"",i,n,a,o,l=r[0].text+"",c;return{c(){e=O("div"),t=O("div"),i=Ee(s),n=Ee(":"),a=G(),o=O("div"),c=Ee(l),this.h()},l(u){e=A(u,"DIV",{class:!0});var h=B(e);t=A(h,"DIV",{class:!0});var d=B(t);i=Se(d,s),n=Se(d,":"),d.forEach(T),a=J(h),o=A(h,"DIV",{class:!0});var f=B(o);c=Se(f,l),f.forEach(T),h.forEach(T),this.h()},h(){y(t,"class","sender svelte-6g3s81"),ge(t,"yellow",r[1].some(r[2])),ge(t,"green",r[0].type==="admin"),ge(t,"orange",r[0].sender==="System"),y(o,"class","text svelte-6g3s81"),ge(o,"green",r[0].type==="admin"),y(e,"class","message svelte-6g3s81")},m(u,h){W(u,e,h),_(e,t),_(t,i),_(t,n),_(e,a),_(e,o),_(o,c)},p(u,[h]){h&1&&s!==(s=u[0].sender+"")&&Pe(i,s),h&3&&ge(t,"yellow",u[1].some(u[2])),h&1&&ge(t,"green",u[0].type==="admin"),h&1&&ge(t,"orange",u[0].sender==="System"),h&1&&l!==(l=u[0].text+"")&&Pe(c,l),h&1&&ge(o,"green",u[0].type==="admin")},i:$e,o:$e,d(u){u&&T(e)}}}function Fi(r,e,t){let s;Q(r,it,a=>t(1,s=a));let{message:i={sender:"Unknown",text:"Hello, World!"}}=e;const n=a=>a.name===i.sender;return r.$$set=a=>{"message"in a&&t(0,i=a.message)},[i,s,n]}class Hi extends Je{constructor(e){super(),Ke(this,e,Fi,qi,Ge,{message:0})}}var Vi=Object.defineProperty,zi=(r,e,t)=>e in r?Vi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ns=(r,e,t)=>(zi(r,typeof e!="symbol"?e+"":e,t),t);class Qs{constructor(e,t={}){ns(this,"src"),ns(this,"options"),ns(this,"howl"),this.src=e,this.options=t,this.create()}async create(){const{Howl:e}=await lt(()=>import("./howler.core-e669a980.DveT1YBT.js"),[],import.meta.url).then(n=>n.h),{loop:t,volume:s}=this.options,i=new e({src:this.src,loop:t||!1,volume:s||1,...this.options});this.howl=i}update(e=this.options){this.unload(),this.options=e,this.create()}destroy(){this.stop(),this.unload()}play(){this.howl.play()}stop(){this.howl.stop()}unload(){this.howl.unload()}}function Gi(r){let e,t,s,i="Are you sure you want to reset this tournament? This cannot be undone.",n,a,o="Reset",l,c,u,h;return{c(){e=O("div"),t=O("div"),s=O("div"),s.textContent=i,n=G(),a=O("button"),a.textContent=o,this.h()},l(d){e=A(d,"DIV",{class:!0});var f=B(e);t=A(f,"DIV",{class:!0});var m=B(t);s=A(m,"DIV",{class:!0,"data-svelte-h":!0}),de(s)!=="svelte-7z16sh"&&(s.textContent=i),n=J(m),a=A(m,"BUTTON",{class:!0,"data-svelte-h":!0}),de(a)!=="svelte-kx2upl"&&(a.textContent=o),m.forEach(T),f.forEach(T),this.h()},h(){y(s,"class","message"),y(a,"class","button svelte-1phu8md"),y(t,"class","card svelte-1phu8md"),y(e,"class","frame svelte-1phu8md")},m(d,f){W(d,e,f),_(e,t),_(t,s),_(t,n),_(t,a),c=!0,u||(h=[ye(window,"keydown",r[1]),ye(a,"click",r[0]),ye(e,"click",Lr(r[2]))],u=!0)},p:$e,i(d){c||(d&&Et(()=>{c&&(l||(l=bt(e,Ht,{duration:200},!0)),l.run(1))}),c=!0)},o(d){d&&(l||(l=bt(e,Ht,{duration:200},!1)),l.run(0)),c=!1},d(d){d&&T(e),d&&l&&l.end(),u=!1,Vt(h)}}}function Ji(r,e,t){let s,i;Q(r,It,c=>t(3,s=c)),Q(r,ot,c=>t(4,i=c));async function n(){const{error:c}=await he.from("completions").delete().eq("tournament",i.id);if(se(It,s=!1,s),a(),c)return console.error("Error resetting challenges",c),{status:500,error:"Could not reset challenges"}}async function a(){const{error:c}=await he.from("messages").delete().eq("tournament",i.id);if(c)return console.error("Error resetting messages",c),{status:500,error:"Could not reset messages"}}function o(c){c.key==="Escape"&&l()}function l(){se(It,s=!1,s)}return[n,o,l]}class Ki extends Je{constructor(e){super(),Ke(this,e,Ji,Gi,Ge,{})}}function Zs(r,e,t){const s=r.slice();return s[23]=e[t],s}function er(r){let e,t;return e=new Ki({}),{c(){We(e.$$.fragment)},l(s){Xe(e.$$.fragment,s)},m(s,i){Ye(e,s,i),t=!0},i(s){t||(Z(e.$$.fragment,s),t=!0)},o(s){le(e.$$.fragment,s),t=!1},d(s){Qe(e,s)}}}function tr(r){let e,t;return e=new Hi({props:{message:r[23]}}),{c(){We(e.$$.fragment)},l(s){Xe(e.$$.fragment,s)},m(s,i){Ye(e,s,i),t=!0},p(s,i){const n={};i&64&&(n.message=s[23]),e.$set(n)},i(s){t||(Z(e.$$.fragment,s),t=!0)},o(s){le(e.$$.fragment,s),t=!1},d(s){Qe(e,s)}}}function sr(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){y(e,"class","dance svelte-10w2kpg"),Oe(e.src,t="images/Dance.gif")||y(e,"src",t),y(e,"alt","Dance")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Wi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){y(e,"class","off svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Xi(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){y(e,"class","on svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Yi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){y(e,"class","off svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Qi(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){y(e,"class","on svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Zi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){y(e,"class","off svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function ea(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){y(e,"class","on svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function ta(r){let e,t,s,i,n,a,o,l,c,u,h,d,f="Fensail:",m,p,v,D,S,j,I='<span class="name svelte-10w2kpg">Reveal</span>',U,P,g,w,b,L='<div class="line-1 svelte-10w2kpg"><span class="name svelte-10w2kpg">Snap</span></div>',q,N,R,F='<span class="name svelte-10w2kpg">Music</span>',E,x,ee,ae,ce,k='<span class="name svelte-10w2kpg">Vibe</span>',C,V,fe,ue,$,z='<span class="name svelte-10w2kpg">Reset</span>',Y,H,ne,_e,ut='<span class="name svelte-10w2kpg">Logout</span>',Fe,Te,ve,De,Ze,Jt,bs,me=r[7]&&er(),et=Re(r[6]),oe=[];for(let M=0;M<et.length;M+=1)oe[M]=tr(Zs(r,et,M));const xr=M=>le(oe[M],1,1,()=>{oe[M]=null});let be=r[4]&&sr();function ks(M,te){return M[3].isRevealed?Xi:Wi}let xt=ks(r),Le=xt(r);function Es(M,te){return M[2]?Qi:Yi}let Dt=Es(r),Ue=Dt(r);function Ss(M,te){return M[4]?ea:Zi}let Lt=Ss(r),Ne=Lt(r);return ve=new Bi({}),{c(){me&&me.c(),e=G(),t=O("div"),s=O("div"),i=O("div"),n=O("div");for(let M=0;M<oe.length;M+=1)oe[M].c();a=G(),be&&be.c(),o=G(),l=O("div"),c=O("img"),h=G(),d=O("span"),d.textContent=f,m=G(),p=O("input"),v=G(),D=O("div"),S=O("button"),j=O("div"),j.innerHTML=I,U=G(),P=O("div"),Le.c(),w=G(),b=O("button"),b.innerHTML=L,q=G(),N=O("button"),R=O("div"),R.innerHTML=F,E=G(),x=O("div"),Ue.c(),ee=G(),ae=O("button"),ce=O("div"),ce.innerHTML=k,C=G(),V=O("div"),Ne.c(),fe=G(),ue=O("button"),$=O("div"),$.innerHTML=z,H=G(),ne=O("button"),_e=O("div"),_e.innerHTML=ut,Te=G(),We(ve.$$.fragment),this.h()},l(M){me&&me.l(M),e=J(M),t=A(M,"DIV",{class:!0});var te=B(t);s=A(te,"DIV",{class:!0,style:!0});var ie=B(s);i=A(ie,"DIV",{class:!0});var tt=B(i);n=A(tt,"DIV",{class:!0});var Ts=B(n);for(let Kt=0;Kt<oe.length;Kt+=1)oe[Kt].l(Ts);Ts.forEach(T),a=J(tt),be&&be.l(tt),tt.forEach(T),o=J(ie),l=A(ie,"DIV",{class:!0});var ht=B(l);c=A(ht,"IMG",{class:!0,src:!0,alt:!0}),h=J(ht),d=A(ht,"SPAN",{class:!0,"data-svelte-h":!0}),de(d)!=="svelte-1w3y9cz"&&(d.textContent=f),m=J(ht),p=A(ht,"INPUT",{class:!0,type:!0}),ht.forEach(T),ie.forEach(T),v=J(te),D=A(te,"DIV",{class:!0});var ke=B(D);S=A(ke,"BUTTON",{class:!0,style:!0});var Ut=B(S);j=A(Ut,"DIV",{class:!0,"data-svelte-h":!0}),de(j)!=="svelte-5tg6go"&&(j.innerHTML=I),U=J(Ut),P=A(Ut,"DIV",{class:!0});var Cs=B(P);Le.l(Cs),Cs.forEach(T),Ut.forEach(T),w=J(ke),b=A(ke,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),de(b)!=="svelte-sugqyf"&&(b.innerHTML=L),q=J(ke),N=A(ke,"BUTTON",{class:!0,style:!0});var Nt=B(N);R=A(Nt,"DIV",{class:!0,"data-svelte-h":!0}),de(R)!=="svelte-1ar69di"&&(R.innerHTML=F),E=J(Nt),x=A(Nt,"DIV",{class:!0});var Ps=B(x);Ue.l(Ps),Ps.forEach(T),Nt.forEach(T),ee=J(ke),ae=A(ke,"BUTTON",{class:!0,style:!0});var Mt=B(ae);ce=A(Mt,"DIV",{class:!0,"data-svelte-h":!0}),de(ce)!=="svelte-1xgdo1x"&&(ce.innerHTML=k),C=J(Mt),V=A(Mt,"DIV",{class:!0});var Os=B(V);Ne.l(Os),Os.forEach(T),Mt.forEach(T),fe=J(ke),ue=A(ke,"BUTTON",{class:!0,style:!0});var As=B(ue);$=A(As,"DIV",{class:!0,"data-svelte-h":!0}),de($)!=="svelte-6vd44i"&&($.innerHTML=z),As.forEach(T),H=J(ke),ne=A(ke,"BUTTON",{class:!0,style:!0});var Is=B(ne);_e=A(Is,"DIV",{class:!0,"data-svelte-h":!0}),de(_e)!=="svelte-1ich0qb"&&(_e.innerHTML=ut),Is.forEach(T),Te=J(ke),Xe(ve.$$.fragment,ke),ke.forEach(T),te.forEach(T),this.h()},h(){y(n,"class","messages svelte-10w2kpg"),y(i,"class","messages-container svelte-10w2kpg"),y(c,"class","icon svelte-10w2kpg"),Oe(c.src,u="images/interface/Chat Helmet.png")||y(c,"src",u),y(c,"alt","Ironman"),y(d,"class","input-name white text svelte-10w2kpg"),y(p,"class","input white text svelte-10w2kpg"),y(p,"type","text"),y(l,"class","input-container svelte-10w2kpg"),y(s,"class","chat-box svelte-10w2kpg"),pe(s,"border-image","url('images/interface/Message Border.png') 8 / 16px repeat"),y(j,"class","line-1 svelte-10w2kpg"),y(P,"class","line-2 svelte-10w2kpg"),y(S,"class","button svelte-10w2kpg"),S.disabled=g=!r[5],pe(S,"background-image","url('images/interface/Button Brown.png')"),y(b,"class","button svelte-10w2kpg"),pe(b,"background-image","url('images/interface/Button Brown.png')"),y(R,"class","line-1 svelte-10w2kpg"),y(x,"class","line-2 svelte-10w2kpg"),y(N,"class","button svelte-10w2kpg"),pe(N,"background-image","url('images/interface/Button Brown.png')"),y(ce,"class","line-1 svelte-10w2kpg"),y(V,"class","line-2 svelte-10w2kpg"),y(ae,"class","button svelte-10w2kpg"),pe(ae,"background-image","url('images/interface/Button Brown.png')"),y($,"class","line-1 svelte-10w2kpg"),y(ue,"class","button svelte-10w2kpg"),ue.disabled=Y=!r[5],pe(ue,"background-image","url('images/interface/Button Brown.png')"),y(_e,"class","line-1 svelte-10w2kpg"),y(ne,"class","button svelte-10w2kpg"),ne.disabled=Fe=!r[5],pe(ne,"background-image","url('images/interface/Button Brown.png')"),y(D,"class","buttons svelte-10w2kpg"),y(t,"class","menu svelte-10w2kpg")},m(M,te){me&&me.m(M,te),W(M,e,te),W(M,t,te),_(t,s),_(s,i),_(i,n);for(let ie=0;ie<oe.length;ie+=1)oe[ie]&&oe[ie].m(n,null);_(i,a),be&&be.m(i,null),_(s,o),_(s,l),_(l,c),_(l,h),_(l,d),_(l,m),_(l,p),Rs(p,r[0]),r[18](p),_(t,v),_(t,D),_(D,S),_(S,j),_(S,U),_(S,P),Le.m(P,null),_(D,w),_(D,b),_(D,q),_(D,N),_(N,R),_(N,E),_(N,x),Ue.m(x,null),_(D,ee),_(D,ae),_(ae,ce),_(ae,C),_(ae,V),Ne.m(V,null),_(D,fe),_(D,ue),_(ue,$),_(D,H),_(D,ne),_(ne,_e),_(D,Te),Ye(ve,D,null),Ze=!0,Jt||(bs=[ye(window,"keydown",r[11]),ye(p,"focus",r[15]),ye(p,"blur",r[16]),ye(p,"input",r[17]),ye(S,"click",r[14]),ye(b,"click",r[9]),ye(N,"click",r[10]),ye(ae,"click",r[13]),ye(ue,"click",r[8]),ye(ne,"click",r[12])],Jt=!0)},p(M,[te]){if(M[7]?me?te&128&&Z(me,1):(me=er(),me.c(),Z(me,1),me.m(e.parentNode,e)):me&&(Be(),le(me,1,1,()=>{me=null}),qe()),te&64){et=Re(M[6]);let ie;for(ie=0;ie<et.length;ie+=1){const tt=Zs(M,et,ie);oe[ie]?(oe[ie].p(tt,te),Z(oe[ie],1)):(oe[ie]=tr(tt),oe[ie].c(),Z(oe[ie],1),oe[ie].m(n,null))}for(Be(),ie=et.length;ie<oe.length;ie+=1)xr(ie);qe()}M[4]?be||(be=sr(),be.c(),be.m(i,null)):be&&(be.d(1),be=null),te&1&&p.value!==M[0]&&Rs(p,M[0]),xt!==(xt=ks(M))&&(Le.d(1),Le=xt(M),Le&&(Le.c(),Le.m(P,null))),(!Ze||te&32&&g!==(g=!M[5]))&&(S.disabled=g),Dt!==(Dt=Es(M))&&(Ue.d(1),Ue=Dt(M),Ue&&(Ue.c(),Ue.m(x,null))),Lt!==(Lt=Ss(M))&&(Ne.d(1),Ne=Lt(M),Ne&&(Ne.c(),Ne.m(V,null))),(!Ze||te&32&&Y!==(Y=!M[5]))&&(ue.disabled=Y),(!Ze||te&32&&Fe!==(Fe=!M[5]))&&(ne.disabled=Fe)},i(M){if(!Ze){Z(me);for(let te=0;te<et.length;te+=1)Z(oe[te]);Z(ve.$$.fragment,M),M&&(De||Et(()=>{De=gs(t,jr,{y:1e3,duration:1e3}),De.start()})),Ze=!0}},o(M){le(me),oe=oe.filter(Boolean);for(let te=0;te<oe.length;te+=1)le(oe[te]);le(ve.$$.fragment,M),Ze=!1},d(M){M&&(T(e),T(t)),me&&me.d(M),gr(oe,M),be&&be.d(),r[18](null),Le.d(),Ue.d(),Ne.d(),Qe(ve),Jt=!1,Vt(bs)}}}const is="helmet";function sa(r,e,t){let s,i,n,a,o;Q(r,ot,b=>t(3,s=b)),Q(r,Ws,b=>t(4,i=b)),Q(r,Me,b=>t(5,n=b)),Q(r,at,b=>t(6,a=b)),Q(r,It,b=>t(7,o=b));let l="",c,u=!1;const h=Ur();let d=new Qs("/music/Inferno.ogg");function f(){se(It,o=!0,o)}function m(){h("snap")}function p(){d||(d=new Qs("/music/Inferno.ogg")),d.howl.playing()?(d.howl.pause(),t(2,u=!1)):(d.howl.play(),t(2,u=!0))}async function v(b){if(!n||a.includes(b))return;const{error:L}=await he.from("messages").insert(b);if(L)return console.error("Error adding message",L),{status:500,error:"Could not add message"}}function D(b){if(b.key==="Enter"){switch(!0){case c!==document.activeElement:console.log("focusing"),c.focus();break;case l===is:console.log("entering"),se(Me,n=!0,n),localStorage.setItem("tournKey",JSON.stringify(s.id));break;case(l!==is&&n===!0):console.log("something here"),v({sender:"Fensail",text:l,tournament:s.id,type:"admin"});break;case(l!==is&&n===!1):console.log("nothing here");break}t(0,l="")}}function S(){h("logout")}function j(){se(Ws,i=!i,i)}async function I(){const{error:b}=await he.from("tournaments").update({isRevealed:!s.isRevealed}).eq("id",s.id);if(b)return console.error("Error toggling reveal",b),{status:500,error:"Could not toggle reveal"}}const U=()=>{console.log("focusing")},P=()=>{console.log("blurring")};function g(){l=this.value,t(0,l)}function w(b){mr[b?"unshift":"push"](()=>{c=b,t(1,c)})}return[l,c,u,s,i,n,a,o,f,m,p,D,S,j,I,U,P,g,w]}class ra extends Je{constructor(e){super(),Ke(this,e,sa,ta,Ge,{})}}function rr(r,e,t){const s=r.slice();s[19]=e[t];const i=s[6].find(function(...a){return r[10](s[19],...a)}).name;return s[20]=i,s}function na(r){let e,t,s;function i(o,l){return o[0].order===13?oa:aa}let n=i(r),a=n(r);return{c(){e=O("div"),a.c(),this.h()},l(o){e=A(o,"DIV",{class:!0,style:!0});var l=B(e);a.l(l),l.forEach(T),this.h()},h(){y(e,"class","face back svelte-5dk2zm"),pe(e,"border-image","url('images/interface/Message Border.png') 8 / 4px repeat")},m(o,l){W(o,e,l),a.m(e,null),s=!0},p(o,l){n!==(n=i(o))&&(a.d(1),a=n(o),a&&(a.c(),a.m(e,null)))},i(o){s||(t&&t.end(1),s=!0)},o(o){o&&(t=pr(e,Ht,{delay:200})),s=!1},d(o){o&&T(e),a.d(),o&&t&&t.end()}}}function ia(r){let e,t,s,i,n,a=r[0].name+"",o,l,c,u,h,d,f,m,p=Re(r[2]),v=[];for(let S=0;S<p.length;S+=1)v[S]=nr(rr(r,p,S));const D=S=>le(v[S],1,1,()=>{v[S]=null});return{c(){e=O("div"),t=O("img"),i=G(),n=O("div"),o=Ee(a),l=G(),c=O("div"),u=Ee(r[3]),h=G(),d=O("div");for(let S=0;S<v.length;S+=1)v[S].c();this.h()},l(S){e=A(S,"DIV",{class:!0,style:!0});var j=B(e);t=A(j,"IMG",{class:!0,src:!0}),i=J(j),n=A(j,"DIV",{class:!0});var I=B(n);o=Se(I,a),I.forEach(T),l=J(j),c=A(j,"DIV",{class:!0});var U=B(c);u=Se(U,r[3]),U.forEach(T),h=J(j),d=A(j,"DIV",{class:!0});var P=B(d);for(let g=0;g<v.length;g+=1)v[g].l(P);P.forEach(T),j.forEach(T),this.h()},h(){y(t,"class","challenge-icon svelte-5dk2zm"),Oe(t.src,s="images/challenge-icons/"+r[0].name+".png")||y(t,"src",s),ge(t,"gray",r[4]),y(n,"class","name svelte-5dk2zm"),y(c,"class","points svelte-5dk2zm"),y(d,"class","completions svelte-5dk2zm"),y(e,"class","face front svelte-5dk2zm"),pe(e,"border-image","url('images/interface/Message Border.png') 8 / 4px repeat")},m(S,j){W(S,e,j),_(e,t),_(e,i),_(e,n),_(n,o),_(e,l),_(e,c),_(c,u),_(e,h),_(e,d);for(let I=0;I<v.length;I+=1)v[I]&&v[I].m(d,null);m=!0},p(S,j){if((!m||j&1&&!Oe(t.src,s="images/challenge-icons/"+S[0].name+".png"))&&y(t,"src",s),(!m||j&16)&&ge(t,"gray",S[4]),(!m||j&1)&&a!==(a=S[0].name+"")&&Pe(o,a),(!m||j&8)&&Pe(u,S[3]),j&68){p=Re(S[2]);let I;for(I=0;I<p.length;I+=1){const U=rr(S,p,I);v[I]?(v[I].p(U,j),Z(v[I],1)):(v[I]=nr(U),v[I].c(),Z(v[I],1),v[I].m(d,null))}for(Be(),I=p.length;I<v.length;I+=1)D(I);qe()}},i(S){if(!m){for(let j=0;j<p.length;j+=1)Z(v[j]);f&&f.end(1),m=!0}},o(S){v=v.filter(Boolean);for(let j=0;j<v.length;j+=1)le(v[j]);S&&(f=pr(e,Ht,{delay:200})),m=!1},d(S){S&&T(e),gr(v,S),S&&f&&f.end()}}}function aa(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){y(e,"class","icon blur svelte-5dk2zm"),Oe(e.src,t="images/challenge-icons/Hidden 3.png")||y(e,"src",t),y(e,"alt","Hidden")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function oa(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){y(e,"class","icon blur svelte-5dk2zm"),Oe(e.src,t="images/challenge-icons/Hidden 4.png")||y(e,"src",t),y(e,"alt","Hidden")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function nr(r){let e,t,s,i,n,a;return{c(){e=O("div"),t=O("img"),i=G(),this.h()},l(o){e=A(o,"DIV",{class:!0});var l=B(e);t=A(l,"IMG",{class:!0,src:!0}),i=J(l),l.forEach(T),this.h()},h(){y(t,"class","icon svelte-5dk2zm"),Oe(t.src,s="images/interface/Banner "+r[20]+".png")||y(t,"src",s),y(e,"class","completion svelte-5dk2zm")},m(o,l){W(o,e,l),_(e,t),_(e,i),a=!0},p(o,l){(!a||l&68&&!Oe(t.src,s="images/interface/Banner "+o[20]+".png"))&&y(t,"src",s)},i(o){a||(o&&Et(()=>{a&&(n||(n=bt(e,Rt,{},!0)),n.run(1))}),a=!0)},o(o){o&&(n||(n=bt(e,Rt,{},!1)),n.run(0)),a=!1},d(o){o&&T(e),o&&n&&n.end()}}}function la(r){let e,t,s,i,n,a,o,l;const c=[ia,na],u=[];function h(d,f){return d[1]?0:1}return t=h(r),s=u[t]=c[t](r),{c(){e=O("button"),s.c(),this.h()},l(d){e=A(d,"BUTTON",{class:!0,style:!0});var f=B(e);s.l(f),f.forEach(T),this.h()},h(){y(e,"class","challenge svelte-5dk2zm"),pe(e,"order",r[0].order),e.disabled=i=!r[5]||!r[1],ge(e,"active",r[1]),ge(e,"gray",r[4]),ge(e,"editable",r[5])},m(d,f){W(d,e,f),u[t].m(e,null),a=!0,o||(l=ye(e,"click",r[11]),o=!0)},p(d,[f]){let m=t;t=h(d),t===m?u[t].p(d,f):(Be(),le(u[m],1,1,()=>{u[m]=null}),qe(),s=u[t],s?s.p(d,f):(s=u[t]=c[t](d),s.c()),Z(s,1),s.m(e,null)),(!a||f&1)&&pe(e,"order",d[0].order),(!a||f&34&&i!==(i=!d[5]||!d[1]))&&(e.disabled=i),(!a||f&2)&&ge(e,"active",d[1]),(!a||f&16)&&ge(e,"gray",d[4]),(!a||f&32)&&ge(e,"editable",d[5])},i(d){a||(Z(s),d&&(n||Et(()=>{n=gs(e,Rt,{}),n.start()})),a=!0)},o(d){le(s),a=!1},d(d){d&&T(e),u[t].d(),o=!1,l()}}}const ca=1,ua=2;function ha(r,e,t){let s,i,n,a,o,l,c,u,h,d;Q(r,Me,P=>t(5,a=P)),Q(r,at,P=>t(12,o=P)),Q(r,ot,P=>t(13,l=P)),Q(r,yt,P=>t(14,c=P)),Q(r,Ar,P=>t(8,u=P)),Q(r,_t,P=>t(9,h=P)),Q(r,it,P=>t(6,d=P));let{challenge:f}=e,{isActive:m=!1}=e;function p(){if(!a)return;const P={tournament:l.id,text:`Completed the challenge ${f.name}`,type:"completion",sender:c.name};s.some(g=>g.team===c.id)?(D(c),j(P)):(v(c),S(P))}async function v(P){if(!a)return;const{error:g}=await he.from("completions").insert({tournament:l.id,challenge:f.id,team:P.id});if(g)return console.error("Error adding challenge",g),{status:500,error:"Could not add challenge"}}async function D(P){if(!a)return;const{error:g}=await he.from("completions").delete().eq("team",P.id).eq("challenge",f.id);if(g)return console.error("Error remove completion",g),{status:500,error:"Could not remove completion"}}async function S(P){if(!a||o.includes(P))return;const{error:g}=await he.from("messages").insert(P);if(g)return console.error("Error adding message",g),{status:500,error:"Could not add message"}}async function j(P){if(!a)return;const{error:g}=await he.from("messages").delete().eq("text",P.text);if(g)return console.error("Error removing message",g),{status:500,error:"Could not remove message"}}const I=(P,g)=>g.id===P.team,U=()=>p();return r.$$set=P=>{"challenge"in P&&t(0,f=P.challenge),"isActive"in P&&t(1,m=P.isActive)},r.$$.update=()=>{r.$$.dirty&513&&t(2,s=h.filter(P=>P.challenge===f.id)),r.$$.dirty&260&&t(4,i=s.length>=u.maxTeams),r.$$.dirty&5&&t(3,n=f.points-(f.type==="main"?Math.min(s.length,ua):0)*ca)},[f,m,s,n,i,a,d,p,u,h,I,U]}class Rr extends Je{constructor(e){super(),Ke(this,e,ha,la,Ge,{challenge:0,isActive:1})}}function da(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var $r={exports:{}};(function(r){(function(e){var t=j(),s=I(),i=U(),n=P(),a={imagePlaceholder:void 0,cacheBust:!1},o={toSvg:l,toPng:u,toJpeg:h,toBlob:d,toPixelData:c,impl:{fontFaces:i,images:n,util:t,inliner:s,options:{}}};r.exports=o;function l(g,w){return w=w||{},f(w),Promise.resolve(g).then(function(L){return p(L,w.filter,!0)}).then(v).then(D).then(b).then(function(L){return S(L,w.width||t.width(g),w.height||t.height(g))});function b(L){return w.bgcolor&&(L.style.backgroundColor=w.bgcolor),w.width&&(L.style.width=w.width+"px"),w.height&&(L.style.height=w.height+"px"),w.style&&Object.keys(w.style).forEach(function(q){L.style[q]=w.style[q]}),L}}function c(g,w){return m(g,w||{}).then(function(b){return b.getContext("2d").getImageData(0,0,t.width(g),t.height(g)).data})}function u(g,w){return m(g,w||{}).then(function(b){return b.toDataURL()})}function h(g,w){return w=w||{},m(g,w).then(function(b){return b.toDataURL("image/jpeg",w.quality||1)})}function d(g,w){return m(g,w||{}).then(t.canvasToBlob)}function f(g){typeof g.imagePlaceholder>"u"?o.impl.options.imagePlaceholder=a.imagePlaceholder:o.impl.options.imagePlaceholder=g.imagePlaceholder,typeof g.cacheBust>"u"?o.impl.options.cacheBust=a.cacheBust:o.impl.options.cacheBust=g.cacheBust}function m(g,w){return l(g,w).then(t.makeImage).then(t.delay(100)).then(function(L){var q=b(g);return q.getContext("2d").drawImage(L,0,0),q});function b(L){var q=document.createElement("canvas");if(q.width=w.width||t.width(L),q.height=w.height||t.height(L),w.bgcolor){var N=q.getContext("2d");N.fillStyle=w.bgcolor,N.fillRect(0,0,q.width,q.height)}return q}}function p(g,w,b){if(!b&&w&&!w(g))return Promise.resolve();return Promise.resolve(g).then(L).then(function(R){return q(g,R,w)}).then(function(R){return N(g,R)});function L(R){return R instanceof HTMLCanvasElement?t.makeImage(R.toDataURL()):R.cloneNode(!1)}function q(R,F,E){var x=R.childNodes;if(x.length===0)return Promise.resolve(F);return ee(F,t.asArray(x),E).then(function(){return F});function ee(ae,ce,k){var C=Promise.resolve();return ce.forEach(function(V){C=C.then(function(){return p(V,k)}).then(function(fe){fe&&ae.appendChild(fe)})}),C}}function N(R,F){if(!(F instanceof Element))return F;return Promise.resolve().then(E).then(x).then(ee).then(ae).then(function(){return F});function E(){ce(window.getComputedStyle(R),F.style);function ce(k,C){k.cssText?C.cssText=k.cssText:V(k,C);function V(fe,ue){t.asArray(fe).forEach(function($){ue.setProperty($,fe.getPropertyValue($),fe.getPropertyPriority($))})}}}function x(){[":before",":after"].forEach(function(k){ce(k)});function ce(k){var C=window.getComputedStyle(R,k),V=C.getPropertyValue("content");if(V===""||V==="none")return;var fe=t.uid();F.className=F.className+" "+fe;var ue=document.createElement("style");ue.appendChild($(fe,k,C)),F.appendChild(ue);function $(z,Y,H){var ne="."+z+":"+Y,_e=H.cssText?ut(H):Fe(H);return document.createTextNode(ne+"{"+_e+"}");function ut(Te){var ve=Te.getPropertyValue("content");return Te.cssText+" content: "+ve+";"}function Fe(Te){return t.asArray(Te).map(ve).join("; ")+";";function ve(De){return De+": "+Te.getPropertyValue(De)+(Te.getPropertyPriority(De)?" !important":"")}}}}}function ee(){R instanceof HTMLTextAreaElement&&(F.innerHTML=R.value),R instanceof HTMLInputElement&&F.setAttribute("value",R.value)}function ae(){F instanceof SVGElement&&(F.setAttribute("xmlns","http://www.w3.org/2000/svg"),F instanceof SVGRectElement&&["width","height"].forEach(function(ce){var k=F.getAttribute(ce);k&&F.style.setProperty(ce,k)}))}}}function v(g){return i.resolveAll().then(function(w){var b=document.createElement("style");return g.appendChild(b),b.appendChild(document.createTextNode(w)),g})}function D(g){return n.inlineAll(g).then(function(){return g})}function S(g,w,b){return Promise.resolve(g).then(function(L){return L.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(L)}).then(t.escapeXhtml).then(function(L){return'<foreignObject x="0" y="0" width="100%" height="100%">'+L+"</foreignObject>"}).then(function(L){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+w+'" height="'+b+'">'+L+"</svg>"}).then(function(L){return"data:image/svg+xml;charset=utf-8,"+L})}function j(){return{escape:ae,parseExtension:w,mimeType:b,dataAsUrl:ee,isDataUrl:L,canvasToBlob:N,resolveUrl:R,getAndEncode:x,uid:F(),delay:ce,asArray:k,escapeXhtml:C,makeImage:E,width:V,height:fe};function g(){var $="application/font-woff",z="image/jpeg";return{woff:$,woff2:$,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:z,jpeg:z,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function w($){var z=/\.([^\.\/]*?)$/g.exec($);return z?z[1]:""}function b($){var z=w($).toLowerCase();return g()[z]||""}function L($){return $.search(/^(data:)/)!==-1}function q($){return new Promise(function(z){for(var Y=window.atob($.toDataURL().split(",")[1]),H=Y.length,ne=new Uint8Array(H),_e=0;_e<H;_e++)ne[_e]=Y.charCodeAt(_e);z(new Blob([ne],{type:"image/png"}))})}function N($){return $.toBlob?new Promise(function(z){$.toBlob(z)}):q($)}function R($,z){var Y=document.implementation.createHTMLDocument(),H=Y.createElement("base");Y.head.appendChild(H);var ne=Y.createElement("a");return Y.body.appendChild(ne),H.href=z,ne.href=$,ne.href}function F(){var $=0;return function(){return"u"+z()+$++;function z(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function E($){return new Promise(function(z,Y){var H=new Image;H.onload=function(){z(H)},H.onerror=Y,H.src=$})}function x($){var z=3e4;return o.impl.options.cacheBust&&($+=(/\?/.test($)?"&":"?")+new Date().getTime()),new Promise(function(Y){var H=new XMLHttpRequest;H.onreadystatechange=ut,H.ontimeout=Fe,H.responseType="blob",H.timeout=z,H.open("GET",$,!0),H.send();var ne;if(o.impl.options.imagePlaceholder){var _e=o.impl.options.imagePlaceholder.split(/,/);_e&&_e[1]&&(ne=_e[1])}function ut(){if(H.readyState===4){if(H.status!==200){ne?Y(ne):Te("cannot fetch resource: "+$+", status: "+H.status);return}var ve=new FileReader;ve.onloadend=function(){var De=ve.result.split(/,/)[1];Y(De)},ve.readAsDataURL(H.response)}}function Fe(){ne?Y(ne):Te("timeout of "+z+"ms occured while fetching resource: "+$)}function Te(ve){console.error(ve),Y("")}})}function ee($,z){return"data:"+z+";base64,"+$}function ae($){return $.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function ce($){return function(z){return new Promise(function(Y){setTimeout(function(){Y(z)},$)})}}function k($){for(var z=[],Y=$.length,H=0;H<Y;H++)z.push($[H]);return z}function C($){return $.replace(/#/g,"%23").replace(/\n/g,"%0A")}function V($){var z=ue($,"border-left-width"),Y=ue($,"border-right-width");return $.scrollWidth+z+Y}function fe($){var z=ue($,"border-top-width"),Y=ue($,"border-bottom-width");return $.scrollHeight+z+Y}function ue($,z){var Y=window.getComputedStyle($).getPropertyValue(z);return parseFloat(Y.replace("px",""))}}function I(){var g=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:q,shouldProcess:w,impl:{readUrls:b,inline:L}};function w(N){return N.search(g)!==-1}function b(N){for(var R=[],F;(F=g.exec(N))!==null;)R.push(F[1]);return R.filter(function(E){return!t.isDataUrl(E)})}function L(N,R,F,E){return Promise.resolve(R).then(function(ee){return F?t.resolveUrl(ee,F):ee}).then(E||t.getAndEncode).then(function(ee){return t.dataAsUrl(ee,t.mimeType(R))}).then(function(ee){return N.replace(x(R),"$1"+ee+"$3")});function x(ee){return new RegExp(`(url\\(['"]?)(`+t.escape(ee)+`)(['"]?\\))`,"g")}}function q(N,R,F){if(E())return Promise.resolve(N);return Promise.resolve(N).then(b).then(function(x){var ee=Promise.resolve(N);return x.forEach(function(ae){ee=ee.then(function(ce){return L(ce,ae,R,F)})}),ee});function E(){return!w(N)}}}function U(){return{resolveAll:g,impl:{readAll:w}};function g(){return w().then(function(b){return Promise.all(b.map(function(L){return L.resolve()}))}).then(function(b){return b.join(`
`)})}function w(){return Promise.resolve(t.asArray(document.styleSheets)).then(L).then(b).then(function(N){return N.map(q)});function b(N){return N.filter(function(R){return R.type===CSSRule.FONT_FACE_RULE}).filter(function(R){return s.shouldProcess(R.style.getPropertyValue("src"))})}function L(N){var R=[];return N.forEach(function(F){try{t.asArray(F.cssRules||[]).forEach(R.push.bind(R))}catch(E){console.log("Error while reading CSS rules from "+F.href,E.toString())}}),R}function q(N){return{resolve:function(){var F=(N.parentStyleSheet||{}).href;return s.inlineAll(N.cssText,F)},src:function(){return N.style.getPropertyValue("src")}}}}}function P(){return{inlineAll:w,impl:{newImage:g}};function g(b){return{inline:L};function L(q){return t.isDataUrl(b.src)?Promise.resolve():Promise.resolve(b.src).then(q||t.getAndEncode).then(function(N){return t.dataAsUrl(N,t.mimeType(b.src))}).then(function(N){return new Promise(function(R,F){b.onload=R,b.onerror=F,b.src=N})})}}function w(b){if(!(b instanceof Element))return Promise.resolve(b);return L(b).then(function(){return b instanceof HTMLImageElement?g(b).inline():Promise.all(t.asArray(b.childNodes).map(function(q){return w(q)}))});function L(q){var N=q.style.getPropertyValue("background");return N?s.inlineAll(N).then(function(R){q.style.setProperty("background",R,q.style.getPropertyPriority("background"))}).then(function(){return q}):Promise.resolve(q)}}}})()})($r);var fa=$r.exports;const ga=da(fa);function ir(r,e,t){const s=r.slice();return s[28]=e[t],s}function ar(r,e,t){const s=r.slice();s[28]=e[t];const i=s[2].isRevealed&&(s[9].includes(s[28].order)||s[10].includes(s[28].order)&&s[0]>=ds||s[11].includes(s[28].order)&&s[0]>=fs);return s[31]=i,s}function or(r,e,t){const s=r.slice();return s[34]=e[t],s}function ma(r){let e,t="Loading...";return{c(){e=O("div"),e.textContent=t,this.h()},l(s){e=A(s,"DIV",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1f5y80z"&&(e.textContent=t),this.h()},h(){y(e,"class","loading svelte-c9q9wy")},m(s,i){W(s,e,i)},p:$e,i:$e,o:$e,d(s){s&&T(e)}}}function pa(r){let e,t,s=r[2].name+"",i,n,a,o,l,c="TEAMS",u,h=[],d=new Map,f,m,p,v=[],D=new Map,S,j,I,U="BONUS",P,g,w=[],b=new Map,L,q,N,R=r[1]&&lr(r),F=Re(r[5]);const E=k=>k[34].id;for(let k=0;k<F.length;k+=1){let C=or(r,F,k),V=E(C);d.set(V,h[k]=cr(V,C))}let x=Re(r[4].filter(dr));const ee=k=>k[28].order;for(let k=0;k<x.length;k+=1){let C=ar(r,x,k),V=ee(C);D.set(V,v[k]=ur(V,C))}let ae=Re(r[4].filter(fr));const ce=k=>k[28].order;for(let k=0;k<ae.length;k+=1){let C=ir(r,ae,k),V=ce(C);b.set(V,w[k]=hr(V,C))}return q=new ra({}),q.$on("snap",r[12]),q.$on("logout",r[13]),{c(){e=O("div"),t=O("h1"),i=Ee(s),n=G(),R&&R.c(),a=G(),o=O("div"),l=O("div"),l.textContent=c,u=G();for(let k=0;k<h.length;k+=1)h[k].c();f=G(),m=O("div"),p=O("div");for(let k=0;k<v.length;k+=1)v[k].c();S=G(),j=O("div"),I=O("div"),I.textContent=U,P=G(),g=O("div");for(let k=0;k<w.length;k+=1)w[k].c();L=G(),We(q.$$.fragment),this.h()},l(k){e=A(k,"DIV",{class:!0});var C=B(e);t=A(C,"H1",{class:!0});var V=B(t);i=Se(V,s),V.forEach(T),n=J(C),R&&R.l(C),C.forEach(T),a=J(k),o=A(k,"DIV",{class:!0});var fe=B(o);l=A(fe,"DIV",{class:!0,"data-svelte-h":!0}),de(l)!=="svelte-1f76pmf"&&(l.textContent=c),u=J(fe);for(let H=0;H<h.length;H+=1)h[H].l(fe);fe.forEach(T),f=J(k),m=A(k,"DIV",{class:!0});var ue=B(m);p=A(ue,"DIV",{class:!0});var $=B(p);for(let H=0;H<v.length;H+=1)v[H].l($);$.forEach(T),ue.forEach(T),S=J(k),j=A(k,"DIV",{class:!0});var z=B(j);I=A(z,"DIV",{class:!0,"data-svelte-h":!0}),de(I)!=="svelte-1j4xxyu"&&(I.textContent=U),P=J(z),g=A(z,"DIV",{class:!0});var Y=B(g);for(let H=0;H<w.length;H+=1)w[H].l(Y);Y.forEach(T),z.forEach(T),L=J(k),Xe(q.$$.fragment,k),this.h()},h(){y(t,"class","title svelte-c9q9wy"),y(e,"class","titles svelte-c9q9wy"),y(l,"class","label svelte-c9q9wy"),y(o,"class","teams svelte-c9q9wy"),y(p,"class","challenges svelte-c9q9wy"),y(m,"class","challenges-container svelte-c9q9wy"),y(I,"class","label svelte-c9q9wy"),y(g,"class","bonus-challenges svelte-c9q9wy"),y(j,"class","bonus-challenges-container svelte-c9q9wy")},m(k,C){W(k,e,C),_(e,t),_(t,i),_(e,n),R&&R.m(e,null),W(k,a,C),W(k,o,C),_(o,l),_(o,u);for(let V=0;V<h.length;V+=1)h[V]&&h[V].m(o,null);W(k,f,C),W(k,m,C),_(m,p);for(let V=0;V<v.length;V+=1)v[V]&&v[V].m(p,null);W(k,S,C),W(k,j,C),_(j,I),_(j,P),_(j,g);for(let V=0;V<w.length;V+=1)w[V]&&w[V].m(g,null);W(k,L,C),Ye(q,k,C),N=!0},p(k,C){(!N||C[0]&4)&&s!==(s=k[2].name+"")&&Pe(i,s),k[1]?R?R.p(k,C):(R=lr(k),R.c(),R.m(e,null)):R&&(R.d(1),R=null),C[0]&160&&(F=Re(k[5]),Be(),h=Xt(h,C,E,1,k,F,d,o,Wt,cr,null,or),qe()),C[0]&3605&&(x=Re(k[4].filter(dr)),Be(),v=Xt(v,C,ee,1,k,x,D,p,Wt,ur,null,ar),qe()),C[0]&20&&(ae=Re(k[4].filter(fr)),Be(),w=Xt(w,C,ce,1,k,ae,b,g,Wt,hr,null,ir),qe())},i(k){if(!N){for(let C=0;C<F.length;C+=1)Z(h[C]);for(let C=0;C<x.length;C+=1)Z(v[C]);for(let C=0;C<ae.length;C+=1)Z(w[C]);Z(q.$$.fragment,k),N=!0}},o(k){for(let C=0;C<h.length;C+=1)le(h[C]);for(let C=0;C<v.length;C+=1)le(v[C]);for(let C=0;C<w.length;C+=1)le(w[C]);le(q.$$.fragment,k),N=!1},d(k){k&&(T(e),T(a),T(o),T(f),T(m),T(S),T(j),T(L)),R&&R.d();for(let C=0;C<h.length;C+=1)h[C].d();for(let C=0;C<v.length;C+=1)v[C].d();for(let C=0;C<w.length;C+=1)w[C].d();Qe(q,k)}}}function lr(r){let e,t=r[2].name+"",s;return{c(){e=O("h1"),s=Ee(t),this.h()},l(i){e=A(i,"H1",{class:!0});var n=B(e);s=Se(n,t),n.forEach(T),this.h()},h(){y(e,"class","editing svelte-c9q9wy")},m(i,n){W(i,e,n),_(e,s)},p(i,n){n[0]&4&&t!==(t=i[2].name+"")&&Pe(s,t)},d(i){i&&T(e)}}}function cr(r,e){let t,s,i;return s=new Ui({props:{team:e[34],maxHealth:e[7]}}),{key:r,first:null,c(){t=wt(),We(s.$$.fragment),this.h()},l(n){t=wt(),Xe(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,a){W(n,t,a),Ye(s,n,a),i=!0},p(n,a){e=n;const o={};a[0]&32&&(o.team=e[34]),a[0]&128&&(o.maxHealth=e[7]),s.$set(o)},i(n){i||(Z(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Qe(s,n)}}}function ur(r,e){let t,s,i;return s=new Rr({props:{challenge:e[28],isActive:e[31]}}),{key:r,first:null,c(){t=wt(),We(s.$$.fragment),this.h()},l(n){t=wt(),Xe(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,a){W(n,t,a),Ye(s,n,a),i=!0},p(n,a){e=n;const o={};a[0]&16&&(o.challenge=e[28]),a[0]&21&&(o.isActive=e[31]),s.$set(o)},i(n){i||(Z(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Qe(s,n)}}}function hr(r,e){let t,s,i;return s=new Rr({props:{challenge:e[28],isActive:e[2].isRevealed}}),{key:r,first:null,c(){t=wt(),We(s.$$.fragment),this.h()},l(n){t=wt(),Xe(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,a){W(n,t,a),Ye(s,n,a),i=!0},p(n,a){e=n;const o={};a[0]&16&&(o.challenge=e[28]),a[0]&4&&(o.isActive=e[2].isRevealed),s.$set(o)},i(n){i||(Z(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Qe(s,n)}}}function _a(r){let e,t,s,i;const n=[pa,ma],a=[];function o(l,c){return l[2]&&l[5]&&l[4]&&l[8]&&l[3]?0:1}return t=o(r),s=a[t]=n[t](r),{c(){e=O("div"),s.c(),this.h()},l(l){e=A(l,"DIV",{class:!0,style:!0});var c=B(e);s.l(c),c.forEach(T),this.h()},h(){y(e,"class","frame svelte-c9q9wy"),pe(e,"background-image","linear-gradient(to top right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%), url('images/Wide Background.jpg')"),pe(e,"cursor","url('images/interface/Scimitar.png'), auto")},m(l,c){W(l,e,c),a[t].m(e,null),r[14](e),i=!0},p(l,c){let u=t;t=o(l),t===u?a[t].p(l,c):(Be(),le(a[u],1,1,()=>{a[u]=null}),qe(),s=a[t],s?s.p(l,c):(s=a[t]=n[t](l),s.c()),Z(s,1),s.m(e,null))},i(l){i||(Z(s),i=!0)},o(l){le(s),i=!1},d(l){l&&T(e),a[t].d(),r[14](null)}}}const ds=8,fs=16;function va(){const r=document.createElement("style");r.textContent=`
			::-webkit-scrollbar {
				/* height: 12px; */
				width: 16px;
				background: #000;
			}

			::-webkit-scrollbar-thumb {
				background: url('images/interface/Scroll Bar.png');
				border-radius: 4px;
				border: solid black 1px;
				background-size: contain;
				image-rendering: pixelated;
				background-repeat: repeat;
			}

			::-webkit-scrollbar-track {
				background: url('images/interface/Scroll Bar Track.png');
				background-size: contain;
				image-rendering: pixelated;
				background-repeat: repeat;
			}

			::-webkit-scrollbar-button:single-button:vertical:decrement {
				background: url('images/interface/Scroll Bar Up.png');
				width: 16px;
				height: 16px;
				background-size: cover;
				image-rendering: pixelated;
				background-repeat: no-repeat;
			}
			::-webkit-scrollbar-button:single-button:vertical:increment {
				width: 16px;
				height: 16px;
				background: url('images/interface/Scroll Bar Down.png');
				background-size: cover;
				image-rendering: pixelated;
				background-repeat: no-repeat;
			}
		`,document.head.appendChild(r)}const dr=r=>r.type==="main",fr=r=>r.type==="bonus";function ya(r,e,t){let s,i,n,a,o,l,c,u,h;Q(r,Me,E=>t(1,n=E)),Q(r,at,E=>t(8,a=E)),Q(r,ot,E=>t(2,o=E)),Q(r,_t,E=>t(3,l=E)),Q(r,Pt,E=>t(4,c=E)),Q(r,it,E=>t(5,u=E)),Q(r,yt,E=>t(15,h=E));const d=[1,2,3,4,5,6,10,11,15,16,20,21,22,23,24,25],f=[7,8,9,12,14,17,18,19],m=[13];let p;Nr(async()=>{v(),D(),S(),j(),I(),await U().then(()=>P()).then(()=>g()).then(()=>w()).then(()=>b()).then(()=>{va(),JSON.parse(localStorage.getItem("tournKey"))===o.id?se(Me,n=!0,n):se(Me,n=!1,n),a.length<1&&L({tournament:o.id,text:"Welcome to the tournament!",type:"notification",sender:"System"})}).catch(E=>{console.error("An error occurred:",E)})});function v(){he.channel("tournament_channel").on("postgres_changes",{event:"*",schema:"public",table:"tournaments"},E=>{switch(console.log("payload",E),E.eventType){case"UPDATE":se(ot,o=E.new,o);break}}).subscribe()}function D(){he.channel("teams_channel").on("postgres_changes",{event:"*",schema:"public",table:"teams"},E=>{switch(E.eventType){case"INSERT":console.log("new",E.new),se(it,u=[...u,E.new],u);break;case"DELETE":console.log("old",E.old),se(it,u=u.filter(x=>x.id!==E.old.id),u);break}}).subscribe()}function S(){he.channel("challenges_channel").on("postgres_changes",{event:"*",schema:"public",table:"challenges"},E=>{switch(E.eventType){case"INSERT":console.log("new",E.new),se(Pt,c=[...c,E.new],c);break;case"DELETE":console.log("old",E.old),se(Pt,c=c.filter(x=>x.id!==E.old.id),c);break}}).subscribe()}function j(){he.channel("completions_channel").on("postgres_changes",{event:"*",schema:"public",table:"completions"},E=>{switch(E.eventType){case"INSERT":se(_t,l=[...l,E.new],l);break;case"DELETE":se(_t,l=l.filter(x=>x.id!==E.old.id),l);break}}).subscribe()}function I(){he.channel("messages_channel").on("postgres_changes",{event:"*",schema:"public",table:"messages"},E=>{switch(E.eventType){case"INSERT":se(at,a=[...a,E.new],a);break;case"DELETE":se(at,a=a.filter(x=>x.id!==E.old.id),a);break}}).subscribe()}async function U(){const{data:E,error:x}=await he.from("tournaments").select("*").eq("id","f1c04b40-4faa-43f9-b058-bfc1db35d388");if(x)return console.error("Error fetching tournament",x),{status:500,error:"Could not fetch tournament"};se(ot,o=E[0],o)}async function P(){const{data:E,error:x}=await he.from("teams").select("*").eq("tournament",o.id);if(x)return console.error("Error fetching teams",x),{status:500,error:"Could not fetch teams"};se(it,u=E??[],u)}async function g(){const{data:E,error:x}=await he.from("challenges").select("*").eq("tournament",o.id);if(x)return console.error("Error fetching challenges",x),{status:500,error:"Could not fetch challenges"};se(Pt,c=E??[],c)}async function w(){const{data:E,error:x}=await he.from("completions").select("*").eq("tournament",o.id);if(x)return console.error("Error fetching completions",x),{status:500,error:"Could not fetch completions"};se(_t,l=E??[],l)}async function b(){const{data:E,error:x}=await he.from("messages").select("*").eq("tournament",o.id);if(x)return console.error("Error fetching messages",x),{status:500,error:"Could not fetch messages"};se(at,a=E??[],a)}async function L(E){if(!n||a.find(ee=>E.text===ee.text))return;const{error:x}=await he.from("messages").insert(E);if(x)return console.error("Error adding message",x),{status:500,error:"Could not add message"}}async function q(E){if(!n)return;const{error:x}=await he.from("messages").delete().eq("text",E.text);if(x)return console.error("Error removing message",x),{status:500,error:"Could not remove message"}}async function N(){ga.toPng(p).then(function(E){let x=document.createElement("a");x.download="my-image-name.png",x.href=E,document.body.appendChild(x),x.click(),document.body.removeChild(x)}).catch(function(E){console.error("oops, something went wrong!",E)})}function R(){se(Me,n=!1,n),localStorage.removeItem("tournKey")}function F(E){mr[E?"unshift":"push"](()=>{p=E,t(6,p)})}return r.$$.update=()=>{if(r.$$.dirty[0]&16&&t(7,s=c.reduce((E,x)=>E+x.points,0)),r.$$.dirty[0]&24&&t(0,i=c.filter(E=>l.find(x=>x.challenge===E.id)&&E.type==="main").length),r.$$.dirty[0]&5&&o)switch(!0){case i<ds:q({tournament:o.id,text:"Outer Ring Unlocked",type:"notification",sender:"System"}),q({tournament:o.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"});break;case(i>=ds&&i<fs):L({tournament:o.id,text:"Outer Ring Unlocked",type:"notification",sender:"System"}),q({tournament:o.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"});break;case i>=fs:L({tournament:o.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"})}r.$$.dirty[0]&34&&(n?se(yt,h=u[0],h):se(yt,h=null,h))},[i,n,o,l,c,u,p,s,a,d,f,m,N,R,F]}class Ta extends Je{constructor(e){super(),Ke(this,e,ya,_a,Ge,{},null,[-1,-1])}}export{Ta as P,Sa as _,da as g};
