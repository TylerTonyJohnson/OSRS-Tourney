import{r as Vt,T as js,H as Dr,s as Je,e as O,d as J,t as Ee,f as A,h as B,l as G,j as Se,k as T,y,U as Oe,z as pe,m as W,o as _,p as Pe,n as xe,V as ge,W as ye,F as Et,q as Q,X as de,Y as se,Z as Lr,_ as Rs,$ as gr,a0 as Ur,A as mr,x as Nr,v as wt}from"./scheduler.B_M5xA-k.js";import{a as le,t as Z,S as Ge,i as Ke,b as We,d as Xe,m as Ye,g as Be,c as qe,f as gs,e as Qe,h as bt,j as pr}from"./index.8At0uzev.js";import{_ as ct}from"./preload-helper.D6kgxu3v.js";import{r as Mr,d as Br,w as $e}from"./index.DfSpG__o.js";function Re(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Wt(r,e){le(r,1,1,()=>{e.delete(r.key)})}function Xt(r,e,t,s,i,n,o,a,l,c,u,d){let h=r.length,f=n.length,m=h;const p={};for(;m--;)p[r[m].key]=m;const v=[],D=new Map,S=new Map,j=[];for(m=f;m--;){const g=d(i,n,m),w=t(g);let b=o.get(w);b?s&&j.push(()=>b.p(g,e)):(b=c(w,g),b.c()),D.set(w,v[m]=b),w in p&&S.set(w,Math.abs(m-p[w]))}const I=new Set,U=new Set;function P(g){Z(g,1),g.m(a,u),o.set(g.key,g),u=g.first,f--}for(;h&&f;){const g=v[f-1],w=r[h-1],b=g.key,L=w.key;g===w?(u=g.first,h--,f--):D.has(L)?!o.has(b)||I.has(b)?P(g):U.has(L)?h--:S.get(b)>S.get(L)?(U.add(b),P(g)):(I.add(L),h--):(l(w,o),h--)}for(;h--;){const g=r[h];D.has(g.key)||l(g,o)}for(;f;)P(v[f-1]);return Vt(j),v}async function qr(){}const Fr=!0,To=Object.freeze(Object.defineProperty({__proto__:null,load:qr,prerender:Fr},Symbol.toStringTag,{value:"Module"})),Hr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ct(()=>Promise.resolve().then(()=>xt),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class ms extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Vr extends ms{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zr extends ms{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Jr extends ms{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var os;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(os||(os={}));var Gr=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};class Kr{constructor(e,{headers:t={},customFetch:s,region:i=os.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Hr(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Gr(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:c}).catch(m=>{throw new Vr(m)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new zr(u);if(!u.ok)throw new Jr(u);let h=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),f;return h==="application/json"?f=yield u.json():h==="application/octet-stream"?f=yield u.blob():h==="text/event-stream"?f=u:h==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(i){return{data:null,error:i}}})}}var Wr=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},kt=Wr();const Xr=kt.fetch,ps=kt.fetch.bind(kt),_r=kt.Headers,Yr=kt.Request,Qr=kt.Response,xt=Object.freeze(Object.defineProperty({__proto__:null,Headers:_r,Request:Yr,Response:Qr,default:ps,fetch:Xr},Symbol.toStringTag,{value:"Module"}));class Zr extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class en{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ps:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,l;let c=null,u=null,d=null,h=n.status,f=n.statusText;if(n.ok){if(this.method!=="HEAD"){const D=await n.text();D===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=D:u=JSON.parse(D))}const p=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");p&&v&&v.length>1&&(d=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,h=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const p=await n.text();try{c=JSON.parse(p),Array.isArray(c)&&n.status===404&&(u=[],c=null,h=200,f="OK")}catch{n.status===404&&p===""?(h=204,f="No Content"):c={message:p}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,h=200,f="OK"),c&&this.shouldThrowOnError)throw new Zr(c)}return{error:c,data:u,count:d,status:h,statusText:f}});return this.shouldThrowOnError||(i=i.catch(n=>{var o,a,l;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}}class tn extends en{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:n=i}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const n=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:n=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class pt extends tn{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}class sn{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let n=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new pt({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new pt({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new pt({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new pt({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new pt({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const rn="1.15.2",nn={"X-Client-Info":`postgrest-js/${rn}`};class _s{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},nn),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new sn(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new _s(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;s||i?(o=s?"HEAD":"GET",Object.entries(t).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{a.searchParams.append(u,d)})):(o="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new pt({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const on="2.9.4",an={"X-Client-Info":`realtime-js/${on}`},ln="1.0.0",vr=1e4,cn=1e3;var vt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(vt||(vt={}));var Ce;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ce||(Ce={}));var je;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(je||(je={}));var as;(function(r){r.websocket="websocket"})(as||(as={}));var it;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(it||(it={}));class yr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class un{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+i));o=o+i;const l=s.decode(e.slice(o,o+n));o=o+n;const c=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Yt{constructor(e,t,s={},i=vr){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xs;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(xs||(xs={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,i,n,o),this.pendingDiffs.forEach(l=>{this.state=Ot.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ot.syncDiff(this.state,i,n,o),a())}),this.onJoin((i,n,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:o})}),this.onLeave((i,n,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(n,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=n[c];if(d){const h=u.map(v=>v.presence_ref),f=d.map(v=>v.presence_ref),m=u.filter(v=>f.indexOf(v.presence_ref)<0),p=d.filter(v=>h.indexOf(v.presence_ref)<0);m.length>0&&(a[c]=m),p.length>0&&(l[c]=p)}else a[c]=u}),this.syncDiff(n,{joins:a,leaves:l},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...h)}s(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var re;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(re||(re={}));const $s=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,o)=>(n[o]=hn(o,r,e,i),n),{})},hn=(r,e,t,s)=>{const i=e.find(a=>a.name===r),n=i==null?void 0:i.type,o=t[r];return n&&!s.includes(n)?wr(n,o):ls(o)},wr=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return mn(e,t)}switch(r){case re.bool:return dn(e);case re.float4:case re.float8:case re.int2:case re.int4:case re.int8:case re.numeric:case re.oid:return fn(e);case re.json:case re.jsonb:return gn(e);case re.timestamp:return pn(e);case re.abstime:case re.date:case re.daterange:case re.int4range:case re.int8range:case re.money:case re.reltime:case re.text:case re.time:case re.timestamptz:case re.timetz:case re.tsrange:case re.tstzrange:return ls(e);default:return ls(e)}},ls=r=>r,dn=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},fn=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},gn=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},mn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const o=r.slice(1,t);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>wr(e,a))}return r},pn=r=>typeof r=="string"?r.replace(" ","T"):r;var Ds;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ds||(Ds={}));var Ls;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(Ls||(Ls={}));var Us;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Us||(Us={}));class vs{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Yt(this,je.join,this.params,this.timeout),this.rejoinTimer=new yr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ce.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ce.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this._on(je.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new Ot(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const a={},l={broadcast:n,presence:o,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&i!==void 0?i:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const d=this.bindings.postgres_changes,h=(u=d==null?void 0:d.length)!==null&&u!==void 0?u:0,f=[];for(let m=0;m<h;m++){const p=d[m],{filter:{event:v,schema:D,table:S,filter:j}}=p,I=c&&c[m];if(I&&I.event===v&&I.schema===D&&I.table===S&&I.filter===j)f.push(Object.assign(Object.assign({},p),{id:I.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:o}=e,a={method:"POST",headers:{apikey:(s=this.socket.apiKey)!==null&&s!==void 0?s:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(i=t.timeout)!==null&&i!==void 0?i:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("error",()=>n("error")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ce.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(je.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const i=new Yt(this,je.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Yt(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=je;if(s&&[a,l,c,u].indexOf(o)>=0&&s!==this._joinRef())return;let h=this._onMessage(o,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var m,p,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(p=f.filter)===null||p===void 0?void 0:p.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(f=>f.callback(h,s)):(n=this.bindings[o])===null||n===void 0||n.filter(f=>{var m,p,v,D,S,j;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const I=f.id,U=(m=f.filter)===null||m===void 0?void 0:m.event;return I&&((p=t.ids)===null||p===void 0?void 0:p.includes(I))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const I=(S=(D=f==null?void 0:f.filter)===null||D===void 0?void 0:D.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return I==="*"||I===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:p,table:v,commit_timestamp:D,type:S,errors:j}=m;h=Object.assign(Object.assign({},{schema:p,table:v,commit_timestamp:D,eventType:S,new:{},old:{},errors:j}),this._getPayloadRecords(m))}f.callback(h,s)})}_isClosed(){return this.state===Ce.closed}_isJoined(){return this.state===Ce.joined}_isJoining(){return this.state===Ce.joining}_isLeaving(){return this.state===Ce.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&vs.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(je.close,{},e)}_onError(e){this._on(je.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ce.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=$s(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=$s(e.columns,e.old_record)),t}}const _n=()=>{},vn=typeof WebSocket<"u";class yn{constructor(e,t){var s;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=an,this.params={},this.timeout=vr,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=_n,this.conn=null,this.sendBuffer=[],this.serializer=new un,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>ct(()=>Promise.resolve().then(()=>xt),void 0,import.meta.url).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${as.websocket}`,t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,o)=>o(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new yr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(vn){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new wn(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),ct(()=>import("./browser.PGI6G3ng.js").then(e=>e.b),[],import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case vt.connecting:return it.Connecting;case vt.open:return it.Open;case vt.closing:return it.Closing;default:return it.Closed}}isConnected(){return this.connectionState()===it.Open}channel(e,t={config:{}}){const s=new vs(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:n}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(je.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ln}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:n,ref:o}=t;(o&&o===this.pendingHeartbeatRef||i===(n==null?void 0:n.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${i} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(s)).forEach(a=>a._trigger(i,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(je.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(cn,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class wn{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=vt.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ys extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function we(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class bn extends ys{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ns extends ys{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var kn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};const br=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ct(()=>Promise.resolve().then(()=>xt),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},En=()=>kn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ct(()=>Promise.resolve().then(()=>xt),void 0,import.meta.url)).Response:Response});var St=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};const Qt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Sn=(r,e)=>St(void 0,void 0,void 0,function*(){const t=yield En();r instanceof t?r.json().then(s=>{e(new bn(Qt(s),r.status||500))}).catch(s=>{e(new Ns(Qt(s),s))}):e(new Ns(Qt(r),r))}),Tn=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};function zt(r,e,t,s,i,n){return St(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Tn(e,s,i,n)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Sn(l,a))})})}function cs(r,e,t,s){return St(this,void 0,void 0,function*(){return zt(r,"GET",e,t,s)})}function Ve(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"POST",e,s,i,t)})}function Cn(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"PUT",e,s,i,t)})}function kr(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"DELETE",e,s,i,t)})}var Ae=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};const Pn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ms={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class On{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=br(i)}uploadOrUpdate(e,t,s,i){return Ae(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},Ms),i),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",o.cacheControl)):(n=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),d=yield u.json();return u.ok?{data:{path:l,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(n){if(we(n))return{data:null,error:n};throw n}})}upload(e,t,s){return Ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return Ae(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Ms.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",c.cacheControl)):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),h=yield d.json();return d.ok?{data:{path:n,fullPath:h.Key},error:null}:{data:null,error:h}}catch(l){if(we(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return Ae(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const s=yield Ve(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),i=new URL(this.url+s.url),n=i.searchParams.get("token");if(!n)throw new ys("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}update(e,t,s){return Ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}copy(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:{path:(yield Ve(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,s){return Ae(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield Ve(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(i){if(we(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return Ae(this,void 0,void 0,function*(){try{const i=yield Ve(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(i){if(we(i))return{data:null,error:i};throw i}})}download(e,t){return Ae(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield cs(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(we(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${c}`)}}}remove(e){return Ae(this,void 0,void 0,function*(){try{return{data:yield kr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}list(e,t,s){return Ae(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Pn),t),{prefix:e||""});return{data:yield Ve(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(we(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const An="2.5.5",In={"X-Client-Info":`storage-js/${An}`};var ft=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};class jn{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},In),t),this.fetch=br(s)}listBuckets(){return ft(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(we(e))return{data:null,error:e};throw e}})}getBucket(e){return ft(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ft(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ft(this,void 0,void 0,function*(){try{return{data:yield Cn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(we(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ft(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ft(this,void 0,void 0,function*(){try{return{data:yield kr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(we(t))return{data:null,error:t};throw t}})}}class Rn extends jn{constructor(e,t={},s){super(e,t,s)}from(e){return new On(this.url,this.headers,e,this.fetch)}}const xn="2.42.5";let Ct="";typeof Deno<"u"?Ct="deno":typeof document<"u"?Ct="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ct="react-native":Ct="node";const $n={"X-Client-Info":`supabase-js-${Ct}/${xn}`},Dn={headers:$n},Ln={schema:"public"},Un={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Nn={};var Mn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};const Bn=r=>{let e;return r?e=r:typeof fetch>"u"?e=ps:e=fetch,(...t)=>e(...t)},qn=()=>typeof Headers>"u"?_r:Headers,Fn=(r,e,t)=>{const s=Bn(t),i=qn();return(n,o)=>Mn(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:r;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(n,Object.assign(Object.assign({},o),{headers:c}))})};function Hn(r){return r.replace(/\/$/,"")}function Vn(r,e){const{db:t,auth:s,realtime:i,global:n}=r,{db:o,auth:a,realtime:l,global:c}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),n)}}const Er="2.63.1",zn="http://localhost:9999",Jn="supabase.auth.token",Gn={"X-Client-Info":`gotrue-js/${Er}`},Bs=10,us="X-Supabase-Api-Version",Sr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Kn(r){return Math.round(Date.now()/1e3)+r}function Wn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Ie=()=>typeof document<"u",st={tested:!1,writable:!1},At=()=>{if(!Ie())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(st.tested)return st.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),st.tested=!0,st.writable=!0}catch{st.tested=!0,st.writable=!1}return st.writable};function Zt(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const Tr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ct(()=>Promise.resolve().then(()=>xt),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Xn=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Cr=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Bt=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},es=async(r,e)=>{await r.removeItem(e)};function Yn(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,i,n,o,a,l,c,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)o=e.indexOf(r.charAt(u++)),a=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),s=o<<2|a>>4,i=(a&15)<<4|l>>2,n=(l&3)<<6|c,t=t+String.fromCharCode(s),l!=64&&i!=0&&(t=t+String.fromCharCode(i)),c!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class Jt{constructor(){this.promise=new Jt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Jt.promiseConstructor=Promise;function qs(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(Yn(s))}async function Qn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Zn(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await r(n);if(!e(n,null,o)){s(o);return}}catch(o){if(!e(n,o)){i(o);return}}})()})}function ei(r){return("0"+r.toString(16)).substr(-2)}function ti(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,ei).join("")}async function si(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}function ri(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ni(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await si(r);return ri(t)}async function gt(r,e,t=!1){const s=ti();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await Cr(r,`${e}-code-verifier`,i);const n=await ni(s);return[n,s===n?"plain":"s256"]}const ii=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oi(r){const e=r.headers.get(us);if(!e||!e.match(ii))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class ws extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function K(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class ai extends ws{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function li(r){return K(r)&&r.name==="AuthApiError"}class Pr extends ws{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ut extends ws{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class rt extends ut{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ts extends ut{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qt extends ut{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends ut{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Fs extends ut{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hs extends ut{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ss(r){return K(r)&&r.name==="AuthRetryableFetchError"}class Hs extends ut{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var ci=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};const nt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ui=[502,503,504];async function Vs(r){var e;if(!Xn(r))throw new hs(nt(r),0);if(ui.includes(r.status))throw new hs(nt(r),r.status);let t;try{t=await r.json()}catch(n){throw new Pr(nt(n),n)}let s;const i=oi(r);if(i&&i.getTime()>=Sr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Hs(nt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new Hs(nt(t),r.status,t.weak_password.reasons);throw new ai(nt(t),r.status||500,s)}const hi=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function X(r,e,t,s){var i;const n=Object.assign({},s==null?void 0:s.headers);n[us]||(n[us]=Sr["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const o=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await di(r,e,t+a,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function di(r,e,t,s,i,n){const o=hi(e,s,i,n);let a;try{a=await r(t,Object.assign(Object.assign({},o),{cache:"no-store"}))}catch(l){throw console.error(l),new hs(nt(l),0)}if(a.ok||await Vs(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await Vs(l)}}function He(r){var e;let t=null;pi(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Kn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function zs(r){const e=He(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function ze(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function fi(r){return{data:r,error:null}}function gi(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,o=ci(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function mi(r){return r}function pi(r){return r.access_token&&r.refresh_token&&r.expires_in}var _i=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};class vi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Tr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await X(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await X(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ze})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=_i(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await X(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:gi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(K(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await X(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ze})}catch(t){if(K(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await X(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:mi});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(K(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await X(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ze})}catch(t){if(K(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await X(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ze})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await X(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ze})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await X(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(K(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await X(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(K(t))return{data:null,error:t};throw t}}}const yi={getItem:r=>At()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{At()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{At()&&globalThis.localStorage.removeItem(r)}};function Js(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function wi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const mt={debug:!!(globalThis&&At()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Or extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bi extends Or{}async function ki(r,e,t){mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),mt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new bi(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(mt.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}wi();const Ei={url:zn,storageKey:Jn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Gn,flowType:"implicit",debug:!1},Tt=30*1e3,Gs=3;async function Ks(r,e,t){return await t()}class jt{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=jt.nextInstanceID,jt.nextInstanceID+=1,this.instanceID>0&&Ie()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Ei),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new vi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Tr(i.fetch),this.lock=i.lock||Ks,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,i.lock?this.lock=i.lock:Ie()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ki:this.lock=Ks,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:At()?this.storage=yi:(this.memoryStorage={},this.storage=Js(this.memoryStorage)):(this.memoryStorage={},this.storage=Js(this.memoryStorage)),Ie()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Er}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=Ie()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),(s==null?void 0:s.message)==="Identity is already linked"||(s==null?void 0:s.message)==="Identity is already linked to another user"?{error:s}:(await this._removeSession(),{error:s});const{session:i,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return K(e)?{error:e}:{error:new Pr("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{await this._removeSession();const n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:He}),{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(K(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,i;try{await this._removeSession();let n;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await gt(this.storage,this.storageKey)),n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:m},xform:He})}else if("phone"in e){const{phone:u,password:d,options:h}=e;n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(i=h==null?void 0:h.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:He})}else throw new qt("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(K(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:n,password:o,options:a}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:zs})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:zs})}else throw new qt("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ts}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/"),{data:n,error:o}=await X(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:He});return await es(this.storage,`${this.storageKey}-code-verifier`),o?{data:{user:null,session:null,redirectType:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new ts}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:o})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:s,token:i,access_token:n,nonce:o}=e,a=await X(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:He}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ts}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,n,o;try{if(await this._removeSession(),"email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await gt(this.storage,this.storageKey));const{error:d}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new qt("You must provide either an email or phone number.")}catch(a){if(K(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await X(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:He});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(K(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{await this._removeSession();let n=null,o=null;return this.flowType==="pkce"&&([n,o]=await gt(this.storage,this.storageKey)),await X(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:fi})}catch(n){if(K(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new rt;const{error:i}=await X(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(K(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:o}=await X(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:o,error:a}=await X(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new qt("You must provide either an email or phone number and a type")}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s)return this.storage.isServer&&(e=new Proxy(e,{get(a,l,c){return l==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(a,l,c)}})),{data:{session:e},error:null};const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ze}):await this._useSession(async t=>{var s,i,n;const{data:o,error:a}=t;if(a)throw a;return!((s=o.session)===null||s===void 0)&&s.access_token?await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:ze}):{data:{user:null},error:new rt}})}catch(t){if(K(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new rt;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await gt(this.storage,this.storageKey));const{data:c,error:u}=await X(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:ze});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(K(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return qs(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new rt;const t=Date.now()/1e3;let s=t,i=!0,n=null;const o=qs(e.access_token);if(o.exp&&(s=o.exp,i=s<=t),i){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(K(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new rt;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(K(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!Ie())throw new Ft("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Ft("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Fs("Not a valid PKCE flow url.");const t=Zt(window.location.href);if(e){if(!t.code)throw new Fs("No code detected.");const{data:S,error:j}=await this._exchangeCodeForSession(t.code);if(j)throw j;const I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:S.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ft(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!n||!a||!o||!c)throw new Ft("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const f=h-u;f*1e3<=Tt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const m=h-d;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,h,u);const{data:p,error:v}=await this._getUser(n);if(v)throw v;const D={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:d,expires_at:h,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:D,redirectType:t.type},error:null}}catch(t){if(K(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Zt(window.location.href);return!!(Ie()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Zt(window.location.href),t=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{error:n};const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(li(a)&&(a.status===404||a.status===401)))return{error:a}}return e!=="others"&&(await this._removeSession(),await es(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Wn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await gt(this.storage,this.storageKey,!0));try{return await X(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(K(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(K(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var o,a,l,c,u;const{data:d,error:h}=n;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await X(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return Ie()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(K(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:o}=t;if(o)throw o;return await X(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(K(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Zn(async i=>(i>0&&await Qn(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await X(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:He})),(i,n)=>{const o=200*Math.pow(2,i);return n&&ss(n)&&Date.now()+o-s<Tt})}catch(s){if(this._debug(t,"error",s),K(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Ie()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Bt(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<i+Bs;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Bs}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),ss(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new rt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Jt;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new rt;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(i,"error",n),K(n)){const o={session:null,error:n};return ss(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await Cr(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await es(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ie()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Tt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/Tt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Tt}ms, refresh threshold is ${Gs} ticks`),i<=Gs&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Or)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ie()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,o]=await gt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await X(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(K(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:l}=await X(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(!((i=a==null?void 0:a.totp)===null||i===void 0)&&i.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(K(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(K(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(K(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:s,totp:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(i.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}}jt.nextInstanceID=0;const Si=jt;class Ti extends Si{constructor(e){super(e)}}var Ci=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{c(s.next(u))}catch(d){o(d)}}function l(u){try{c(s.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):i(u.value).then(a,l)}c((s=s.apply(r,e||[])).next())})};class Pi{constructor(e,t,s){var i,n,o,a,l,c,u,d;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const h=Hn(e);this.realtimeUrl=`${h}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${h}/auth/v1`,this.storageUrl=`${h}/storage/v1`,this.functionsUrl=`${h}/functions/v1`;const f=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,m={db:Ln,realtime:Nn,auth:Object.assign(Object.assign({},Un),{storageKey:f}),global:Dn},p=Vn(s??{},m);this.storageKey=(n=(i=p.auth)===null||i===void 0?void 0:i.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=(o=p.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((l=p.auth)!==null&&l!==void 0?l:{},this.headers,(c=p.global)===null||c===void 0?void 0:c.fetch),this.fetch=Fn(t,this._getAccessToken.bind(this),(u=p.global)===null||u===void 0?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new _s(`${h}/rest/v1`,{headers:this.headers,schema:(d=p.db)===null||d===void 0?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Kr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Rn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ci(this,void 0,void 0,function*(){const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:n,flowType:o,debug:a},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ti({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:o,debug:a,fetch:c})}_initRealtimeClient(e){return new yn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Oi=(r,e,t)=>new Pi(r,e,t),Ai="https://wypbvklzgwgrjmlnmfzg.supabase.co",Ii="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind5cGJ2a2x6Z3dncmptbG5tZnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI4NTY5MzcsImV4cCI6MjAyODQzMjkzN30.NCndBtOFVDpXc4GgbWIlEFsmBlH_p1OILPDv-RnitpU",he=Oi(Ai,Ii),lt=$e(),ot=$e([]),Pt=$e([]),_t=$e([]),at=$e([]),Ar=Mr({maxTeams:4,maxChallenges:25,pointDecrement:1,maxPointDecrement:2}),yt=$e(null),rs=$e(null),Me=$e(!1),It=$e(!1),Ws=$e(!1),ji=Br([ot,Pt,_t,Ar],([r,e,t,s])=>r.map(i=>({team:i.id,points:t.filter(n=>n.team===i.id).map(n=>n.challenge).map(n=>e.find(o=>o.id===n).points-s.pointDecrement*(e.find(o=>o.id===n).type==="main"?1:0)*Math.min(t.filter(o=>o.challenge===n).sort((o,a)=>o.created_at-a.created_at).findIndex(o=>o.team===i.id),s.maxPointDecrement)).reduce((n,o)=>n+o,0)})).sort((i,n)=>n.points-i.points));function Ir(r){const e=r-1;return e*e*e+1}function Ht(r,{delay:e=0,duration:t=400,easing:s=Dr}={}){const i=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:s,css:n=>`opacity: ${n*i}`}}function jr(r,{delay:e=0,duration:t=400,easing:s=Ir,x:i=0,y:n=0,opacity:o=0}={}){const a=getComputedStyle(r),l=+a.opacity,c=a.transform==="none"?"":a.transform,u=l*(1-o),[d,h]=js(i),[f,m]=js(n);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${c} translate(${(1-p)*d}${h}, ${(1-p)*f}${m});
			opacity: ${l-u*v}`}}function Rt(r,{delay:e=0,duration:t=400,easing:s=Ir,start:i=0,opacity:n=0}={}){const o=getComputedStyle(r),a=+o.opacity,l=o.transform==="none"?"":o.transform,c=1-i,u=a*(1-n);return{delay:e,duration:t,easing:s,css:(d,h)=>`
			transform: ${l} scale(${1-c*h});
			opacity: ${a-u*h}
		`}}function Ri(r){let e,t,s,i,n,o,a,l,c,u,d,h;return{c(){e=O("div"),t=O("img"),i=J(),n=O("img"),a=J(),l=O("img"),u=J(),d=O("span"),h=Ee(r[0]),this.h()},l(f){e=A(f,"DIV",{class:!0});var m=B(e);t=A(m,"IMG",{class:!0,src:!0,alt:!0}),i=G(m),n=A(m,"IMG",{class:!0,style:!0,src:!0,alt:!0}),a=G(m),l=A(m,"IMG",{class:!0,src:!0,alt:!0}),u=G(m),d=A(m,"SPAN",{class:!0,style:!0});var p=B(d);h=Se(p,r[0]),p.forEach(T),m.forEach(T),this.h()},h(){y(t,"class","empty-orb svelte-12u782k"),Oe(t.src,s="images/interface/Empty Orb.png")||y(t,"src",s),y(t,"alt","points"),y(n,"class","full-orb svelte-12u782k"),pe(n,"--percentage",(1-r[1])*100+"%"),Oe(n.src,o="images/interface/Full Orb.png")||y(n,"src",o),y(n,"alt","points"),y(l,"class","heart svelte-12u782k"),Oe(l.src,c="images/interface/Point Counter.png")||y(l,"src",c),y(l,"alt","points"),y(d,"class","points svelte-12u782k"),pe(d,"color","hsl("+r[2]+", 100%, 50%)"),y(e,"class","frame svelte-12u782k")},m(f,m){W(f,e,m),_(e,t),_(e,i),_(e,n),_(e,a),_(e,l),_(e,u),_(e,d),_(d,h)},p(f,[m]){m&2&&pe(n,"--percentage",(1-f[1])*100+"%"),m&1&&Pe(h,f[0]),m&4&&pe(d,"color","hsl("+f[2]+", 100%, 50%)")},i:xe,o:xe,d(f){f&&T(e)}}}function xi(r,e,t){let s,i,{currentHealth:n=99}=e,{maxHealth:o=100}=e;return r.$$set=a=>{"currentHealth"in a&&t(0,n=a.currentHealth),"maxHealth"in a&&t(3,o=a.maxHealth)},r.$$.update=()=>{r.$$.dirty&9&&t(1,s=n/o),r.$$.dirty&2&&t(2,i=s*120)},[n,s,i,o]}class $i extends Ge{constructor(e){super(),Ke(this,e,xi,Ri,Je,{currentHealth:0,maxHealth:3})}}function Xs(r){let e,t='<img class="crown svelte-36cez0" src="images/Yellow Hat.png" alt="Crown"/>',s,i;return{c(){e=O("div"),e.innerHTML=t,this.h()},l(n){e=A(n,"DIV",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-w11w9r"&&(e.innerHTML=t),this.h()},h(){y(e,"class","crown-container svelte-36cez0")},m(n,o){W(n,e,o),i=!0},i(n){i||(n&&Et(()=>{i&&(s||(s=bt(e,Rt,{},!0)),s.run(1))}),i=!0)},o(n){n&&(s||(s=bt(e,Rt,{},!1)),s.run(0)),i=!1},d(n){n&&T(e),n&&s&&s.end()}}}function Di(r){let e,t,s,i,n,o,a,l,c,u,d,h,f=r[0].name+"",m,p,v,D,S,j,I;u=new $i({props:{maxHealth:r[1],currentHealth:r[2]}});let U=r[3]&&Xs();return{c(){e=O("button"),t=O("div"),s=J(),i=O("div"),n=J(),o=O("div"),a=O("img"),c=J(),We(u.$$.fragment),d=J(),h=O("div"),m=Ee(f),p=J(),U&&U.c(),this.h()},l(P){e=A(P,"BUTTON",{class:!0});var g=B(e);t=A(g,"DIV",{class:!0}),B(t).forEach(T),s=G(g),i=A(g,"DIV",{class:!0,style:!0}),B(i).forEach(T),n=G(g),o=A(g,"DIV",{class:!0});var w=B(o);a=A(w,"IMG",{class:!0,src:!0,alt:!0}),c=G(w),Xe(u.$$.fragment,w),d=G(w),h=A(w,"DIV",{class:!0});var b=B(h);m=Se(b,f),b.forEach(T),w.forEach(T),p=G(g),U&&U.l(g),g.forEach(T),this.h()},h(){y(t,"class","fade svelte-36cez0"),y(i,"class","border svelte-36cez0"),pe(i,"border-image","url('images/interface/Message Border.png') 8 / 8px repeat"),y(a,"class","banner svelte-36cez0"),Oe(a.src,l="images/interface/Banner "+r[0].name+".png")||y(a,"src",l),y(a,"alt","Asgarnia Banner"),y(h,"class","name svelte-36cez0"),y(o,"class","content svelte-36cez0"),y(e,"class","team svelte-36cez0"),e.disabled=v=!r[4],ge(e,"selected",r[0]===r[5]),ge(e,"editable",r[4])},m(P,g){W(P,e,g),_(e,t),_(e,s),_(e,i),_(e,n),_(e,o),_(o,a),_(o,c),Ye(u,o,null),_(o,d),_(o,h),_(h,m),_(e,p),U&&U.m(e,null),S=!0,j||(I=[ye(e,"click",r[6]),ye(e,"dblclick",r[7])],j=!0)},p(P,[g]){(!S||g&1&&!Oe(a.src,l="images/interface/Banner "+P[0].name+".png"))&&y(a,"src",l);const w={};g&2&&(w.maxHealth=P[1]),g&4&&(w.currentHealth=P[2]),u.$set(w),(!S||g&1)&&f!==(f=P[0].name+"")&&Pe(m,f),P[3]?U?g&8&&Z(U,1):(U=Xs(),U.c(),Z(U,1),U.m(e,null)):U&&(Be(),le(U,1,1,()=>{U=null}),qe()),(!S||g&16&&v!==(v=!P[4]))&&(e.disabled=v),(!S||g&33)&&ge(e,"selected",P[0]===P[5]),(!S||g&16)&&ge(e,"editable",P[4])},i(P){S||(Z(u.$$.fragment,P),Z(U),P&&(D||Et(()=>{D=gs(e,jr,{x:-100,duration:300}),D.start()})),S=!0)},o(P){le(u.$$.fragment,P),le(U),S=!1},d(P){P&&T(e),Qe(u),U&&U.d(),j=!1,Vt(I)}}}function Li(r,e,t){let s,i,n,o,a,l;Q(r,rs,f=>t(9,n=f)),Q(r,Me,f=>t(4,o=f)),Q(r,yt,f=>t(5,a=f)),Q(r,ji,f=>t(8,l=f));let{team:c}=e,{maxHealth:u}=e;function d(){o&&(se(yt,a=c,a),se(rs,n=null,n))}function h(){o&&(console.log("isolating team"),se(rs,n=c,n))}return r.$$set=f=>{"team"in f&&t(0,c=f.team),"maxHealth"in f&&t(1,u=f.maxHealth)},r.$$.update=()=>{var f;r.$$.dirty&257&&t(2,s=((f=l.find(m=>m.team===c.id))==null?void 0:f.points)??0),r.$$.dirty&260&&t(3,i=l[0].points===s&&s>0)},[c,u,s,i,o,a,d,h,l]}class Ui extends Ge{constructor(e){super(),Ke(this,e,Li,Di,Je,{team:0,maxHealth:1})}}function Ys(r){let e,t,s,i,n,o,a,l,c,u=":",d,h,f,m,p,v=":",D,S,j;return{c(){e=O("div"),t=O("span"),s=Ee(r[5]),i=J(),n=O("div"),o=O("span"),a=Ee(r[4]),l=J(),c=O("span"),c.textContent=u,d=J(),h=O("span"),f=Ee(r[3]),m=J(),p=O("span"),p.textContent=v,D=J(),S=O("span"),j=Ee(r[2]),this.h()},l(I){e=A(I,"DIV",{class:!0});var U=B(e);t=A(U,"SPAN",{class:!0});var P=B(t);s=Se(P,r[5]),P.forEach(T),i=G(U),n=A(U,"DIV",{class:!0});var g=B(n);o=A(g,"SPAN",{class:!0});var w=B(o);a=Se(w,r[4]),w.forEach(T),l=G(g),c=A(g,"SPAN",{"data-svelte-h":!0}),de(c)!=="svelte-5vnx5k"&&(c.textContent=u),d=G(g),h=A(g,"SPAN",{class:!0});var b=B(h);f=Se(b,r[3]),b.forEach(T),m=G(g),p=A(g,"SPAN",{"data-svelte-h":!0}),de(p)!=="svelte-5vnx5k"&&(p.textContent=v),D=G(g),S=A(g,"SPAN",{class:!0});var L=B(S);j=Se(L,r[2]),L.forEach(T),g.forEach(T),U.forEach(T),this.h()},h(){y(t,"class","days svelte-tm63ju"),y(o,"class","time svelte-tm63ju"),y(h,"class","time svelte-tm63ju"),y(S,"class","time svelte-tm63ju"),y(n,"class","time-container svelte-tm63ju"),y(e,"class","line-1 svelte-tm63ju")},m(I,U){W(I,e,U),_(e,t),_(t,s),_(e,i),_(e,n),_(n,o),_(o,a),_(n,l),_(n,c),_(n,d),_(n,h),_(h,f),_(n,m),_(n,p),_(n,D),_(n,S),_(S,j)},p(I,U){U&32&&Pe(s,I[5]),U&16&&Pe(a,I[4]),U&8&&Pe(f,I[3]),U&4&&Pe(j,I[2])},d(I){I&&T(e)}}}function Ni(r){let e,t,s,i,n=r[0]>0&&Ys(r);return{c(){e=O("div"),n&&n.c(),t=J(),s=O("div"),i=Ee(r[1]),this.h()},l(o){e=A(o,"DIV",{class:!0,style:!0});var a=B(e);n&&n.l(a),t=G(a),s=A(a,"DIV",{class:!0});var l=B(s);i=Se(l,r[1]),l.forEach(T),a.forEach(T),this.h()},h(){y(s,"class","line-2 svelte-tm63ju"),y(e,"class","frame svelte-tm63ju"),pe(e,"background-image","url('images/interface/Button Red.png')")},m(o,a){W(o,e,a),n&&n.m(e,null),_(e,t),_(e,s),_(s,i)},p(o,[a]){o[0]>0?n?n.p(o,a):(n=Ys(o),n.c(),n.m(e,t)):n&&(n.d(1),n=null),a&2&&Pe(i,o[1])},i:xe,o:xe,d(o){o&&T(e),n&&n.d()}}}function Mi(r,e,t){let s,i,n,o,a,l,c;Q(r,Me,p=>t(7,a=p)),Q(r,at,p=>t(8,l=p)),Q(r,lt,p=>t(6,c=p));let u,d="";const h={tournament:c.id,text:"Bingo Over",type:"completion",sender:"System"};async function f(p){if(console.log(l.some(D=>p.text===D.text)),!a||l.some(D=>p.text===D.text))return;const{error:v}=await he.from("messages").insert(p);if(v)return console.error("Error adding message",v),{status:500,error:"Could not add message"}}async function m(p){if(!a)return;const{error:v}=await he.from("messages").delete().eq("text",p.text);if(v)return console.error("Error removing message",v),{status:500,error:"Could not remove message"}}return r.$$.update=()=>{r.$$.dirty&64&&setInterval(()=>{const p=new Date;switch(!0){case p<new Date(c.startTime):t(1,d="To Start"),t(0,u=Math.abs(p-new Date(c.startTime))),m(h);break;case(p>new Date(c.startTime)&&p<new Date(c.endTime)):t(1,d="To End"),t(0,u=Math.abs(p-new Date(c.startTime))),m(h);break;case p>=new Date(c.endTime):t(1,d="Bingo Over"),t(0,u=0),f(h);break}},1e3),r.$$.dirty&1&&t(5,s=`${Math.floor(u/(1e3*60*60*24))}D`),r.$$.dirty&1&&t(4,i=`${Math.floor(u%(1e3*60*60*24)/(1e3*60*60)).toString().padStart(2,"0")}`),r.$$.dirty&1&&t(3,n=`${Math.floor(u%(1e3*60*60)/(1e3*60)).toString().padStart(2,"0")}`),r.$$.dirty&1&&t(2,o=`${Math.floor(u%(1e3*60)/1e3).toString().padStart(2,"0")}`)},[u,d,o,n,i,s,c]}class Bi extends Ge{constructor(e){super(),Ke(this,e,Mi,Ni,Je,{})}}function qi(r){let e,t,s=r[0].sender+"",i,n,o,a,l=r[0].text+"",c;return{c(){e=O("div"),t=O("div"),i=Ee(s),n=Ee(":"),o=J(),a=O("div"),c=Ee(l),this.h()},l(u){e=A(u,"DIV",{class:!0});var d=B(e);t=A(d,"DIV",{class:!0});var h=B(t);i=Se(h,s),n=Se(h,":"),h.forEach(T),o=G(d),a=A(d,"DIV",{class:!0});var f=B(a);c=Se(f,l),f.forEach(T),d.forEach(T),this.h()},h(){y(t,"class","sender svelte-6g3s81"),ge(t,"yellow",r[1].some(r[2])),ge(t,"green",r[0].type==="admin"),ge(t,"orange",r[0].sender==="System"),y(a,"class","text svelte-6g3s81"),ge(a,"green",r[0].type==="admin"),y(e,"class","message svelte-6g3s81")},m(u,d){W(u,e,d),_(e,t),_(t,i),_(t,n),_(e,o),_(e,a),_(a,c)},p(u,[d]){d&1&&s!==(s=u[0].sender+"")&&Pe(i,s),d&3&&ge(t,"yellow",u[1].some(u[2])),d&1&&ge(t,"green",u[0].type==="admin"),d&1&&ge(t,"orange",u[0].sender==="System"),d&1&&l!==(l=u[0].text+"")&&Pe(c,l),d&1&&ge(a,"green",u[0].type==="admin")},i:xe,o:xe,d(u){u&&T(e)}}}function Fi(r,e,t){let s;Q(r,ot,o=>t(1,s=o));let{message:i={sender:"Unknown",text:"Hello, World!"}}=e;const n=o=>o.name===i.sender;return r.$$set=o=>{"message"in o&&t(0,i=o.message)},[i,s,n]}class Hi extends Ge{constructor(e){super(),Ke(this,e,Fi,qi,Je,{message:0})}}var Vi=Object.defineProperty,zi=(r,e,t)=>e in r?Vi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ns=(r,e,t)=>(zi(r,typeof e!="symbol"?e+"":e,t),t);class Qs{constructor(e,t={}){ns(this,"src"),ns(this,"options"),ns(this,"howl"),this.src=e,this.options=t,this.create()}async create(){const{Howl:e}=await ct(()=>import("./howler.core-e669a980.DveT1YBT.js"),[],import.meta.url).then(n=>n.h),{loop:t,volume:s}=this.options,i=new e({src:this.src,loop:t||!1,volume:s||1,...this.options});this.howl=i}update(e=this.options){this.unload(),this.options=e,this.create()}destroy(){this.stop(),this.unload()}play(){this.howl.play()}stop(){this.howl.stop()}unload(){this.howl.unload()}}function Ji(r){let e,t,s,i="Are you sure you want to reset this tournament? This cannot be undone.",n,o,a="Reset",l,c,u,d;return{c(){e=O("div"),t=O("div"),s=O("div"),s.textContent=i,n=J(),o=O("button"),o.textContent=a,this.h()},l(h){e=A(h,"DIV",{class:!0});var f=B(e);t=A(f,"DIV",{class:!0});var m=B(t);s=A(m,"DIV",{class:!0,"data-svelte-h":!0}),de(s)!=="svelte-7z16sh"&&(s.textContent=i),n=G(m),o=A(m,"BUTTON",{class:!0,"data-svelte-h":!0}),de(o)!=="svelte-kx2upl"&&(o.textContent=a),m.forEach(T),f.forEach(T),this.h()},h(){y(s,"class","message"),y(o,"class","button svelte-10km69n"),y(t,"class","card svelte-10km69n"),y(e,"class","frame svelte-10km69n")},m(h,f){W(h,e,f),_(e,t),_(t,s),_(t,n),_(t,o),c=!0,u||(d=[ye(window,"keydown",r[1]),ye(o,"click",r[0]),ye(e,"click",Lr(r[2]))],u=!0)},p:xe,i(h){c||(h&&Et(()=>{c&&(l||(l=bt(e,Ht,{duration:200},!0)),l.run(1))}),c=!0)},o(h){h&&(l||(l=bt(e,Ht,{duration:200},!1)),l.run(0)),c=!1},d(h){h&&T(e),h&&l&&l.end(),u=!1,Vt(d)}}}function Gi(r,e,t){let s,i;Q(r,It,c=>t(3,s=c)),Q(r,lt,c=>t(4,i=c));async function n(){const{error:c}=await he.from("completions").delete().eq("tournament",i.id);if(se(It,s=!1,s),o(),c)return console.error("Error resetting challenges",c),{status:500,error:"Could not reset challenges"}}async function o(){const{error:c}=await he.from("messages").delete().eq("tournament",i.id);if(c)return console.error("Error resetting messages",c),{status:500,error:"Could not reset messages"}}function a(c){c.key==="Escape"&&l()}function l(){se(It,s=!1,s)}return[n,a,l]}class Ki extends Ge{constructor(e){super(),Ke(this,e,Gi,Ji,Je,{})}}function Zs(r,e,t){const s=r.slice();return s[23]=e[t],s}function er(r){let e,t;return e=new Ki({}),{c(){We(e.$$.fragment)},l(s){Xe(e.$$.fragment,s)},m(s,i){Ye(e,s,i),t=!0},i(s){t||(Z(e.$$.fragment,s),t=!0)},o(s){le(e.$$.fragment,s),t=!1},d(s){Qe(e,s)}}}function tr(r){let e,t;return e=new Hi({props:{message:r[23]}}),{c(){We(e.$$.fragment)},l(s){Xe(e.$$.fragment,s)},m(s,i){Ye(e,s,i),t=!0},p(s,i){const n={};i&64&&(n.message=s[23]),e.$set(n)},i(s){t||(Z(e.$$.fragment,s),t=!0)},o(s){le(e.$$.fragment,s),t=!1},d(s){Qe(e,s)}}}function sr(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){y(e,"class","dance svelte-10w2kpg"),Oe(e.src,t="images/Dance.gif")||y(e,"src",t),y(e,"alt","Dance")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Wi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){y(e,"class","off svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Xi(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){y(e,"class","on svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Yi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){y(e,"class","off svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Qi(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){y(e,"class","on svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function Zi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){y(e,"class","off svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function eo(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){y(e,"class","on svelte-10w2kpg")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function to(r){let e,t,s,i,n,o,a,l,c,u,d,h,f="Fensail:",m,p,v,D,S,j,I='<span class="name svelte-10w2kpg">Reveal</span>',U,P,g,w,b,L='<div class="line-1 svelte-10w2kpg"><span class="name svelte-10w2kpg">Snap</span></div>',q,N,R,F='<span class="name svelte-10w2kpg">Music</span>',E,$,ee,oe,ce,k='<span class="name svelte-10w2kpg">Vibe</span>',C,V,fe,ue,x,z='<span class="name svelte-10w2kpg">Reset</span>',Y,H,ne,_e,ht='<span class="name svelte-10w2kpg">Logout</span>',Fe,Te,ve,De,Ze,Gt,bs,me=r[7]&&er(),et=Re(r[6]),ae=[];for(let M=0;M<et.length;M+=1)ae[M]=tr(Zs(r,et,M));const $r=M=>le(ae[M],1,1,()=>{ae[M]=null});let be=r[4]&&sr();function ks(M,te){return M[3].isRevealed?Xi:Wi}let $t=ks(r),Le=$t(r);function Es(M,te){return M[2]?Qi:Yi}let Dt=Es(r),Ue=Dt(r);function Ss(M,te){return M[4]?eo:Zi}let Lt=Ss(r),Ne=Lt(r);return ve=new Bi({}),{c(){me&&me.c(),e=J(),t=O("div"),s=O("div"),i=O("div"),n=O("div");for(let M=0;M<ae.length;M+=1)ae[M].c();o=J(),be&&be.c(),a=J(),l=O("div"),c=O("img"),d=J(),h=O("span"),h.textContent=f,m=J(),p=O("input"),v=J(),D=O("div"),S=O("button"),j=O("div"),j.innerHTML=I,U=J(),P=O("div"),Le.c(),w=J(),b=O("button"),b.innerHTML=L,q=J(),N=O("button"),R=O("div"),R.innerHTML=F,E=J(),$=O("div"),Ue.c(),ee=J(),oe=O("button"),ce=O("div"),ce.innerHTML=k,C=J(),V=O("div"),Ne.c(),fe=J(),ue=O("button"),x=O("div"),x.innerHTML=z,H=J(),ne=O("button"),_e=O("div"),_e.innerHTML=ht,Te=J(),We(ve.$$.fragment),this.h()},l(M){me&&me.l(M),e=G(M),t=A(M,"DIV",{class:!0});var te=B(t);s=A(te,"DIV",{class:!0,style:!0});var ie=B(s);i=A(ie,"DIV",{class:!0});var tt=B(i);n=A(tt,"DIV",{class:!0});var Ts=B(n);for(let Kt=0;Kt<ae.length;Kt+=1)ae[Kt].l(Ts);Ts.forEach(T),o=G(tt),be&&be.l(tt),tt.forEach(T),a=G(ie),l=A(ie,"DIV",{class:!0});var dt=B(l);c=A(dt,"IMG",{class:!0,src:!0,alt:!0}),d=G(dt),h=A(dt,"SPAN",{class:!0,"data-svelte-h":!0}),de(h)!=="svelte-1w3y9cz"&&(h.textContent=f),m=G(dt),p=A(dt,"INPUT",{class:!0,type:!0}),dt.forEach(T),ie.forEach(T),v=G(te),D=A(te,"DIV",{class:!0});var ke=B(D);S=A(ke,"BUTTON",{class:!0,style:!0});var Ut=B(S);j=A(Ut,"DIV",{class:!0,"data-svelte-h":!0}),de(j)!=="svelte-5tg6go"&&(j.innerHTML=I),U=G(Ut),P=A(Ut,"DIV",{class:!0});var Cs=B(P);Le.l(Cs),Cs.forEach(T),Ut.forEach(T),w=G(ke),b=A(ke,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),de(b)!=="svelte-sugqyf"&&(b.innerHTML=L),q=G(ke),N=A(ke,"BUTTON",{class:!0,style:!0});var Nt=B(N);R=A(Nt,"DIV",{class:!0,"data-svelte-h":!0}),de(R)!=="svelte-1ar69di"&&(R.innerHTML=F),E=G(Nt),$=A(Nt,"DIV",{class:!0});var Ps=B($);Ue.l(Ps),Ps.forEach(T),Nt.forEach(T),ee=G(ke),oe=A(ke,"BUTTON",{class:!0,style:!0});var Mt=B(oe);ce=A(Mt,"DIV",{class:!0,"data-svelte-h":!0}),de(ce)!=="svelte-1xgdo1x"&&(ce.innerHTML=k),C=G(Mt),V=A(Mt,"DIV",{class:!0});var Os=B(V);Ne.l(Os),Os.forEach(T),Mt.forEach(T),fe=G(ke),ue=A(ke,"BUTTON",{class:!0,style:!0});var As=B(ue);x=A(As,"DIV",{class:!0,"data-svelte-h":!0}),de(x)!=="svelte-6vd44i"&&(x.innerHTML=z),As.forEach(T),H=G(ke),ne=A(ke,"BUTTON",{class:!0,style:!0});var Is=B(ne);_e=A(Is,"DIV",{class:!0,"data-svelte-h":!0}),de(_e)!=="svelte-1ich0qb"&&(_e.innerHTML=ht),Is.forEach(T),Te=G(ke),Xe(ve.$$.fragment,ke),ke.forEach(T),te.forEach(T),this.h()},h(){y(n,"class","messages svelte-10w2kpg"),y(i,"class","messages-container svelte-10w2kpg"),y(c,"class","icon svelte-10w2kpg"),Oe(c.src,u="images/interface/Chat Helmet.png")||y(c,"src",u),y(c,"alt","Ironman"),y(h,"class","input-name white text svelte-10w2kpg"),y(p,"class","input white text svelte-10w2kpg"),y(p,"type","text"),y(l,"class","input-container svelte-10w2kpg"),y(s,"class","chat-box svelte-10w2kpg"),pe(s,"border-image","url('images/interface/Message Border.png') 8 / 16px repeat"),y(j,"class","line-1 svelte-10w2kpg"),y(P,"class","line-2 svelte-10w2kpg"),y(S,"class","button svelte-10w2kpg"),S.disabled=g=!r[5],pe(S,"background-image","url('images/interface/Button Brown.png')"),y(b,"class","button svelte-10w2kpg"),pe(b,"background-image","url('images/interface/Button Brown.png')"),y(R,"class","line-1 svelte-10w2kpg"),y($,"class","line-2 svelte-10w2kpg"),y(N,"class","button svelte-10w2kpg"),pe(N,"background-image","url('images/interface/Button Brown.png')"),y(ce,"class","line-1 svelte-10w2kpg"),y(V,"class","line-2 svelte-10w2kpg"),y(oe,"class","button svelte-10w2kpg"),pe(oe,"background-image","url('images/interface/Button Brown.png')"),y(x,"class","line-1 svelte-10w2kpg"),y(ue,"class","button svelte-10w2kpg"),ue.disabled=Y=!r[5],pe(ue,"background-image","url('images/interface/Button Brown.png')"),y(_e,"class","line-1 svelte-10w2kpg"),y(ne,"class","button svelte-10w2kpg"),ne.disabled=Fe=!r[5],pe(ne,"background-image","url('images/interface/Button Brown.png')"),y(D,"class","buttons svelte-10w2kpg"),y(t,"class","menu svelte-10w2kpg")},m(M,te){me&&me.m(M,te),W(M,e,te),W(M,t,te),_(t,s),_(s,i),_(i,n);for(let ie=0;ie<ae.length;ie+=1)ae[ie]&&ae[ie].m(n,null);_(i,o),be&&be.m(i,null),_(s,a),_(s,l),_(l,c),_(l,d),_(l,h),_(l,m),_(l,p),Rs(p,r[0]),r[18](p),_(t,v),_(t,D),_(D,S),_(S,j),_(S,U),_(S,P),Le.m(P,null),_(D,w),_(D,b),_(D,q),_(D,N),_(N,R),_(N,E),_(N,$),Ue.m($,null),_(D,ee),_(D,oe),_(oe,ce),_(oe,C),_(oe,V),Ne.m(V,null),_(D,fe),_(D,ue),_(ue,x),_(D,H),_(D,ne),_(ne,_e),_(D,Te),Ye(ve,D,null),Ze=!0,Gt||(bs=[ye(window,"keydown",r[11]),ye(p,"focus",r[15]),ye(p,"blur",r[16]),ye(p,"input",r[17]),ye(S,"click",r[14]),ye(b,"click",r[9]),ye(N,"click",r[10]),ye(oe,"click",r[13]),ye(ue,"click",r[8]),ye(ne,"click",r[12])],Gt=!0)},p(M,[te]){if(M[7]?me?te&128&&Z(me,1):(me=er(),me.c(),Z(me,1),me.m(e.parentNode,e)):me&&(Be(),le(me,1,1,()=>{me=null}),qe()),te&64){et=Re(M[6]);let ie;for(ie=0;ie<et.length;ie+=1){const tt=Zs(M,et,ie);ae[ie]?(ae[ie].p(tt,te),Z(ae[ie],1)):(ae[ie]=tr(tt),ae[ie].c(),Z(ae[ie],1),ae[ie].m(n,null))}for(Be(),ie=et.length;ie<ae.length;ie+=1)$r(ie);qe()}M[4]?be||(be=sr(),be.c(),be.m(i,null)):be&&(be.d(1),be=null),te&1&&p.value!==M[0]&&Rs(p,M[0]),$t!==($t=ks(M))&&(Le.d(1),Le=$t(M),Le&&(Le.c(),Le.m(P,null))),(!Ze||te&32&&g!==(g=!M[5]))&&(S.disabled=g),Dt!==(Dt=Es(M))&&(Ue.d(1),Ue=Dt(M),Ue&&(Ue.c(),Ue.m($,null))),Lt!==(Lt=Ss(M))&&(Ne.d(1),Ne=Lt(M),Ne&&(Ne.c(),Ne.m(V,null))),(!Ze||te&32&&Y!==(Y=!M[5]))&&(ue.disabled=Y),(!Ze||te&32&&Fe!==(Fe=!M[5]))&&(ne.disabled=Fe)},i(M){if(!Ze){Z(me);for(let te=0;te<et.length;te+=1)Z(ae[te]);Z(ve.$$.fragment,M),M&&(De||Et(()=>{De=gs(t,jr,{y:1e3,duration:1e3}),De.start()})),Ze=!0}},o(M){le(me),ae=ae.filter(Boolean);for(let te=0;te<ae.length;te+=1)le(ae[te]);le(ve.$$.fragment,M),Ze=!1},d(M){M&&(T(e),T(t)),me&&me.d(M),gr(ae,M),be&&be.d(),r[18](null),Le.d(),Ue.d(),Ne.d(),Qe(ve),Gt=!1,Vt(bs)}}}const is="Tyler";function so(r,e,t){let s,i,n,o,a;Q(r,lt,b=>t(3,s=b)),Q(r,Ws,b=>t(4,i=b)),Q(r,Me,b=>t(5,n=b)),Q(r,at,b=>t(6,o=b)),Q(r,It,b=>t(7,a=b));let l="",c,u=!1;const d=Ur();let h=new Qs("/music/Inferno.ogg");function f(){se(It,a=!0,a)}function m(){d("snap")}function p(){h||(h=new Qs("/music/Inferno.ogg")),h.howl.playing()?(h.howl.pause(),t(2,u=!1)):(h.howl.play(),t(2,u=!0))}async function v(b){if(!n||o.includes(b))return;const{error:L}=await he.from("messages").insert(b);if(L)return console.error("Error adding message",L),{status:500,error:"Could not add message"}}function D(b){if(b.key==="Enter"){switch(!0){case c!==document.activeElement:console.log("focusing"),c.focus();break;case l===is:console.log("entering"),se(Me,n=!0,n),localStorage.setItem("tournKey",JSON.stringify(s.id));break;case(l!==is&&n===!0):console.log("something here"),v({sender:"Fensail",text:l,tournament:s.id,type:"admin"});break;case(l!==is&&n===!1):console.log("nothing here");break}t(0,l="")}}function S(){d("logout")}function j(){se(Ws,i=!i,i)}async function I(){const{error:b}=await he.from("tournaments").update({isRevealed:!s.isRevealed}).eq("id",s.id);if(b)return console.error("Error toggling reveal",b),{status:500,error:"Could not toggle reveal"}}const U=()=>{console.log("focusing")},P=()=>{console.log("blurring")};function g(){l=this.value,t(0,l)}function w(b){mr[b?"unshift":"push"](()=>{c=b,t(1,c)})}return[l,c,u,s,i,n,o,a,f,m,p,D,S,j,I,U,P,g,w]}class ro extends Ge{constructor(e){super(),Ke(this,e,so,to,Je,{})}}function rr(r,e,t){const s=r.slice();s[19]=e[t];const i=s[6].find(function(...o){return r[10](s[19],...o)}).name;return s[20]=i,s}function no(r){let e,t,s;function i(a,l){return a[0].order===13?ao:oo}let n=i(r),o=n(r);return{c(){e=O("div"),o.c(),this.h()},l(a){e=A(a,"DIV",{class:!0,style:!0});var l=B(e);o.l(l),l.forEach(T),this.h()},h(){y(e,"class","face back svelte-5dk2zm"),pe(e,"border-image","url('images/interface/Message Border.png') 8 / 4px repeat")},m(a,l){W(a,e,l),o.m(e,null),s=!0},p(a,l){n!==(n=i(a))&&(o.d(1),o=n(a),o&&(o.c(),o.m(e,null)))},i(a){s||(t&&t.end(1),s=!0)},o(a){a&&(t=pr(e,Ht,{delay:200})),s=!1},d(a){a&&T(e),o.d(),a&&t&&t.end()}}}function io(r){let e,t,s,i,n,o=r[0].name+"",a,l,c,u,d,h,f,m,p=Re(r[2]),v=[];for(let S=0;S<p.length;S+=1)v[S]=nr(rr(r,p,S));const D=S=>le(v[S],1,1,()=>{v[S]=null});return{c(){e=O("div"),t=O("img"),i=J(),n=O("div"),a=Ee(o),l=J(),c=O("div"),u=Ee(r[3]),d=J(),h=O("div");for(let S=0;S<v.length;S+=1)v[S].c();this.h()},l(S){e=A(S,"DIV",{class:!0,style:!0});var j=B(e);t=A(j,"IMG",{class:!0,src:!0}),i=G(j),n=A(j,"DIV",{class:!0});var I=B(n);a=Se(I,o),I.forEach(T),l=G(j),c=A(j,"DIV",{class:!0});var U=B(c);u=Se(U,r[3]),U.forEach(T),d=G(j),h=A(j,"DIV",{class:!0});var P=B(h);for(let g=0;g<v.length;g+=1)v[g].l(P);P.forEach(T),j.forEach(T),this.h()},h(){y(t,"class","challenge-icon svelte-5dk2zm"),Oe(t.src,s="images/challenge-icons/"+r[0].name+".png")||y(t,"src",s),ge(t,"gray",r[4]),y(n,"class","name svelte-5dk2zm"),y(c,"class","points svelte-5dk2zm"),y(h,"class","completions svelte-5dk2zm"),y(e,"class","face front svelte-5dk2zm"),pe(e,"border-image","url('images/interface/Message Border.png') 8 / 4px repeat")},m(S,j){W(S,e,j),_(e,t),_(e,i),_(e,n),_(n,a),_(e,l),_(e,c),_(c,u),_(e,d),_(e,h);for(let I=0;I<v.length;I+=1)v[I]&&v[I].m(h,null);m=!0},p(S,j){if((!m||j&1&&!Oe(t.src,s="images/challenge-icons/"+S[0].name+".png"))&&y(t,"src",s),(!m||j&16)&&ge(t,"gray",S[4]),(!m||j&1)&&o!==(o=S[0].name+"")&&Pe(a,o),(!m||j&8)&&Pe(u,S[3]),j&68){p=Re(S[2]);let I;for(I=0;I<p.length;I+=1){const U=rr(S,p,I);v[I]?(v[I].p(U,j),Z(v[I],1)):(v[I]=nr(U),v[I].c(),Z(v[I],1),v[I].m(h,null))}for(Be(),I=p.length;I<v.length;I+=1)D(I);qe()}},i(S){if(!m){for(let j=0;j<p.length;j+=1)Z(v[j]);f&&f.end(1),m=!0}},o(S){v=v.filter(Boolean);for(let j=0;j<v.length;j+=1)le(v[j]);S&&(f=pr(e,Ht,{delay:200})),m=!1},d(S){S&&T(e),gr(v,S),S&&f&&f.end()}}}function oo(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){y(e,"class","icon blur svelte-5dk2zm"),Oe(e.src,t="images/challenge-icons/Hidden 3.png")||y(e,"src",t),y(e,"alt","Hidden")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function ao(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){y(e,"class","icon blur svelte-5dk2zm"),Oe(e.src,t="images/challenge-icons/Hidden 4.png")||y(e,"src",t),y(e,"alt","Hidden")},m(s,i){W(s,e,i)},d(s){s&&T(e)}}}function nr(r){let e,t,s,i,n,o;return{c(){e=O("div"),t=O("img"),i=J(),this.h()},l(a){e=A(a,"DIV",{class:!0});var l=B(e);t=A(l,"IMG",{class:!0,src:!0}),i=G(l),l.forEach(T),this.h()},h(){y(t,"class","icon svelte-5dk2zm"),Oe(t.src,s="images/interface/Banner "+r[20]+".png")||y(t,"src",s),y(e,"class","completion svelte-5dk2zm")},m(a,l){W(a,e,l),_(e,t),_(e,i),o=!0},p(a,l){(!o||l&68&&!Oe(t.src,s="images/interface/Banner "+a[20]+".png"))&&y(t,"src",s)},i(a){o||(a&&Et(()=>{o&&(n||(n=bt(e,Rt,{},!0)),n.run(1))}),o=!0)},o(a){a&&(n||(n=bt(e,Rt,{},!1)),n.run(0)),o=!1},d(a){a&&T(e),a&&n&&n.end()}}}function lo(r){let e,t,s,i,n,o,a,l;const c=[io,no],u=[];function d(h,f){return h[1]?0:1}return t=d(r),s=u[t]=c[t](r),{c(){e=O("button"),s.c(),this.h()},l(h){e=A(h,"BUTTON",{class:!0,style:!0});var f=B(e);s.l(f),f.forEach(T),this.h()},h(){y(e,"class","challenge svelte-5dk2zm"),pe(e,"order",r[0].order),e.disabled=i=!r[5]||!r[1],ge(e,"active",r[1]),ge(e,"gray",r[4]),ge(e,"editable",r[5])},m(h,f){W(h,e,f),u[t].m(e,null),o=!0,a||(l=ye(e,"click",r[11]),a=!0)},p(h,[f]){let m=t;t=d(h),t===m?u[t].p(h,f):(Be(),le(u[m],1,1,()=>{u[m]=null}),qe(),s=u[t],s?s.p(h,f):(s=u[t]=c[t](h),s.c()),Z(s,1),s.m(e,null)),(!o||f&1)&&pe(e,"order",h[0].order),(!o||f&34&&i!==(i=!h[5]||!h[1]))&&(e.disabled=i),(!o||f&2)&&ge(e,"active",h[1]),(!o||f&16)&&ge(e,"gray",h[4]),(!o||f&32)&&ge(e,"editable",h[5])},i(h){o||(Z(s),h&&(n||Et(()=>{n=gs(e,Rt,{}),n.start()})),o=!0)},o(h){le(s),o=!1},d(h){h&&T(e),u[t].d(),a=!1,l()}}}const co=1,uo=2;function ho(r,e,t){let s,i,n,o,a,l,c,u,d,h;Q(r,Me,P=>t(5,o=P)),Q(r,at,P=>t(12,a=P)),Q(r,lt,P=>t(13,l=P)),Q(r,yt,P=>t(14,c=P)),Q(r,Ar,P=>t(8,u=P)),Q(r,_t,P=>t(9,d=P)),Q(r,ot,P=>t(6,h=P));let{challenge:f}=e,{isActive:m=!1}=e;function p(){if(!o)return;const P={tournament:l.id,text:`Completed the challenge ${f.name}`,type:"completion",sender:c.name};s.some(g=>g.team===c.id)?(D(c),j(P)):(v(c),S(P))}async function v(P){if(!o)return;const{error:g}=await he.from("completions").insert({tournament:l.id,challenge:f.id,team:P.id});if(g)return console.error("Error adding challenge",g),{status:500,error:"Could not add challenge"}}async function D(P){if(!o)return;const{error:g}=await he.from("completions").delete().eq("team",P.id).eq("challenge",f.id);if(g)return console.error("Error remove completion",g),{status:500,error:"Could not remove completion"}}async function S(P){if(!o||a.includes(P))return;const{error:g}=await he.from("messages").insert(P);if(g)return console.error("Error adding message",g),{status:500,error:"Could not add message"}}async function j(P){if(!o)return;const{error:g}=await he.from("messages").delete().eq("text",P.text);if(g)return console.error("Error removing message",g),{status:500,error:"Could not remove message"}}const I=(P,g)=>g.id===P.team,U=()=>p();return r.$$set=P=>{"challenge"in P&&t(0,f=P.challenge),"isActive"in P&&t(1,m=P.isActive)},r.$$.update=()=>{r.$$.dirty&513&&t(2,s=d.filter(P=>P.challenge===f.id)),r.$$.dirty&260&&t(4,i=s.length>=u.maxTeams),r.$$.dirty&5&&t(3,n=f.points-(f.type==="main"?Math.min(s.length,uo):0)*co)},[f,m,s,n,i,o,h,p,u,d,I,U]}class Rr extends Ge{constructor(e){super(),Ke(this,e,ho,lo,Je,{challenge:0,isActive:1})}}function fo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xr={exports:{}};(function(r){(function(e){var t=j(),s=I(),i=U(),n=P(),o={imagePlaceholder:void 0,cacheBust:!1},a={toSvg:l,toPng:u,toJpeg:d,toBlob:h,toPixelData:c,impl:{fontFaces:i,images:n,util:t,inliner:s,options:{}}};r.exports=a;function l(g,w){return w=w||{},f(w),Promise.resolve(g).then(function(L){return p(L,w.filter,!0)}).then(v).then(D).then(b).then(function(L){return S(L,w.width||t.width(g),w.height||t.height(g))});function b(L){return w.bgcolor&&(L.style.backgroundColor=w.bgcolor),w.width&&(L.style.width=w.width+"px"),w.height&&(L.style.height=w.height+"px"),w.style&&Object.keys(w.style).forEach(function(q){L.style[q]=w.style[q]}),L}}function c(g,w){return m(g,w||{}).then(function(b){return b.getContext("2d").getImageData(0,0,t.width(g),t.height(g)).data})}function u(g,w){return m(g,w||{}).then(function(b){return b.toDataURL()})}function d(g,w){return w=w||{},m(g,w).then(function(b){return b.toDataURL("image/jpeg",w.quality||1)})}function h(g,w){return m(g,w||{}).then(t.canvasToBlob)}function f(g){typeof g.imagePlaceholder>"u"?a.impl.options.imagePlaceholder=o.imagePlaceholder:a.impl.options.imagePlaceholder=g.imagePlaceholder,typeof g.cacheBust>"u"?a.impl.options.cacheBust=o.cacheBust:a.impl.options.cacheBust=g.cacheBust}function m(g,w){return l(g,w).then(t.makeImage).then(t.delay(100)).then(function(L){var q=b(g);return q.getContext("2d").drawImage(L,0,0),q});function b(L){var q=document.createElement("canvas");if(q.width=w.width||t.width(L),q.height=w.height||t.height(L),w.bgcolor){var N=q.getContext("2d");N.fillStyle=w.bgcolor,N.fillRect(0,0,q.width,q.height)}return q}}function p(g,w,b){if(!b&&w&&!w(g))return Promise.resolve();return Promise.resolve(g).then(L).then(function(R){return q(g,R,w)}).then(function(R){return N(g,R)});function L(R){return R instanceof HTMLCanvasElement?t.makeImage(R.toDataURL()):R.cloneNode(!1)}function q(R,F,E){var $=R.childNodes;if($.length===0)return Promise.resolve(F);return ee(F,t.asArray($),E).then(function(){return F});function ee(oe,ce,k){var C=Promise.resolve();return ce.forEach(function(V){C=C.then(function(){return p(V,k)}).then(function(fe){fe&&oe.appendChild(fe)})}),C}}function N(R,F){if(!(F instanceof Element))return F;return Promise.resolve().then(E).then($).then(ee).then(oe).then(function(){return F});function E(){ce(window.getComputedStyle(R),F.style);function ce(k,C){k.cssText?C.cssText=k.cssText:V(k,C);function V(fe,ue){t.asArray(fe).forEach(function(x){ue.setProperty(x,fe.getPropertyValue(x),fe.getPropertyPriority(x))})}}}function $(){[":before",":after"].forEach(function(k){ce(k)});function ce(k){var C=window.getComputedStyle(R,k),V=C.getPropertyValue("content");if(V===""||V==="none")return;var fe=t.uid();F.className=F.className+" "+fe;var ue=document.createElement("style");ue.appendChild(x(fe,k,C)),F.appendChild(ue);function x(z,Y,H){var ne="."+z+":"+Y,_e=H.cssText?ht(H):Fe(H);return document.createTextNode(ne+"{"+_e+"}");function ht(Te){var ve=Te.getPropertyValue("content");return Te.cssText+" content: "+ve+";"}function Fe(Te){return t.asArray(Te).map(ve).join("; ")+";";function ve(De){return De+": "+Te.getPropertyValue(De)+(Te.getPropertyPriority(De)?" !important":"")}}}}}function ee(){R instanceof HTMLTextAreaElement&&(F.innerHTML=R.value),R instanceof HTMLInputElement&&F.setAttribute("value",R.value)}function oe(){F instanceof SVGElement&&(F.setAttribute("xmlns","http://www.w3.org/2000/svg"),F instanceof SVGRectElement&&["width","height"].forEach(function(ce){var k=F.getAttribute(ce);k&&F.style.setProperty(ce,k)}))}}}function v(g){return i.resolveAll().then(function(w){var b=document.createElement("style");return g.appendChild(b),b.appendChild(document.createTextNode(w)),g})}function D(g){return n.inlineAll(g).then(function(){return g})}function S(g,w,b){return Promise.resolve(g).then(function(L){return L.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(L)}).then(t.escapeXhtml).then(function(L){return'<foreignObject x="0" y="0" width="100%" height="100%">'+L+"</foreignObject>"}).then(function(L){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+w+'" height="'+b+'">'+L+"</svg>"}).then(function(L){return"data:image/svg+xml;charset=utf-8,"+L})}function j(){return{escape:oe,parseExtension:w,mimeType:b,dataAsUrl:ee,isDataUrl:L,canvasToBlob:N,resolveUrl:R,getAndEncode:$,uid:F(),delay:ce,asArray:k,escapeXhtml:C,makeImage:E,width:V,height:fe};function g(){var x="application/font-woff",z="image/jpeg";return{woff:x,woff2:x,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:z,jpeg:z,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function w(x){var z=/\.([^\.\/]*?)$/g.exec(x);return z?z[1]:""}function b(x){var z=w(x).toLowerCase();return g()[z]||""}function L(x){return x.search(/^(data:)/)!==-1}function q(x){return new Promise(function(z){for(var Y=window.atob(x.toDataURL().split(",")[1]),H=Y.length,ne=new Uint8Array(H),_e=0;_e<H;_e++)ne[_e]=Y.charCodeAt(_e);z(new Blob([ne],{type:"image/png"}))})}function N(x){return x.toBlob?new Promise(function(z){x.toBlob(z)}):q(x)}function R(x,z){var Y=document.implementation.createHTMLDocument(),H=Y.createElement("base");Y.head.appendChild(H);var ne=Y.createElement("a");return Y.body.appendChild(ne),H.href=z,ne.href=x,ne.href}function F(){var x=0;return function(){return"u"+z()+x++;function z(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function E(x){return new Promise(function(z,Y){var H=new Image;H.onload=function(){z(H)},H.onerror=Y,H.src=x})}function $(x){var z=3e4;return a.impl.options.cacheBust&&(x+=(/\?/.test(x)?"&":"?")+new Date().getTime()),new Promise(function(Y){var H=new XMLHttpRequest;H.onreadystatechange=ht,H.ontimeout=Fe,H.responseType="blob",H.timeout=z,H.open("GET",x,!0),H.send();var ne;if(a.impl.options.imagePlaceholder){var _e=a.impl.options.imagePlaceholder.split(/,/);_e&&_e[1]&&(ne=_e[1])}function ht(){if(H.readyState===4){if(H.status!==200){ne?Y(ne):Te("cannot fetch resource: "+x+", status: "+H.status);return}var ve=new FileReader;ve.onloadend=function(){var De=ve.result.split(/,/)[1];Y(De)},ve.readAsDataURL(H.response)}}function Fe(){ne?Y(ne):Te("timeout of "+z+"ms occured while fetching resource: "+x)}function Te(ve){console.error(ve),Y("")}})}function ee(x,z){return"data:"+z+";base64,"+x}function oe(x){return x.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function ce(x){return function(z){return new Promise(function(Y){setTimeout(function(){Y(z)},x)})}}function k(x){for(var z=[],Y=x.length,H=0;H<Y;H++)z.push(x[H]);return z}function C(x){return x.replace(/#/g,"%23").replace(/\n/g,"%0A")}function V(x){var z=ue(x,"border-left-width"),Y=ue(x,"border-right-width");return x.scrollWidth+z+Y}function fe(x){var z=ue(x,"border-top-width"),Y=ue(x,"border-bottom-width");return x.scrollHeight+z+Y}function ue(x,z){var Y=window.getComputedStyle(x).getPropertyValue(z);return parseFloat(Y.replace("px",""))}}function I(){var g=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:q,shouldProcess:w,impl:{readUrls:b,inline:L}};function w(N){return N.search(g)!==-1}function b(N){for(var R=[],F;(F=g.exec(N))!==null;)R.push(F[1]);return R.filter(function(E){return!t.isDataUrl(E)})}function L(N,R,F,E){return Promise.resolve(R).then(function(ee){return F?t.resolveUrl(ee,F):ee}).then(E||t.getAndEncode).then(function(ee){return t.dataAsUrl(ee,t.mimeType(R))}).then(function(ee){return N.replace($(R),"$1"+ee+"$3")});function $(ee){return new RegExp(`(url\\(['"]?)(`+t.escape(ee)+`)(['"]?\\))`,"g")}}function q(N,R,F){if(E())return Promise.resolve(N);return Promise.resolve(N).then(b).then(function($){var ee=Promise.resolve(N);return $.forEach(function(oe){ee=ee.then(function(ce){return L(ce,oe,R,F)})}),ee});function E(){return!w(N)}}}function U(){return{resolveAll:g,impl:{readAll:w}};function g(){return w().then(function(b){return Promise.all(b.map(function(L){return L.resolve()}))}).then(function(b){return b.join(`
`)})}function w(){return Promise.resolve(t.asArray(document.styleSheets)).then(L).then(b).then(function(N){return N.map(q)});function b(N){return N.filter(function(R){return R.type===CSSRule.FONT_FACE_RULE}).filter(function(R){return s.shouldProcess(R.style.getPropertyValue("src"))})}function L(N){var R=[];return N.forEach(function(F){try{t.asArray(F.cssRules||[]).forEach(R.push.bind(R))}catch(E){console.log("Error while reading CSS rules from "+F.href,E.toString())}}),R}function q(N){return{resolve:function(){var F=(N.parentStyleSheet||{}).href;return s.inlineAll(N.cssText,F)},src:function(){return N.style.getPropertyValue("src")}}}}}function P(){return{inlineAll:w,impl:{newImage:g}};function g(b){return{inline:L};function L(q){return t.isDataUrl(b.src)?Promise.resolve():Promise.resolve(b.src).then(q||t.getAndEncode).then(function(N){return t.dataAsUrl(N,t.mimeType(b.src))}).then(function(N){return new Promise(function(R,F){b.onload=R,b.onerror=F,b.src=N})})}}function w(b){if(!(b instanceof Element))return Promise.resolve(b);return L(b).then(function(){return b instanceof HTMLImageElement?g(b).inline():Promise.all(t.asArray(b.childNodes).map(function(q){return w(q)}))});function L(q){var N=q.style.getPropertyValue("background");return N?s.inlineAll(N).then(function(R){q.style.setProperty("background",R,q.style.getPropertyPriority("background"))}).then(function(){return q}):Promise.resolve(q)}}}})()})(xr);var go=xr.exports;const mo=fo(go);function ir(r,e,t){const s=r.slice();return s[29]=e[t],s}function or(r,e,t){const s=r.slice();s[29]=e[t];const i=s[2].isRevealed&&(s[9].includes(s[29].order)||s[10].includes(s[29].order)&&s[0]>=ds||s[11].includes(s[29].order)&&s[0]>=fs);return s[32]=i,s}function ar(r,e,t){const s=r.slice();return s[35]=e[t],s}function po(r){let e,t="Loading...";return{c(){e=O("div"),e.textContent=t,this.h()},l(s){e=A(s,"DIV",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1f5y80z"&&(e.textContent=t),this.h()},h(){y(e,"class","loading svelte-c9q9wy")},m(s,i){W(s,e,i)},p:xe,i:xe,o:xe,d(s){s&&T(e)}}}function _o(r){let e,t,s=r[2].name+"",i,n,o,a,l,c="TEAMS",u,d=[],h=new Map,f,m,p,v=[],D=new Map,S,j,I,U="BONUS",P,g,w=[],b=new Map,L,q,N,R=r[1]&&lr(r),F=Re(r[5]);const E=k=>k[35].id;for(let k=0;k<F.length;k+=1){let C=ar(r,F,k),V=E(C);h.set(V,d[k]=cr(V,C))}let $=Re(r[4].filter(dr));const ee=k=>k[29].order;for(let k=0;k<$.length;k+=1){let C=or(r,$,k),V=ee(C);D.set(V,v[k]=ur(V,C))}let oe=Re(r[4].filter(fr));const ce=k=>k[29].order;for(let k=0;k<oe.length;k+=1){let C=ir(r,oe,k),V=ce(C);b.set(V,w[k]=hr(V,C))}return q=new ro({}),q.$on("snap",r[12]),q.$on("logout",r[13]),{c(){e=O("div"),t=O("h1"),i=Ee(s),n=J(),R&&R.c(),o=J(),a=O("div"),l=O("div"),l.textContent=c,u=J();for(let k=0;k<d.length;k+=1)d[k].c();f=J(),m=O("div"),p=O("div");for(let k=0;k<v.length;k+=1)v[k].c();S=J(),j=O("div"),I=O("div"),I.textContent=U,P=J(),g=O("div");for(let k=0;k<w.length;k+=1)w[k].c();L=J(),We(q.$$.fragment),this.h()},l(k){e=A(k,"DIV",{class:!0});var C=B(e);t=A(C,"H1",{class:!0});var V=B(t);i=Se(V,s),V.forEach(T),n=G(C),R&&R.l(C),C.forEach(T),o=G(k),a=A(k,"DIV",{class:!0});var fe=B(a);l=A(fe,"DIV",{class:!0,"data-svelte-h":!0}),de(l)!=="svelte-1f76pmf"&&(l.textContent=c),u=G(fe);for(let H=0;H<d.length;H+=1)d[H].l(fe);fe.forEach(T),f=G(k),m=A(k,"DIV",{class:!0});var ue=B(m);p=A(ue,"DIV",{class:!0});var x=B(p);for(let H=0;H<v.length;H+=1)v[H].l(x);x.forEach(T),ue.forEach(T),S=G(k),j=A(k,"DIV",{class:!0});var z=B(j);I=A(z,"DIV",{class:!0,"data-svelte-h":!0}),de(I)!=="svelte-1j4xxyu"&&(I.textContent=U),P=G(z),g=A(z,"DIV",{class:!0});var Y=B(g);for(let H=0;H<w.length;H+=1)w[H].l(Y);Y.forEach(T),z.forEach(T),L=G(k),Xe(q.$$.fragment,k),this.h()},h(){y(t,"class","title svelte-c9q9wy"),y(e,"class","titles svelte-c9q9wy"),y(l,"class","label svelte-c9q9wy"),y(a,"class","teams svelte-c9q9wy"),y(p,"class","challenges svelte-c9q9wy"),y(m,"class","challenges-container svelte-c9q9wy"),y(I,"class","label svelte-c9q9wy"),y(g,"class","bonus-challenges svelte-c9q9wy"),y(j,"class","bonus-challenges-container svelte-c9q9wy")},m(k,C){W(k,e,C),_(e,t),_(t,i),_(e,n),R&&R.m(e,null),W(k,o,C),W(k,a,C),_(a,l),_(a,u);for(let V=0;V<d.length;V+=1)d[V]&&d[V].m(a,null);W(k,f,C),W(k,m,C),_(m,p);for(let V=0;V<v.length;V+=1)v[V]&&v[V].m(p,null);W(k,S,C),W(k,j,C),_(j,I),_(j,P),_(j,g);for(let V=0;V<w.length;V+=1)w[V]&&w[V].m(g,null);W(k,L,C),Ye(q,k,C),N=!0},p(k,C){(!N||C[0]&4)&&s!==(s=k[2].name+"")&&Pe(i,s),k[1]?R?R.p(k,C):(R=lr(k),R.c(),R.m(e,null)):R&&(R.d(1),R=null),C[0]&160&&(F=Re(k[5]),Be(),d=Xt(d,C,E,1,k,F,h,a,Wt,cr,null,ar),qe()),C[0]&3605&&($=Re(k[4].filter(dr)),Be(),v=Xt(v,C,ee,1,k,$,D,p,Wt,ur,null,or),qe()),C[0]&20&&(oe=Re(k[4].filter(fr)),Be(),w=Xt(w,C,ce,1,k,oe,b,g,Wt,hr,null,ir),qe())},i(k){if(!N){for(let C=0;C<F.length;C+=1)Z(d[C]);for(let C=0;C<$.length;C+=1)Z(v[C]);for(let C=0;C<oe.length;C+=1)Z(w[C]);Z(q.$$.fragment,k),N=!0}},o(k){for(let C=0;C<d.length;C+=1)le(d[C]);for(let C=0;C<v.length;C+=1)le(v[C]);for(let C=0;C<w.length;C+=1)le(w[C]);le(q.$$.fragment,k),N=!1},d(k){k&&(T(e),T(o),T(a),T(f),T(m),T(S),T(j),T(L)),R&&R.d();for(let C=0;C<d.length;C+=1)d[C].d();for(let C=0;C<v.length;C+=1)v[C].d();for(let C=0;C<w.length;C+=1)w[C].d();Qe(q,k)}}}function lr(r){let e,t=r[2].name+"",s;return{c(){e=O("h1"),s=Ee(t),this.h()},l(i){e=A(i,"H1",{class:!0});var n=B(e);s=Se(n,t),n.forEach(T),this.h()},h(){y(e,"class","editing svelte-c9q9wy")},m(i,n){W(i,e,n),_(e,s)},p(i,n){n[0]&4&&t!==(t=i[2].name+"")&&Pe(s,t)},d(i){i&&T(e)}}}function cr(r,e){let t,s,i;return s=new Ui({props:{team:e[35],maxHealth:e[7]}}),{key:r,first:null,c(){t=wt(),We(s.$$.fragment),this.h()},l(n){t=wt(),Xe(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,o){W(n,t,o),Ye(s,n,o),i=!0},p(n,o){e=n;const a={};o[0]&32&&(a.team=e[35]),o[0]&128&&(a.maxHealth=e[7]),s.$set(a)},i(n){i||(Z(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Qe(s,n)}}}function ur(r,e){let t,s,i;return s=new Rr({props:{challenge:e[29],isActive:e[32]}}),{key:r,first:null,c(){t=wt(),We(s.$$.fragment),this.h()},l(n){t=wt(),Xe(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,o){W(n,t,o),Ye(s,n,o),i=!0},p(n,o){e=n;const a={};o[0]&16&&(a.challenge=e[29]),o[0]&21&&(a.isActive=e[32]),s.$set(a)},i(n){i||(Z(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Qe(s,n)}}}function hr(r,e){let t,s,i;return s=new Rr({props:{challenge:e[29],isActive:e[2].isRevealed}}),{key:r,first:null,c(){t=wt(),We(s.$$.fragment),this.h()},l(n){t=wt(),Xe(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,o){W(n,t,o),Ye(s,n,o),i=!0},p(n,o){e=n;const a={};o[0]&16&&(a.challenge=e[29]),o[0]&4&&(a.isActive=e[2].isRevealed),s.$set(a)},i(n){i||(Z(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Qe(s,n)}}}function vo(r){let e,t,s,i;const n=[_o,po],o=[];function a(l,c){return l[2]&&l[5]&&l[4]&&l[8]&&l[3]?0:1}return t=a(r),s=o[t]=n[t](r),{c(){e=O("div"),s.c(),this.h()},l(l){e=A(l,"DIV",{class:!0,style:!0});var c=B(e);s.l(c),c.forEach(T),this.h()},h(){y(e,"class","frame svelte-c9q9wy"),pe(e,"background-image","linear-gradient(to top right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%), url('images/Wide Background.jpg')"),pe(e,"cursor","url('images/interface/Scimitar.png'), auto")},m(l,c){W(l,e,c),o[t].m(e,null),r[14](e),i=!0},p(l,c){let u=t;t=a(l),t===u?o[t].p(l,c):(Be(),le(o[u],1,1,()=>{o[u]=null}),qe(),s=o[t],s?s.p(l,c):(s=o[t]=n[t](l),s.c()),Z(s,1),s.m(e,null))},i(l){i||(Z(s),i=!0)},o(l){le(s),i=!1},d(l){l&&T(e),o[t].d(),r[14](null)}}}const ds=8,fs=16;function yo(){const r=document.createElement("style");r.textContent=`
			::-webkit-scrollbar {
				/* height: 12px; */
				width: 16px;
				background: #000;
			}

			::-webkit-scrollbar-thumb {
				background: url('images/interface/Scroll Bar.png');
				border-radius: 4px;
				border: solid black 1px;
				background-size: contain;
				image-rendering: pixelated;
				background-repeat: repeat;
			}

			::-webkit-scrollbar-track {
				background: url('images/interface/Scroll Bar Track.png');
				background-size: contain;
				image-rendering: pixelated;
				background-repeat: repeat;
			}

			::-webkit-scrollbar-button:single-button:vertical:decrement {
				background: url('images/interface/Scroll Bar Up.png');
				width: 16px;
				height: 16px;
				background-size: cover;
				image-rendering: pixelated;
				background-repeat: no-repeat;
			}
			::-webkit-scrollbar-button:single-button:vertical:increment {
				width: 16px;
				height: 16px;
				background: url('images/interface/Scroll Bar Down.png');
				background-size: cover;
				image-rendering: pixelated;
				background-repeat: no-repeat;
			}
		`,document.head.appendChild(r)}const dr=r=>r.type==="main",fr=r=>r.type==="bonus";function wo(r,e,t){let s,i,n,o,a,l,c,u,d;Q(r,Me,E=>t(1,n=E)),Q(r,at,E=>t(8,o=E)),Q(r,lt,E=>t(2,a=E)),Q(r,_t,E=>t(3,l=E)),Q(r,Pt,E=>t(4,c=E)),Q(r,ot,E=>t(5,u=E)),Q(r,yt,E=>t(15,d=E));const h=[1,2,3,4,5,6,10,11,15,16,20,21,22,23,24,25],f=[7,8,9,12,14,17,18,19],m=[13];let p;Nr(async()=>{v(),D(),S(),j(),I(),await U().then(()=>P()).then(()=>g()).then(()=>w()).then(()=>b()).then(()=>{yo(),JSON.parse(localStorage.getItem("tournKey"))===a.id?se(Me,n=!0,n):se(Me,n=!1,n),o.length<1&&L({tournament:a.id,text:"Welcome to the tournament!",type:"notification",sender:"System"})}).catch(E=>{console.error("An error occurred:",E)})});function v(){he.channel("tournament_channel").on("postgres_changes",{event:"*",schema:"public",table:"tournaments"},E=>{switch(console.log("payload",E),E.eventType){case"UPDATE":se(lt,a=E.new,a);break}}).subscribe()}function D(){he.channel("teams_channel").on("postgres_changes",{event:"*",schema:"public",table:"teams"},E=>{switch(E.eventType){case"INSERT":console.log("new",E.new),se(ot,u=[...u,E.new],u);break;case"DELETE":console.log("old",E.old),se(ot,u=u.filter($=>$.id!==E.old.id),u);break}}).subscribe()}function S(){he.channel("challenges_channel").on("postgres_changes",{event:"*",schema:"public",table:"challenges"},E=>{switch(E.eventType){case"INSERT":console.log("new",E.new),se(Pt,c=[...c,E.new],c);break;case"DELETE":console.log("old",E.old),se(Pt,c=c.filter($=>$.id!==E.old.id),c);break}}).subscribe()}function j(){he.channel("completions_channel").on("postgres_changes",{event:"*",schema:"public",table:"completions"},E=>{switch(E.eventType){case"INSERT":se(_t,l=[...l,E.new],l);break;case"DELETE":se(_t,l=l.filter($=>$.id!==E.old.id),l);break}}).subscribe()}function I(){he.channel("messages_channel").on("postgres_changes",{event:"*",schema:"public",table:"messages"},E=>{switch(E.eventType){case"INSERT":se(at,o=[...o,E.new],o);break;case"DELETE":se(at,o=o.filter($=>$.id!==E.old.id),o);break}}).subscribe()}async function U(){const{data:E,error:$}=await he.from("tournaments").select("*").eq("id","f1c04b40-4faa-43f9-b058-bfc1db35d388");if($)return console.error("Error fetching tournament",$),{status:500,error:"Could not fetch tournament"};se(lt,a=E[0],a)}async function P(){const{data:E,error:$}=await he.from("teams").select("*").eq("tournament",a.id);if($)return console.error("Error fetching teams",$),{status:500,error:"Could not fetch teams"};se(ot,u=E??[],u)}async function g(){const{data:E,error:$}=await he.from("challenges").select("*").eq("tournament",a.id);if($)return console.error("Error fetching challenges",$),{status:500,error:"Could not fetch challenges"};se(Pt,c=E??[],c)}async function w(){const{data:E,error:$}=await he.from("completions").select("*").eq("tournament",a.id);if($)return console.error("Error fetching completions",$),{status:500,error:"Could not fetch completions"};se(_t,l=E??[],l)}async function b(){const{data:E,error:$}=await he.from("messages").select("*").eq("tournament",a.id);if($)return console.error("Error fetching messages",$),{status:500,error:"Could not fetch messages"};se(at,o=E??[],o)}async function L(E){if(!n||o.find(ee=>E.text===ee.text))return;const{error:$}=await he.from("messages").insert(E);if($)return console.error("Error adding message",$),{status:500,error:"Could not add message"}}async function q(E){if(!n)return;const{error:$}=await he.from("messages").delete().eq("text",E.text);if($)return console.error("Error removing message",$),{status:500,error:"Could not remove message"}}async function N(){mo.toPng(p).then(function(E){let $=document.createElement("a");$.download="my-image-name.png",$.href=E,document.body.appendChild($),$.click(),document.body.removeChild($)}).catch(function(E){console.error("oops, something went wrong!",E)})}function R(){se(Me,n=!1,n),localStorage.removeItem("tournKey")}function F(E){mr[E?"unshift":"push"](()=>{p=E,t(6,p)})}return r.$$.update=()=>{if(r.$$.dirty[0]&16&&t(7,s=c.reduce((E,$)=>E+$.points,0)),r.$$.dirty[0]&24&&t(0,i=c.filter(E=>l.find($=>$.challenge===E.id)&&E.type==="main").length),r.$$.dirty[0]&5&&a)switch(!0){case i<ds:q({tournament:a.id,text:"Outer Ring Unlocked",type:"notification",sender:"System"}),q({tournament:a.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"});break;case(i>=ds&&i<fs):L({tournament:a.id,text:"Outer Ring Unlocked",type:"notification",sender:"System"}),q({tournament:a.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"});break;case i>=fs:L({tournament:a.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"})}r.$$.dirty[0]&34&&(n?se(yt,d=u[0],d):se(yt,d=null,d))},[i,n,a,l,c,u,p,s,o,h,f,m,N,R,F]}class Co extends Ge{constructor(e){super(),Ke(this,e,wo,vo,Je,{},null,[-1,-1])}}export{Co as P,To as _,fo as g};
