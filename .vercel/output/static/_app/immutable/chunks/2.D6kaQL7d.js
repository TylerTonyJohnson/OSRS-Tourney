import{r as Ht,T as js,H as Lr,s as Je,e as O,d as G,t as Ee,f as A,h as M,l as J,j as Se,k as T,y as w,U as Oe,z as he,m as K,o as b,p as Pe,n as $e,V as ge,W as ye,F as Et,X as fs,q as Q,Y as fe,Z,_ as Ur,$ as Rs,a0 as Nr,A as pr,x as Mr,v as bt}from"./scheduler.L0wOQzWL.js";import{a as le,t as ee,S as Ke,i as We,b as Xe,d as Ye,m as Qe,g as Be,c as qe,f as gs,e as Ze,h as wt,j as vr}from"./index.CcjJBzZY.js";import{_ as lt}from"./preload-helper.D6kgxu3v.js";import{r as Br,d as qr,w as xe}from"./index.B2BWPPe4.js";function Ie(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Wt(r,e){le(r,1,1,()=>{e.delete(r.key)})}function Xt(r,e,t,s,i,n,a,o,l,c,u,h){let d=r.length,g=n.length,m=d;const p={};for(;m--;)p[r[m].key]=m;const v=[],L=new Map,I=new Map,j=[];for(m=g;m--;){const f=h(i,n,m),y=t(f);let _=a.get(y);_?s&&j.push(()=>_.p(f,e)):(_=c(y,f),_.c()),L.set(y,v[m]=_),y in p&&I.set(y,Math.abs(m-p[y]))}const S=new Set,U=new Set;function k(f){ee(f,1),f.m(o,u),a.set(f.key,f),u=f.first,g--}for(;d&&g;){const f=v[g-1],y=r[d-1],_=f.key,R=y.key;f===y?(u=f.first,d--,g--):L.has(R)?!a.has(_)||S.has(_)?k(f):U.has(R)?d--:I.get(_)>I.get(R)?(U.add(_),k(f)):(S.add(R),d--):(l(y,a),d--)}for(;d--;){const f=r[d];L.has(f.key)||l(f,a)}for(;g;)k(v[g-1]);return Ht(j),v}async function Fr(){}const Vr=!0,Ta=Object.freeze(Object.defineProperty({__proto__:null,load:Fr,prerender:Vr},Symbol.toStringTag,{value:"Module"})),Hr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class ms extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class zr extends ms{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Gr extends ms{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Jr extends ms{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var is;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(is||(is={}));var Kr=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Wr{constructor(e,{headers:t={},customFetch:s,region:i=is.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Hr(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Kr(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:a}=t;let o={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(o["x-region"]=l);let c;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=a):typeof a=="string"?(o["Content-Type"]="text/plain",c=a):typeof FormData<"u"&&a instanceof FormData?c=a:(o["Content-Type"]="application/json",c=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:c}).catch(m=>{throw new zr(m)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Gr(u);if(!u.ok)throw new Jr(u);let d=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return d==="application/json"?g=yield u.json():d==="application/octet-stream"?g=yield u.blob():d==="multipart/form-data"?g=yield u.formData():g=yield u.text(),{data:g,error:null}}catch(i){return{data:null,error:i}}})}}var Xr=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},kt=Xr();const Yr=kt.fetch,ps=kt.fetch.bind(kt),_r=kt.Headers,Qr=kt.Request,Zr=kt.Response,$t=Object.freeze(Object.defineProperty({__proto__:null,Headers:_r,Request:Qr,Response:Zr,default:ps,fetch:Yr},Symbol.toStringTag,{value:"Module"}));class en extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class tn{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ps:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var a,o,l;let c=null,u=null,h=null,d=n.status,g=n.statusText;if(n.ok){if(this.method!=="HEAD"){const L=await n.text();L===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=L:u=JSON.parse(L))}const p=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),v=(o=n.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");p&&v&&v.length>1&&(h=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,d=406,g="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const p=await n.text();try{c=JSON.parse(p),Array.isArray(c)&&n.status===404&&(u=[],c=null,d=200,g="OK")}catch{n.status===404&&p===""?(d=204,g="No Content"):c={message:p}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,g="OK"),c&&this.shouldThrowOnError)throw new en(c)}return{error:c,data:u,count:h,status:d,statusText:g}});return this.shouldThrowOnError||(i=i.catch(n=>{var a,o,l;return{error:{message:`${(a=n==null?void 0:n.name)!==null&&a!==void 0?a:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(o=n==null?void 0:n.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}}class sn extends tn{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:n=i}={}){const a=n?`${n}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const n=typeof i>"u"?"offset":`${i}.offset`,a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:n=!1,format:a="text"}={}){var o;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${l};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class pt extends sn{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}class rn{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let n=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new pt({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const a=e.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(a.length>0){const o=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new pt({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:n=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new pt({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new pt({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new pt({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const nn="1.15.1",an={"X-Client-Info":`postgrest-js/${nn}`};class vs{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},an),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new rn(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new vs(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:n}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let l;s?(a="HEAD",Object.entries(t).filter(([u,h])=>h!==void 0).forEach(([u,h])=>{o.searchParams.append(u,`${h}`)})):i?(a="GET",Object.entries(t).filter(([u,h])=>h!==void 0).forEach(([u,h])=>{o.searchParams.append(u,`${h}`)})):(a="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new pt({method:a,url:o,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const on="2.9.3",ln={"X-Client-Info":`realtime-js/${on}`},cn="1.0.0",yr=1e4,un=1e3;var _t;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(_t||(_t={}));var Ce;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ce||(Ce={}));var Re;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Re||(Re={}));var as;(function(r){r.websocket="websocket"})(as||(as={}));var it;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(it||(it={}));class br{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class hn{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+i));a=a+i;const l=s.decode(e.slice(a,a+n));a=a+n;const c=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class Yt{constructor(e,t,s={},i=yr){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var $s;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})($s||($s={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,i,n,a),this.pendingDiffs.forEach(l=>{this.state=Ot.syncDiff(this.state,l,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ot.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(n,(c,u)=>{a[c]||(l[c]=u)}),this.map(a,(c,u)=>{const h=n[c];if(h){const d=u.map(v=>v.presence_ref),g=h.map(v=>v.presence_ref),m=u.filter(v=>g.indexOf(v.presence_ref)<0),p=h.filter(v=>d.indexOf(v.presence_ref)<0);m.length>0&&(o[c]=m),p.length>0&&(l[c]=p)}else o[c]=u}),this.syncDiff(n,{joins:o,leaves:l},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(o,l)=>{var c;const u=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),u.length>0){const h=e[o].map(g=>g.presence_ref),d=u.filter(g=>h.indexOf(g.presence_ref)<0);e[o].unshift(...d)}s(o,u,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=c,i(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var re;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(re||(re={}));const xs=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,a)=>(n[a]=dn(a,r,e,i),n),{})},dn=(r,e,t,s)=>{const i=e.find(o=>o.name===r),n=i==null?void 0:i.type,a=t[r];return n&&!s.includes(n)?wr(n,a):os(a)},wr=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return pn(e,t)}switch(r){case re.bool:return fn(e);case re.float4:case re.float8:case re.int2:case re.int4:case re.int8:case re.numeric:case re.oid:return gn(e);case re.json:case re.jsonb:return mn(e);case re.timestamp:return vn(e);case re.abstime:case re.date:case re.daterange:case re.int4range:case re.int8range:case re.money:case re.reltime:case re.text:case re.time:case re.timestamptz:case re.timetz:case re.tsrange:case re.tstzrange:return os(e);default:return os(e)}},os=r=>r,fn=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},gn=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},mn=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},pn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>wr(e,o))}return r},vn=r=>typeof r=="string"?r.replace(" ","T"):r;var Ds;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ds||(Ds={}));var Ls;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes"})(Ls||(Ls={}));var Us;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Us||(Us={}));class _s{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Yt(this,Re.join,this.params,this.timeout),this.rejoinTimer=new br(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ce.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ce.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Re.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new Ot(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const o={},l={broadcast:n,presence:a,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&i!==void 0?i:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var u;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,d=(u=h==null?void 0:h.length)!==null&&u!==void 0?u:0,g=[];for(let m=0;m<d;m++){const p=h[m],{filter:{event:v,schema:L,table:I,filter:j}}=p,S=c&&c[m];if(S&&S.event===v&&S.schema===L&&S.table===I&&S.filter===j)g.push(Object.assign(Object.assign({},p),{id:S.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,o={method:"POST",headers:{apikey:(s=this.socket.apiKey)!==null&&s!==void 0?s:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=t.timeout)!==null&&i!==void 0?i:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ce.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Re.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const i=new Yt(this,Re.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Yt(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:u}=Re;if(s&&[o,l,c,u].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var m,p,v;return((m=g.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(p=g.filter)===null||p===void 0?void 0:p.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(g=>g.callback(d,s)):(n=this.bindings[a])===null||n===void 0||n.filter(g=>{var m,p,v,L,I,j;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const S=g.id,U=(m=g.filter)===null||m===void 0?void 0:m.event;return S&&((p=t.ids)===null||p===void 0?void 0:p.includes(S))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const S=(I=(L=g==null?void 0:g.filter)===null||L===void 0?void 0:L.event)===null||I===void 0?void 0:I.toLocaleLowerCase();return S==="*"||S===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof d=="object"&&"ids"in d){const m=d.data,{schema:p,table:v,commit_timestamp:L,type:I,errors:j}=m;d=Object.assign(Object.assign({},{schema:p,table:v,commit_timestamp:L,eventType:I,new:{},old:{},errors:j}),this._getPayloadRecords(m))}g.callback(d,s)})}_isClosed(){return this.state===Ce.closed}_isJoined(){return this.state===Ce.joined}_isJoining(){return this.state===Ce.joining}_isLeaving(){return this.state===Ce.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&_s.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Re.close,{},e)}_onError(e){this._on(Re.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ce.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=xs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=xs(e.columns,e.old_record)),t}}const _n=()=>{},yn=typeof WebSocket<"u";class bn{constructor(e,t){var s;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=ln,this.params={},this.timeout=yr,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=_n,this.conn=null,this.sendBuffer=[],this.serializer=new hn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:l})=>l(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${as.websocket}`,t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new br(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(yn){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new wn(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),lt(()=>import("./browser.DJ8aI_fx.js").then(e=>e.b),[],import.meta.url).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case _t.connecting:return it.Connecting;case _t.open:return it.Open;case _t.closing:return it.Closing;default:return it.Closed}}isConnected(){return this.connectionState()===it.Open}channel(e,t={config:{}}){const s=new _s(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Re.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:cn}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:n,ref:a}=t;(a&&a===this.pendingHeartbeatRef||i===(n==null?void 0:n.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${i} ${a&&"("+a+")"||""}`,n),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(i,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Re.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(un,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class wn{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=_t.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ys extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function be(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class kn extends ys{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ns extends ys{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var En=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const kr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Sn=()=>En(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url)).Response:Response});var St=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const Qt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Tn=(r,e)=>St(void 0,void 0,void 0,function*(){const t=yield Sn();r instanceof t?r.json().then(s=>{e(new kn(Qt(s),r.status||500))}).catch(s=>{e(new Ns(Qt(s),s))}):e(new Ns(Qt(r),r))}),Cn=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};function zt(r,e,t,s,i,n){return St(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Cn(e,s,i,n)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>Tn(l,o))})})}function ls(r,e,t,s){return St(this,void 0,void 0,function*(){return zt(r,"GET",e,t,s)})}function He(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"POST",e,s,i,t)})}function Pn(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"PUT",e,s,i,t)})}function Er(r,e,t,s,i){return St(this,void 0,void 0,function*(){return zt(r,"DELETE",e,s,i,t)})}var Ae=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const On={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ms={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class An{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=kr(i)}uploadOrUpdate(e,t,s,i){return Ae(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Ms),i),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",a.cacheControl)):(n=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),h=yield u.json();return u.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(n){if(be(n))return{data:null,error:n};throw n}})}upload(e,t,s){return Ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return Ae(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Ms.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",c.cacheControl)):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:u}),d=yield h.json();return h.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(be(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e){return Ae(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const s=yield He(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),i=new URL(this.url+s.url),n=i.searchParams.get("token");if(!n)throw new ys("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}})}update(e,t,s){return Ae(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}copy(e,t){return Ae(this,void 0,void 0,function*(){try{return{data:{path:(yield He(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,s){return Ae(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield He(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if(be(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return Ae(this,void 0,void 0,function*(){try{const i=yield He(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(be(i))return{data:null,error:i};throw i}})}download(e,t){return Ae(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield ls(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(be(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${c}`)}}}remove(e){return Ae(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}})}list(e,t,s){return Ae(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},On),t),{prefix:e||""});return{data:yield He(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(be(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const In="2.5.5",jn={"X-Client-Info":`storage-js/${In}`};var dt=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Rn{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},jn),t),this.fetch=kr(s)}listBuckets(){return dt(this,void 0,void 0,function*(){try{return{data:yield ls(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(be(e))return{data:null,error:e};throw e}})}getBucket(e){return dt(this,void 0,void 0,function*(){try{return{data:yield ls(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return dt(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return dt(this,void 0,void 0,function*(){try{return{data:yield Pn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}emptyBucket(e){return dt(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}})}deleteBucket(e){return dt(this,void 0,void 0,function*(){try{return{data:yield Er(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}})}}class $n extends Rn{constructor(e,t={},s){super(e,t,s)}from(e){return new An(this.url,this.headers,e,this.fetch)}}const xn="2.42.1";let Ct="";typeof Deno<"u"?Ct="deno":typeof document<"u"?Ct="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ct="react-native":Ct="node";const Dn={"X-Client-Info":`supabase-js-${Ct}/${xn}`},Ln={headers:Dn},Un={schema:"public"},Nn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mn={};var Bn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};const qn=r=>{let e;return r?e=r:typeof fetch>"u"?e=ps:e=fetch,(...t)=>e(...t)},Fn=()=>typeof Headers>"u"?_r:Headers,Vn=(r,e,t)=>{const s=qn(t),i=Fn();return(n,a)=>Bn(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:r;let c=new i(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(n,Object.assign(Object.assign({},a),{headers:c}))})};function Hn(r){return r.replace(/\/$/,"")}function zn(r,e){const{db:t,auth:s,realtime:i,global:n}=r,{db:a,auth:o,realtime:l,global:c}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),n)}}const Sr="2.63.0",Gn="http://localhost:9999",Jn="supabase.auth.token",Kn={"X-Client-Info":`gotrue-js/${Sr}`},Bs=10,cs="X-Supabase-Api-Version",Tr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Wn(r){return Math.round(Date.now()/1e3)+r}function Xn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const je=()=>typeof document<"u",rt={tested:!1,writable:!1},At=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(rt.tested)return rt.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),rt.tested=!0,rt.writable=!0}catch{rt.tested=!0,rt.writable=!1}return rt.writable};function Zt(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const Cr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>lt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Yn=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Pr=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Bt=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},es=async(r,e)=>{await r.removeItem(e)};function Qn(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,i,n,a,o,l,c,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)a=e.indexOf(r.charAt(u++)),o=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),s=a<<2|o>>4,i=(o&15)<<4|l>>2,n=(l&3)<<6|c,t=t+String.fromCharCode(s),l!=64&&i!=0&&(t=t+String.fromCharCode(i)),c!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class Gt{constructor(){this.promise=new Gt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Gt.promiseConstructor=Promise;function qs(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(Qn(s))}async function Zn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ei(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){s(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function ti(r){return("0"+r.toString(16)).substr(-2)}function si(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,ti).join("")}async function ri(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}function ni(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ii(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await ri(r);return ni(t)}async function ft(r,e,t=!1){const s=si();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await Pr(r,`${e}-code-verifier`,i);const n=await ii(s);return[n,s===n?"plain":"s256"]}const ai=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oi(r){const e=r.headers.get(cs);if(!e||!e.match(ai))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class bs extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function W(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class li extends bs{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function ci(r){return W(r)&&r.name==="AuthApiError"}class Or extends bs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ct extends bs{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class gt extends ct{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ts extends ct{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qt extends ct{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends ct{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Fs extends ct{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class us extends ct{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ss(r){return W(r)&&r.name==="AuthRetryableFetchError"}class Vs extends ct{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var ui=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};const nt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),hi=[502,503,504];async function Hs(r){var e;if(!Yn(r))throw new us(nt(r),0);if(hi.includes(r.status))throw new us(nt(r),r.status);let t;try{t=await r.json()}catch(n){throw new Or(nt(n),n)}let s;const i=oi(r);if(i&&i.getTime()>=Tr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Vs(nt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new Vs(nt(t),r.status,t.weak_password.reasons);throw new li(nt(t),r.status||500,s)}const di=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function X(r,e,t,s){var i;const n=Object.assign({},s==null?void 0:s.headers);n[cs]||(n[cs]=Tr["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const a=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await fi(r,e,t+o,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function fi(r,e,t,s,i,n){const a=di(e,s,i,n);let o;try{o=await r(t,Object.assign(Object.assign({},a),{cache:"no-store"}))}catch(l){throw console.error(l),new us(nt(l),0)}if(o.ok||await Hs(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(l){await Hs(l)}}function Ve(r){var e;let t=null;vi(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Wn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function zs(r){const e=Ve(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function ze(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function gi(r){return{data:r,error:null}}function mi(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,a=ui(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function pi(r){return r}function vi(r){return r.access_token&&r.refresh_token&&r.expires_in}var _i=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};class yi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Cr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await X(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(W(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await X(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ze})}catch(s){if(W(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=_i(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await X(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:mi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(W(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await X(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ze})}catch(t){if(W(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},u=await X(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:pi});if(u.error)throw u.error;const h=await u.json(),d=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=p}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(W(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await X(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ze})}catch(t){if(W(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await X(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ze})}catch(s){if(W(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await X(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ze})}catch(s){if(W(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await X(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(W(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await X(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(W(t))return{data:null,error:t};throw t}}}const bi={getItem:r=>At()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{At()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{At()&&globalThis.localStorage.removeItem(r)}};function Gs(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function wi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const mt={debug:!!(globalThis&&At()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ar extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ki extends Ar{}async function Ei(r,e,t){mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),mt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw mt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new ki(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(mt.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}wi();const Si={url:Gn,storageKey:Jn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Kn,flowType:"implicit",debug:!1},Tt=30*1e3,Js=3;async function Ks(r,e,t){return await t()}class jt{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.insecureGetSessionWarningShown=!1,this.instanceID=jt.nextInstanceID,jt.nextInstanceID+=1,this.instanceID>0&&je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Si),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new yi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Cr(i.fetch),this.lock=i.lock||Ks,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,i.lock?this.lock=i.lock:je()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ei:this.lock=Ks,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:At()?this.storage=bi:(this.memoryStorage={},this.storage=Gs(this.memoryStorage)):(this.memoryStorage={},this.storage=Gs(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Sr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=je()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),(s==null?void 0:s.message)==="Identity is already linked"||(s==null?void 0:s.message)==="Identity is already linked to another user"?{error:s}:(await this._removeSession(),{error:s});const{session:i,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return W(e)?{error:e}:{error:new Or("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{await this._removeSession();const n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Ve}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(W(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,i;try{await this._removeSession();let n;if("email"in e){const{email:u,password:h,options:d}=e;let g=null,m=null;this.flowType==="pkce"&&([g,m]=await ft(this.storage,this.storageKey)),n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:u,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:g,code_challenge_method:m},xform:Ve})}else if("phone"in e){const{phone:u,password:h,options:d}=e;n=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(i=d==null?void 0:d.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Ve})}else throw new qt("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(W(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zs})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zs})}else throw new qt("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ts}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/"),{data:n,error:a}=await X(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Ve});return await es(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new ts}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:s,token:i,access_token:n,nonce:a}=e,o=await X(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ve}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ts}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if(await this._removeSession(),"email"in e){const{email:o,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await ft(this.storage,this.storageKey));const{error:h}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:u}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new qt("You must provide either an email or phone number.")}catch(o){if(W(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await X(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:Ve});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(W(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{await this._removeSession();let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await ft(this.storage,this.storageKey)),await X(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:gi})}catch(n){if(W(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new gt;const{error:i}=await X(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(W(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:a}=await X(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:a,error:o}=await X(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new qt("You must provide either an email or phone number and a type")}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;const e=await this._acquireLock(-1,async()=>this._useSession(async t=>t));return e.data&&this.storage.isServer&&(this.insecureGetSessionWarningShown||(console.warn("Using supabase.auth.getSession() is potentially insecure as it loads data directly from the storage medium (typically cookies) which may not be authentic. Prefer using supabase.auth.getUser() instead. To suppress this warning call supabase.auth.getUser() before you call supabase.auth.getSession()."),this.insecureGetSessionWarningShown=!0)),e}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=e.user;delete e.user,Object.defineProperty(e,"user",{enumerable:!0,get:()=>(e.__suppressUserWarning||console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a),set:o=>{a=o}})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data&&this.storage.isServer&&(this.insecureGetSessionWarningShown=!0),t}async _getUser(e){try{return e?await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ze}):await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:ze})})}catch(t){if(W(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new gt;const a=i.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await ft(this.storage,this.storageKey));const{data:c,error:u}=await X(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:ze});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(W(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return qs(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new gt;const t=Date.now()/1e3;let s=t,i=!0,n=null;const a=qs(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(W(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new gt;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(W(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!je())throw new Ft("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Ft("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Fs("Not a valid PKCE flow url.");const t=Zt(window.location.href);if(e){if(!t.code)throw new Fs("No code detected.");const{data:I,error:j}=await this._exchangeCodeForSession(t.code);if(j)throw j;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:I.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ft(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=t;if(!n||!o||!a||!c)throw new Ft("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let d=u+h;l&&(d=parseInt(l));const g=d-u;g*1e3<=Tt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${h}s`);const m=d-h;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,d,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,d,u);const{data:p,error:v}=await this._getUser(n);if(v)throw v;const L={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:h,expires_at:d,refresh_token:a,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:L,redirectType:t.type},error:null}}catch(t){if(W(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Zt(window.location.href);return!!(je()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Zt(window.location.href),t=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{error:n};const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(ci(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(await this._removeSession(),await es(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Xn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await ft(this.storage,this.storageKey,!0));try{return await X(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(W(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(W(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var a,o,l,c,u;const{data:h,error:d}=n;if(d)throw d;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await X(this.fetch,"GET",g,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(W(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await X(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(W(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await ei(async i=>(await Zn(i*200),this._debug(t,"refreshing attempt",i),await X(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ve})),(i,n,a)=>a&&a.error&&ss(a.error)&&Date.now()+(i+1)*200-s<Tt)}catch(s){if(this._debug(t,"error",s),W(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),je()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Bt(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<i+Bs;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Bs}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),ss(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new gt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Gt;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new gt;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),W(n)){const a={session:null,error:n};return ss(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await Pr(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await es(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Tt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/Tt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Tt}ms, refresh threshold is ${Js} ticks`),i<=Js&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ar)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,a]=await ft(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await X(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(W(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)return{data:null,error:a};const{data:o,error:l}=await X(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(!((i=o==null?void 0:o.totp)===null||i===void 0)&&i.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(W(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(W(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(W(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:s,totp:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(i.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}}jt.nextInstanceID=0;const Ti=jt;class Ci extends Ti{constructor(e){super(e)}}var Pi=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(s.next(u))}catch(h){a(h)}}function l(u){try{c(s.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):i(u.value).then(o,l)}c((s=s.apply(r,e||[])).next())})};class Oi{constructor(e,t,s){var i,n,a,o,l,c,u,h;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=Hn(e);this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const g=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,m={db:Un,realtime:Mn,auth:Object.assign(Object.assign({},Nn),{storageKey:g}),global:Ln},p=zn(s??{},m);this.storageKey=(n=(i=p.auth)===null||i===void 0?void 0:i.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=(a=p.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((l=p.auth)!==null&&l!==void 0?l:{},this.headers,(c=p.global)===null||c===void 0?void 0:c.fetch),this.fetch=Vn(t,this._getAccessToken.bind(this),(u=p.global)===null||u===void 0?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new vs(`${d}/rest/v1`,{headers:this.headers,schema:(h=p.db)===null||h===void 0?void 0:h.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Wr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new $n(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Pi(this,void 0,void 0,function*(){const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:n,flowType:a,debug:o},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ci({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,debug:o,fetch:c})}_initRealtimeClient(e){return new bn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ai=(r,e,t)=>new Oi(r,e,t),Ii="https://wypbvklzgwgrjmlnmfzg.supabase.co",ji="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind5cGJ2a2x6Z3dncmptbG5tZnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTI4NTY5MzcsImV4cCI6MjAyODQzMjkzN30.NCndBtOFVDpXc4GgbWIlEFsmBlH_p1OILPDv-RnitpU",de=Ai(Ii,ji),ot=xe(),Ge=xe([]),Pt=xe([]),vt=xe([]),at=xe([]),Ir=Br({maxTeams:4,maxChallenges:25,pointDecrement:1,maxPointDecrement:2}),yt=xe(null),rs=xe(null),Me=xe(!1),It=xe(!1),Ws=xe(!1),Ri=qr([Ge,Pt,vt,Ir],([r,e,t,s])=>r.map(i=>({team:i.id,points:t.filter(n=>n.team===i.id).map(n=>n.challenge).map(n=>e.find(a=>a.id===n).points-s.pointDecrement*(e.find(a=>a.id===n).type==="main"?1:0)*Math.min(t.filter(a=>a.challenge===n).sort((a,o)=>a.created_at-o.created_at).findIndex(a=>a.team===i.id),s.maxPointDecrement)).reduce((n,a)=>n+a,0)})).sort((i,n)=>n.points-i.points));function jr(r){const e=r-1;return e*e*e+1}function Vt(r,{delay:e=0,duration:t=400,easing:s=Lr}={}){const i=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:s,css:n=>`opacity: ${n*i}`}}function Rr(r,{delay:e=0,duration:t=400,easing:s=jr,x:i=0,y:n=0,opacity:a=0}={}){const o=getComputedStyle(r),l=+o.opacity,c=o.transform==="none"?"":o.transform,u=l*(1-a),[h,d]=js(i),[g,m]=js(n);return{delay:e,duration:t,easing:s,css:(p,v)=>`
			transform: ${c} translate(${(1-p)*h}${d}, ${(1-p)*g}${m});
			opacity: ${l-u*v}`}}function Rt(r,{delay:e=0,duration:t=400,easing:s=jr,start:i=0,opacity:n=0}={}){const a=getComputedStyle(r),o=+a.opacity,l=a.transform==="none"?"":a.transform,c=1-i,u=o*(1-n);return{delay:e,duration:t,easing:s,css:(h,d)=>`
			transform: ${l} scale(${1-c*d});
			opacity: ${o-u*d}
		`}}function $i(r){let e,t,s,i,n,a,o,l,c,u,h,d;return{c(){e=O("div"),t=O("img"),i=G(),n=O("img"),o=G(),l=O("img"),u=G(),h=O("span"),d=Ee(r[0]),this.h()},l(g){e=A(g,"DIV",{class:!0});var m=M(e);t=A(m,"IMG",{class:!0,src:!0,alt:!0}),i=J(m),n=A(m,"IMG",{class:!0,style:!0,src:!0,alt:!0}),o=J(m),l=A(m,"IMG",{class:!0,src:!0,alt:!0}),u=J(m),h=A(m,"SPAN",{class:!0,style:!0});var p=M(h);d=Se(p,r[0]),p.forEach(T),m.forEach(T),this.h()},h(){w(t,"class","empty-orb svelte-11lsvvr"),Oe(t.src,s="images/interface/Empty Orb.png")||w(t,"src",s),w(t,"alt","points"),w(n,"class","full-orb svelte-11lsvvr"),he(n,"--percentage",(1-r[1])*100+"%"),Oe(n.src,a="images/interface/Full Orb.png")||w(n,"src",a),w(n,"alt","points"),w(l,"class","heart svelte-11lsvvr"),Oe(l.src,c="images/interface/Point Counter.png")||w(l,"src",c),w(l,"alt","points"),w(h,"class","points svelte-11lsvvr"),he(h,"color","hsl("+r[2]+", 100%, 50%)"),w(e,"class","frame svelte-11lsvvr")},m(g,m){K(g,e,m),b(e,t),b(e,i),b(e,n),b(e,o),b(e,l),b(e,u),b(e,h),b(h,d)},p(g,[m]){m&2&&he(n,"--percentage",(1-g[1])*100+"%"),m&1&&Pe(d,g[0]),m&4&&he(h,"color","hsl("+g[2]+", 100%, 50%)")},i:$e,o:$e,d(g){g&&T(e)}}}function xi(r,e,t){let s,i,{currentHealth:n=99}=e,{maxHealth:a=100}=e;return r.$$set=o=>{"currentHealth"in o&&t(0,n=o.currentHealth),"maxHealth"in o&&t(3,a=o.maxHealth)},r.$$.update=()=>{r.$$.dirty&9&&t(1,s=n/a),r.$$.dirty&2&&t(2,i=s*120)},[n,s,i,a]}class Di extends Ke{constructor(e){super(),We(this,e,xi,$i,Je,{currentHealth:0,maxHealth:3})}}function Xs(r,e,t){const s=r.slice();return s[11]=e[t],s}function Ys(r){let e,t=r[11]+"",s;return{c(){e=O("div"),s=Ee(t),this.h()},l(i){e=A(i,"DIV",{class:!0});var n=M(e);s=Se(n,t),n.forEach(T),this.h()},h(){w(e,"class","name svelte-1fi249y")},m(i,n){K(i,e,n),b(e,s)},p(i,n){n&1&&t!==(t=i[11]+"")&&Pe(s,t)},d(i){i&&T(e)}}}function Qs(r){let e,t='<img class="crown svelte-1fi249y" src="images/Yellow Hat.png" alt="Crown"/>',s,i;return{c(){e=O("div"),e.innerHTML=t,this.h()},l(n){e=A(n,"DIV",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-w11w9r"&&(e.innerHTML=t),this.h()},h(){w(e,"class","crown-container svelte-1fi249y")},m(n,a){K(n,e,a),i=!0},i(n){i||(n&&Et(()=>{i&&(s||(s=wt(e,Rt,{},!0)),s.run(1))}),i=!0)},o(n){n&&(s||(s=wt(e,Rt,{},!1)),s.run(0)),i=!1},d(n){n&&T(e),n&&s&&s.end()}}}function Li(r){let e,t,s,i,n,a,o,l,c,u,h,d,g,m,p,v,L,I;u=new Di({props:{maxHealth:r[1],currentHealth:r[2]}});let j=Ie(r[0].name.split(" ")),S=[];for(let k=0;k<j.length;k+=1)S[k]=Ys(Xs(r,j,k));let U=r[4]&&Qs();return{c(){e=O("button"),t=O("div"),s=G(),i=O("div"),n=G(),a=O("div"),o=O("img"),c=G(),Xe(u.$$.fragment),h=G(),d=O("div");for(let k=0;k<S.length;k+=1)S[k].c();g=G(),U&&U.c(),this.h()},l(k){e=A(k,"BUTTON",{class:!0,style:!0});var f=M(e);t=A(f,"DIV",{class:!0}),M(t).forEach(T),s=J(f),i=A(f,"DIV",{class:!0,style:!0}),M(i).forEach(T),n=J(f),a=A(f,"DIV",{class:!0,style:!0});var y=M(a);o=A(y,"IMG",{class:!0,src:!0,alt:!0}),c=J(y),Ye(u.$$.fragment,y),h=J(y),d=A(y,"DIV",{class:!0});var _=M(d);for(let R=0;R<S.length;R+=1)S[R].l(_);_.forEach(T),y.forEach(T),g=J(f),U&&U.l(f),f.forEach(T),this.h()},h(){w(t,"class","fade svelte-1fi249y"),w(i,"class","border svelte-1fi249y"),he(i,"border-image","url('images/interface/Message Border.png') 8 / 8px repeat"),w(o,"class","banner svelte-1fi249y"),Oe(o.src,l="images/interface/Banner "+r[0].number+".png")||w(o,"src",l),w(o,"alt","Asgarnia Banner"),w(d,"class","name-container svelte-1fi249y"),w(a,"class","content svelte-1fi249y"),he(a,"background-image","url('images/interface/"+r[3]+".png')"),w(e,"class","team svelte-1fi249y"),e.disabled=m=!r[5],he(e,"order",r[0].number),ge(e,"selected",r[0]===r[6]),ge(e,"editable",r[5])},m(k,f){K(k,e,f),b(e,t),b(e,s),b(e,i),b(e,n),b(e,a),b(a,o),b(a,c),Qe(u,a,null),b(a,h),b(a,d);for(let y=0;y<S.length;y+=1)S[y]&&S[y].m(d,null);b(e,g),U&&U.m(e,null),v=!0,L||(I=[ye(e,"click",r[7]),ye(e,"dblclick",r[8])],L=!0)},p(k,[f]){(!v||f&1&&!Oe(o.src,l="images/interface/Banner "+k[0].number+".png"))&&w(o,"src",l);const y={};if(f&2&&(y.maxHealth=k[1]),f&4&&(y.currentHealth=k[2]),u.$set(y),f&1){j=Ie(k[0].name.split(" "));let _;for(_=0;_<j.length;_+=1){const R=Xs(k,j,_);S[_]?S[_].p(R,f):(S[_]=Ys(R),S[_].c(),S[_].m(d,null))}for(;_<S.length;_+=1)S[_].d(1);S.length=j.length}(!v||f&8)&&he(a,"background-image","url('images/interface/"+k[3]+".png')"),k[4]?U?f&16&&ee(U,1):(U=Qs(),U.c(),ee(U,1),U.m(e,null)):U&&(Be(),le(U,1,1,()=>{U=null}),qe()),(!v||f&32&&m!==(m=!k[5]))&&(e.disabled=m),(!v||f&1)&&he(e,"order",k[0].number),(!v||f&65)&&ge(e,"selected",k[0]===k[6]),(!v||f&32)&&ge(e,"editable",k[5])},i(k){v||(ee(u.$$.fragment,k),ee(U),k&&(p||Et(()=>{p=gs(e,Rr,{x:-100,duration:300}),p.start()})),v=!0)},o(k){le(u.$$.fragment,k),le(U),v=!1},d(k){k&&T(e),Ze(u),fs(S,k),U&&U.d(),L=!1,Ht(I)}}}function Ui(r,e,t){let s,i,n,a,o,l,c;Q(r,rs,m=>t(10,a=m)),Q(r,Me,m=>t(5,o=m)),Q(r,yt,m=>t(6,l=m)),Q(r,Ri,m=>t(9,c=m));let{team:u}=e,{maxHealth:h}=e;function d(){o&&(Z(yt,l=u,l),Z(rs,a=null,a))}function g(){o&&(console.log("isolating team"),Z(rs,a=u,a))}return r.$$set=m=>{"team"in m&&t(0,u=m.team),"maxHealth"in m&&t(1,h=m.maxHealth)},r.$$.update=()=>{var m;r.$$.dirty&513&&t(2,s=((m=c.find(p=>p.team===u.id))==null?void 0:m.points)??0),r.$$.dirty&516&&t(4,i=c[0].points===s&&s>0),r.$$.dirty&1&&t(3,n=u.name.replace("'",""))},[u,h,s,n,i,o,l,d,g,c]}class Ni extends Ke{constructor(e){super(),We(this,e,Ui,Li,Je,{team:0,maxHealth:1})}}function Zs(r){let e,t,s,i,n,a,o,l,c,u=":",h,d,g,m,p,v=":",L,I,j;return{c(){e=O("div"),t=O("span"),s=Ee(r[5]),i=G(),n=O("div"),a=O("span"),o=Ee(r[4]),l=G(),c=O("span"),c.textContent=u,h=G(),d=O("span"),g=Ee(r[3]),m=G(),p=O("span"),p.textContent=v,L=G(),I=O("span"),j=Ee(r[2]),this.h()},l(S){e=A(S,"DIV",{class:!0});var U=M(e);t=A(U,"SPAN",{class:!0});var k=M(t);s=Se(k,r[5]),k.forEach(T),i=J(U),n=A(U,"DIV",{class:!0});var f=M(n);a=A(f,"SPAN",{class:!0});var y=M(a);o=Se(y,r[4]),y.forEach(T),l=J(f),c=A(f,"SPAN",{"data-svelte-h":!0}),fe(c)!=="svelte-5vnx5k"&&(c.textContent=u),h=J(f),d=A(f,"SPAN",{class:!0});var _=M(d);g=Se(_,r[3]),_.forEach(T),m=J(f),p=A(f,"SPAN",{"data-svelte-h":!0}),fe(p)!=="svelte-5vnx5k"&&(p.textContent=v),L=J(f),I=A(f,"SPAN",{class:!0});var R=M(I);j=Se(R,r[2]),R.forEach(T),f.forEach(T),U.forEach(T),this.h()},h(){w(t,"class","days svelte-tm63ju"),w(a,"class","time svelte-tm63ju"),w(d,"class","time svelte-tm63ju"),w(I,"class","time svelte-tm63ju"),w(n,"class","time-container svelte-tm63ju"),w(e,"class","line-1 svelte-tm63ju")},m(S,U){K(S,e,U),b(e,t),b(t,s),b(e,i),b(e,n),b(n,a),b(a,o),b(n,l),b(n,c),b(n,h),b(n,d),b(d,g),b(n,m),b(n,p),b(n,L),b(n,I),b(I,j)},p(S,U){U&32&&Pe(s,S[5]),U&16&&Pe(o,S[4]),U&8&&Pe(g,S[3]),U&4&&Pe(j,S[2])},d(S){S&&T(e)}}}function Mi(r){let e,t,s,i,n=r[0]>0&&Zs(r);return{c(){e=O("div"),n&&n.c(),t=G(),s=O("div"),i=Ee(r[1]),this.h()},l(a){e=A(a,"DIV",{class:!0,style:!0});var o=M(e);n&&n.l(o),t=J(o),s=A(o,"DIV",{class:!0});var l=M(s);i=Se(l,r[1]),l.forEach(T),o.forEach(T),this.h()},h(){w(s,"class","line-2 svelte-tm63ju"),w(e,"class","frame svelte-tm63ju"),he(e,"background-image","url('images/interface/Button Red.png')")},m(a,o){K(a,e,o),n&&n.m(e,null),b(e,t),b(e,s),b(s,i)},p(a,[o]){a[0]>0?n?n.p(a,o):(n=Zs(a),n.c(),n.m(e,t)):n&&(n.d(1),n=null),o&2&&Pe(i,a[1])},i:$e,o:$e,d(a){a&&T(e),n&&n.d()}}}function Bi(r,e,t){let s,i,n,a,o,l,c;Q(r,Me,p=>t(7,o=p)),Q(r,at,p=>t(8,l=p)),Q(r,ot,p=>t(6,c=p));let u,h="";const d={tournament:c.id,text:"Bingo Over",type:"completion",sender:"System"};async function g(p){if(console.log(l.some(L=>p.text===L.text)),!o||l.some(L=>p.text===L.text))return;const{error:v}=await de.from("messages").insert(p);if(v)return console.error("Error adding message",v),{status:500,error:"Could not add message"}}async function m(p){if(!o)return;const{error:v}=await de.from("messages").delete().eq("text",p.text);if(v)return console.error("Error removing message",v),{status:500,error:"Could not remove message"}}return r.$$.update=()=>{r.$$.dirty&64&&setInterval(()=>{const p=new Date;switch(!0){case p<new Date(c.startTime):t(1,h="To Start"),t(0,u=Math.abs(p-new Date(c.startTime))),m(d);break;case(p>new Date(c.startTime)&&p<new Date(c.endTime)):t(1,h="To End"),t(0,u=Math.abs(p-new Date(c.startTime))),m(d);break;case p>=new Date(c.endTime):t(1,h="Bingo Over"),t(0,u=0),g(d);break}},1e3),r.$$.dirty&1&&t(5,s=`${Math.floor(u/(1e3*60*60*24))}D`),r.$$.dirty&1&&t(4,i=`${Math.floor(u%(1e3*60*60*24)/(1e3*60*60)).toString().padStart(2,"0")}`),r.$$.dirty&1&&t(3,n=`${Math.floor(u%(1e3*60*60)/(1e3*60)).toString().padStart(2,"0")}`),r.$$.dirty&1&&t(2,a=`${Math.floor(u%(1e3*60)/1e3).toString().padStart(2,"0")}`)},[u,h,a,n,i,s,c]}class qi extends Ke{constructor(e){super(),We(this,e,Bi,Mi,Je,{})}}function Fi(r){let e,t,s=r[0].sender+"",i,n,a,o,l=r[0].text+"",c;return{c(){e=O("div"),t=O("div"),i=Ee(s),n=Ee(":"),a=G(),o=O("div"),c=Ee(l),this.h()},l(u){e=A(u,"DIV",{class:!0});var h=M(e);t=A(h,"DIV",{class:!0});var d=M(t);i=Se(d,s),n=Se(d,":"),d.forEach(T),a=J(h),o=A(h,"DIV",{class:!0});var g=M(o);c=Se(g,l),g.forEach(T),h.forEach(T),this.h()},h(){w(t,"class","sender svelte-6g3s81"),ge(t,"yellow",r[1].some(r[2])),ge(t,"green",r[0].type==="admin"),ge(t,"orange",r[0].sender==="System"),w(o,"class","text svelte-6g3s81"),ge(o,"green",r[0].type==="admin"),w(e,"class","message svelte-6g3s81")},m(u,h){K(u,e,h),b(e,t),b(t,i),b(t,n),b(e,a),b(e,o),b(o,c)},p(u,[h]){h&1&&s!==(s=u[0].sender+"")&&Pe(i,s),h&3&&ge(t,"yellow",u[1].some(u[2])),h&1&&ge(t,"green",u[0].type==="admin"),h&1&&ge(t,"orange",u[0].sender==="System"),h&1&&l!==(l=u[0].text+"")&&Pe(c,l),h&1&&ge(o,"green",u[0].type==="admin")},i:$e,o:$e,d(u){u&&T(e)}}}function Vi(r,e,t){let s;Q(r,Ge,a=>t(1,s=a));let{message:i={sender:"Unknown",text:"Hello, World!"}}=e;const n=a=>a.name===i.sender;return r.$$set=a=>{"message"in a&&t(0,i=a.message)},[i,s,n]}class Hi extends Ke{constructor(e){super(),We(this,e,Vi,Fi,Je,{message:0})}}var zi=Object.defineProperty,Gi=(r,e,t)=>e in r?zi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ns=(r,e,t)=>(Gi(r,typeof e!="symbol"?e+"":e,t),t);class er{constructor(e,t={}){ns(this,"src"),ns(this,"options"),ns(this,"howl"),this.src=e,this.options=t,this.create()}async create(){const{Howl:e}=await lt(()=>import("./howler.core-e669a980.DveT1YBT.js"),[],import.meta.url).then(n=>n.h),{loop:t,volume:s}=this.options,i=new e({src:this.src,loop:t||!1,volume:s||1,...this.options});this.howl=i}update(e=this.options){this.unload(),this.options=e,this.create()}destroy(){this.stop(),this.unload()}play(){this.howl.play()}stop(){this.howl.stop()}unload(){this.howl.unload()}}function Ji(r){let e,t,s,i="Are you sure you want to reset this tournament? This cannot be undone.",n,a,o="Reset",l,c,u,h;return{c(){e=O("div"),t=O("div"),s=O("div"),s.textContent=i,n=G(),a=O("button"),a.textContent=o,this.h()},l(d){e=A(d,"DIV",{class:!0});var g=M(e);t=A(g,"DIV",{class:!0});var m=M(t);s=A(m,"DIV",{class:!0,"data-svelte-h":!0}),fe(s)!=="svelte-7z16sh"&&(s.textContent=i),n=J(m),a=A(m,"BUTTON",{class:!0,"data-svelte-h":!0}),fe(a)!=="svelte-kx2upl"&&(a.textContent=o),m.forEach(T),g.forEach(T),this.h()},h(){w(s,"class","message"),w(a,"class","button svelte-10km69n"),w(t,"class","card svelte-10km69n"),w(e,"class","frame svelte-10km69n")},m(d,g){K(d,e,g),b(e,t),b(t,s),b(t,n),b(t,a),c=!0,u||(h=[ye(window,"keydown",r[1]),ye(a,"click",r[0]),ye(e,"click",Ur(r[2]))],u=!0)},p:$e,i(d){c||(d&&Et(()=>{c&&(l||(l=wt(e,Vt,{duration:200},!0)),l.run(1))}),c=!0)},o(d){d&&(l||(l=wt(e,Vt,{duration:200},!1)),l.run(0)),c=!1},d(d){d&&T(e),d&&l&&l.end(),u=!1,Ht(h)}}}function Ki(r,e,t){let s,i;Q(r,It,c=>t(3,s=c)),Q(r,ot,c=>t(4,i=c));async function n(){const{error:c}=await de.from("completions").delete().eq("tournament",i.id);if(Z(It,s=!1,s),a(),c)return console.error("Error resetting challenges",c),{status:500,error:"Could not reset challenges"}}async function a(){const{error:c}=await de.from("messages").delete().eq("tournament",i.id);if(c)return console.error("Error resetting messages",c),{status:500,error:"Could not reset messages"}}function o(c){c.key==="Escape"&&l()}function l(){Z(It,s=!1,s)}return[n,o,l]}class Wi extends Ke{constructor(e){super(),We(this,e,Ki,Ji,Je,{})}}function tr(r,e,t){const s=r.slice();return s[23]=e[t],s}function sr(r){let e,t;return e=new Wi({}),{c(){Xe(e.$$.fragment)},l(s){Ye(e.$$.fragment,s)},m(s,i){Qe(e,s,i),t=!0},i(s){t||(ee(e.$$.fragment,s),t=!0)},o(s){le(e.$$.fragment,s),t=!1},d(s){Ze(e,s)}}}function rr(r){let e,t;return e=new Hi({props:{message:r[23]}}),{c(){Xe(e.$$.fragment)},l(s){Ye(e.$$.fragment,s)},m(s,i){Qe(e,s,i),t=!0},p(s,i){const n={};i&64&&(n.message=s[23]),e.$set(n)},i(s){t||(ee(e.$$.fragment,s),t=!0)},o(s){le(e.$$.fragment,s),t=!1},d(s){Ze(e,s)}}}function nr(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){w(e,"class","dance svelte-10w2kpg"),Oe(e.src,t="images/Dance.gif")||w(e,"src",t),w(e,"alt","Dance")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function Xi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){w(e,"class","off svelte-10w2kpg")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function Yi(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){w(e,"class","on svelte-10w2kpg")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function Qi(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){w(e,"class","off svelte-10w2kpg")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function Zi(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){w(e,"class","on svelte-10w2kpg")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function ea(r){let e,t="Off";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-73jf4n"&&(e.textContent=t),this.h()},h(){w(e,"class","off svelte-10w2kpg")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function ta(r){let e,t="On";return{c(){e=O("span"),e.textContent=t,this.h()},l(s){e=A(s,"SPAN",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-2m8585"&&(e.textContent=t),this.h()},h(){w(e,"class","on svelte-10w2kpg")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function sa(r){let e,t,s,i,n,a,o,l,c,u,h,d,g="Fensail:",m,p,v,L,I,j,S='<span class="name svelte-10w2kpg">Reveal</span>',U,k,f,y,_,R='<div class="line-1 svelte-10w2kpg"><span class="name svelte-10w2kpg">Snap</span></div>',q,N,$,F='<span class="name svelte-10w2kpg">Music</span>',C,D,te,ae,ce,E='<span class="name svelte-10w2kpg">Vibe</span>',P,H,pe,ue,x,z='<span class="name svelte-10w2kpg">Reset</span>',Y,V,ne,ve,ut='<span class="name svelte-10w2kpg">Logout</span>',Fe,Te,_e,De,et,Jt,ws,me=r[7]&&sr(),tt=Ie(r[6]),oe=[];for(let B=0;B<tt.length;B+=1)oe[B]=rr(tr(r,tt,B));const Dr=B=>le(oe[B],1,1,()=>{oe[B]=null});let we=r[4]&&nr();function ks(B,se){return B[3].isRevealed?Yi:Xi}let xt=ks(r),Le=xt(r);function Es(B,se){return B[2]?Zi:Qi}let Dt=Es(r),Ue=Dt(r);function Ss(B,se){return B[4]?ta:ea}let Lt=Ss(r),Ne=Lt(r);return _e=new qi({}),{c(){me&&me.c(),e=G(),t=O("div"),s=O("div"),i=O("div"),n=O("div");for(let B=0;B<oe.length;B+=1)oe[B].c();a=G(),we&&we.c(),o=G(),l=O("div"),c=O("img"),h=G(),d=O("span"),d.textContent=g,m=G(),p=O("input"),v=G(),L=O("div"),I=O("button"),j=O("div"),j.innerHTML=S,U=G(),k=O("div"),Le.c(),y=G(),_=O("button"),_.innerHTML=R,q=G(),N=O("button"),$=O("div"),$.innerHTML=F,C=G(),D=O("div"),Ue.c(),te=G(),ae=O("button"),ce=O("div"),ce.innerHTML=E,P=G(),H=O("div"),Ne.c(),pe=G(),ue=O("button"),x=O("div"),x.innerHTML=z,V=G(),ne=O("button"),ve=O("div"),ve.innerHTML=ut,Te=G(),Xe(_e.$$.fragment),this.h()},l(B){me&&me.l(B),e=J(B),t=A(B,"DIV",{class:!0});var se=M(t);s=A(se,"DIV",{class:!0,style:!0});var ie=M(s);i=A(ie,"DIV",{class:!0});var st=M(i);n=A(st,"DIV",{class:!0});var Ts=M(n);for(let Kt=0;Kt<oe.length;Kt+=1)oe[Kt].l(Ts);Ts.forEach(T),a=J(st),we&&we.l(st),st.forEach(T),o=J(ie),l=A(ie,"DIV",{class:!0});var ht=M(l);c=A(ht,"IMG",{class:!0,src:!0,alt:!0}),h=J(ht),d=A(ht,"SPAN",{class:!0,"data-svelte-h":!0}),fe(d)!=="svelte-1w3y9cz"&&(d.textContent=g),m=J(ht),p=A(ht,"INPUT",{class:!0,type:!0}),ht.forEach(T),ie.forEach(T),v=J(se),L=A(se,"DIV",{class:!0});var ke=M(L);I=A(ke,"BUTTON",{class:!0,style:!0});var Ut=M(I);j=A(Ut,"DIV",{class:!0,"data-svelte-h":!0}),fe(j)!=="svelte-5tg6go"&&(j.innerHTML=S),U=J(Ut),k=A(Ut,"DIV",{class:!0});var Cs=M(k);Le.l(Cs),Cs.forEach(T),Ut.forEach(T),y=J(ke),_=A(ke,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),fe(_)!=="svelte-sugqyf"&&(_.innerHTML=R),q=J(ke),N=A(ke,"BUTTON",{class:!0,style:!0});var Nt=M(N);$=A(Nt,"DIV",{class:!0,"data-svelte-h":!0}),fe($)!=="svelte-1ar69di"&&($.innerHTML=F),C=J(Nt),D=A(Nt,"DIV",{class:!0});var Ps=M(D);Ue.l(Ps),Ps.forEach(T),Nt.forEach(T),te=J(ke),ae=A(ke,"BUTTON",{class:!0,style:!0});var Mt=M(ae);ce=A(Mt,"DIV",{class:!0,"data-svelte-h":!0}),fe(ce)!=="svelte-1xgdo1x"&&(ce.innerHTML=E),P=J(Mt),H=A(Mt,"DIV",{class:!0});var Os=M(H);Ne.l(Os),Os.forEach(T),Mt.forEach(T),pe=J(ke),ue=A(ke,"BUTTON",{class:!0,style:!0});var As=M(ue);x=A(As,"DIV",{class:!0,"data-svelte-h":!0}),fe(x)!=="svelte-6vd44i"&&(x.innerHTML=z),As.forEach(T),V=J(ke),ne=A(ke,"BUTTON",{class:!0,style:!0});var Is=M(ne);ve=A(Is,"DIV",{class:!0,"data-svelte-h":!0}),fe(ve)!=="svelte-1ich0qb"&&(ve.innerHTML=ut),Is.forEach(T),Te=J(ke),Ye(_e.$$.fragment,ke),ke.forEach(T),se.forEach(T),this.h()},h(){w(n,"class","messages svelte-10w2kpg"),w(i,"class","messages-container svelte-10w2kpg"),w(c,"class","icon svelte-10w2kpg"),Oe(c.src,u="images/interface/Chat Helmet.png")||w(c,"src",u),w(c,"alt","Ironman"),w(d,"class","input-name white text svelte-10w2kpg"),w(p,"class","input white text svelte-10w2kpg"),w(p,"type","text"),w(l,"class","input-container svelte-10w2kpg"),w(s,"class","chat-box svelte-10w2kpg"),he(s,"border-image","url('images/interface/Message Border.png') 8 / 16px repeat"),w(j,"class","line-1 svelte-10w2kpg"),w(k,"class","line-2 svelte-10w2kpg"),w(I,"class","button svelte-10w2kpg"),I.disabled=f=!r[5],he(I,"background-image","url('images/interface/Button Brown.png')"),w(_,"class","button svelte-10w2kpg"),he(_,"background-image","url('images/interface/Button Brown.png')"),w($,"class","line-1 svelte-10w2kpg"),w(D,"class","line-2 svelte-10w2kpg"),w(N,"class","button svelte-10w2kpg"),he(N,"background-image","url('images/interface/Button Brown.png')"),w(ce,"class","line-1 svelte-10w2kpg"),w(H,"class","line-2 svelte-10w2kpg"),w(ae,"class","button svelte-10w2kpg"),he(ae,"background-image","url('images/interface/Button Brown.png')"),w(x,"class","line-1 svelte-10w2kpg"),w(ue,"class","button svelte-10w2kpg"),ue.disabled=Y=!r[5],he(ue,"background-image","url('images/interface/Button Brown.png')"),w(ve,"class","line-1 svelte-10w2kpg"),w(ne,"class","button svelte-10w2kpg"),ne.disabled=Fe=!r[5],he(ne,"background-image","url('images/interface/Button Brown.png')"),w(L,"class","buttons svelte-10w2kpg"),w(t,"class","menu svelte-10w2kpg")},m(B,se){me&&me.m(B,se),K(B,e,se),K(B,t,se),b(t,s),b(s,i),b(i,n);for(let ie=0;ie<oe.length;ie+=1)oe[ie]&&oe[ie].m(n,null);b(i,a),we&&we.m(i,null),b(s,o),b(s,l),b(l,c),b(l,h),b(l,d),b(l,m),b(l,p),Rs(p,r[0]),r[18](p),b(t,v),b(t,L),b(L,I),b(I,j),b(I,U),b(I,k),Le.m(k,null),b(L,y),b(L,_),b(L,q),b(L,N),b(N,$),b(N,C),b(N,D),Ue.m(D,null),b(L,te),b(L,ae),b(ae,ce),b(ae,P),b(ae,H),Ne.m(H,null),b(L,pe),b(L,ue),b(ue,x),b(L,V),b(L,ne),b(ne,ve),b(L,Te),Qe(_e,L,null),et=!0,Jt||(ws=[ye(window,"keydown",r[11]),ye(p,"focus",r[15]),ye(p,"blur",r[16]),ye(p,"input",r[17]),ye(I,"click",r[14]),ye(_,"click",r[9]),ye(N,"click",r[10]),ye(ae,"click",r[13]),ye(ue,"click",r[8]),ye(ne,"click",r[12])],Jt=!0)},p(B,[se]){if(B[7]?me?se&128&&ee(me,1):(me=sr(),me.c(),ee(me,1),me.m(e.parentNode,e)):me&&(Be(),le(me,1,1,()=>{me=null}),qe()),se&64){tt=Ie(B[6]);let ie;for(ie=0;ie<tt.length;ie+=1){const st=tr(B,tt,ie);oe[ie]?(oe[ie].p(st,se),ee(oe[ie],1)):(oe[ie]=rr(st),oe[ie].c(),ee(oe[ie],1),oe[ie].m(n,null))}for(Be(),ie=tt.length;ie<oe.length;ie+=1)Dr(ie);qe()}B[4]?we||(we=nr(),we.c(),we.m(i,null)):we&&(we.d(1),we=null),se&1&&p.value!==B[0]&&Rs(p,B[0]),xt!==(xt=ks(B))&&(Le.d(1),Le=xt(B),Le&&(Le.c(),Le.m(k,null))),(!et||se&32&&f!==(f=!B[5]))&&(I.disabled=f),Dt!==(Dt=Es(B))&&(Ue.d(1),Ue=Dt(B),Ue&&(Ue.c(),Ue.m(D,null))),Lt!==(Lt=Ss(B))&&(Ne.d(1),Ne=Lt(B),Ne&&(Ne.c(),Ne.m(H,null))),(!et||se&32&&Y!==(Y=!B[5]))&&(ue.disabled=Y),(!et||se&32&&Fe!==(Fe=!B[5]))&&(ne.disabled=Fe)},i(B){if(!et){ee(me);for(let se=0;se<tt.length;se+=1)ee(oe[se]);ee(_e.$$.fragment,B),B&&(De||Et(()=>{De=gs(t,Rr,{y:1e3,duration:1e3}),De.start()})),et=!0}},o(B){le(me),oe=oe.filter(Boolean);for(let se=0;se<oe.length;se+=1)le(oe[se]);le(_e.$$.fragment,B),et=!1},d(B){B&&(T(e),T(t)),me&&me.d(B),fs(oe,B),we&&we.d(),r[18](null),Le.d(),Ue.d(),Ne.d(),Ze(_e),Jt=!1,Ht(ws)}}}function ra(r,e,t){let s,i,n,a,o;Q(r,ot,_=>t(3,s=_)),Q(r,Ws,_=>t(4,i=_)),Q(r,Me,_=>t(5,n=_)),Q(r,at,_=>t(6,a=_)),Q(r,It,_=>t(7,o=_));let l="",c,u=!1;const h=Nr();let d=new er("/music/Inferno.ogg");function g(){Z(It,o=!0,o)}function m(){h("snap")}function p(){d||(d=new er("/music/Inferno.ogg")),d.howl.playing()?(d.howl.pause(),t(2,u=!1)):(d.howl.play(),t(2,u=!0))}async function v(_){if(!n||a.includes(_))return;const{error:R}=await de.from("messages").insert(_);if(R)return console.error("Error adding message",R),{status:500,error:"Could not add message"}}function L(_){if(_.key==="Enter"){switch(!0){case c!==document.activeElement:console.log("focusing"),c.focus();break;case l===s.secret:console.log("entering"),Z(Me,n=!0,n),localStorage.setItem("tournKey",JSON.stringify(s.secret));break;case(l!==s.secret&&n===!0):console.log("something here"),v({sender:"Fensail",text:l,tournament:s.id,type:"admin"});break;case(l!==s.secret&&n===!1):console.log("nothing here");break}t(0,l="")}}function I(){h("logout")}function j(){Z(Ws,i=!i,i)}async function S(){const{error:_}=await de.from("tournaments").update({isRevealed:!s.isRevealed}).eq("id",s.id);if(_)return console.error("Error toggling reveal",_),{status:500,error:"Could not toggle reveal"}}const U=()=>{console.log("focusing")},k=()=>{console.log("blurring")};function f(){l=this.value,t(0,l)}function y(_){pr[_?"unshift":"push"](()=>{c=_,t(1,c)})}return[l,c,u,s,i,n,a,o,g,m,p,L,I,j,S,U,k,f,y]}class na extends Ke{constructor(e){super(),We(this,e,ra,sa,Je,{})}}function ir(r,e,t){const s=r.slice();s[19]=e[t];const i=s[6].find(function(...a){return r[10](s[19],...a)}).number;return s[20]=i,s}function ia(r){let e,t,s;function i(o,l){return o[0].order===13?la:oa}let n=i(r),a=n(r);return{c(){e=O("div"),a.c(),this.h()},l(o){e=A(o,"DIV",{class:!0,style:!0});var l=M(e);a.l(l),l.forEach(T),this.h()},h(){w(e,"class","face back svelte-vlvfda"),he(e,"border-image","url('images/interface/Message Border.png') 8 / 4px repeat")},m(o,l){K(o,e,l),a.m(e,null),s=!0},p(o,l){n!==(n=i(o))&&(a.d(1),a=n(o),a&&(a.c(),a.m(e,null)))},i(o){s||(t&&t.end(1),s=!0)},o(o){o&&(t=vr(e,Vt,{delay:200})),s=!1},d(o){o&&T(e),a.d(),o&&t&&t.end()}}}function aa(r){let e,t,s,i,n,a=r[0].name+"",o,l,c,u,h,d,g,m,p=Ie(r[2]),v=[];for(let I=0;I<p.length;I+=1)v[I]=ar(ir(r,p,I));const L=I=>le(v[I],1,1,()=>{v[I]=null});return{c(){e=O("div"),t=O("img"),i=G(),n=O("div"),o=Ee(a),l=G(),c=O("div"),u=Ee(r[3]),h=G(),d=O("div");for(let I=0;I<v.length;I+=1)v[I].c();this.h()},l(I){e=A(I,"DIV",{class:!0,style:!0});var j=M(e);t=A(j,"IMG",{class:!0,src:!0}),i=J(j),n=A(j,"DIV",{class:!0});var S=M(n);o=Se(S,a),S.forEach(T),l=J(j),c=A(j,"DIV",{class:!0});var U=M(c);u=Se(U,r[3]),U.forEach(T),h=J(j),d=A(j,"DIV",{class:!0});var k=M(d);for(let f=0;f<v.length;f+=1)v[f].l(k);k.forEach(T),j.forEach(T),this.h()},h(){w(t,"class","challenge-icon svelte-vlvfda"),Oe(t.src,s="images/challenge-icons/"+r[0].name+".png")||w(t,"src",s),ge(t,"gray",r[4]),w(n,"class","name svelte-vlvfda"),w(c,"class","points svelte-vlvfda"),w(d,"class","completions svelte-vlvfda"),w(e,"class","face front svelte-vlvfda"),he(e,"border-image","url('images/interface/Message Border.png') 8 / 4px repeat")},m(I,j){K(I,e,j),b(e,t),b(e,i),b(e,n),b(n,o),b(e,l),b(e,c),b(c,u),b(e,h),b(e,d);for(let S=0;S<v.length;S+=1)v[S]&&v[S].m(d,null);m=!0},p(I,j){if((!m||j&1&&!Oe(t.src,s="images/challenge-icons/"+I[0].name+".png"))&&w(t,"src",s),(!m||j&16)&&ge(t,"gray",I[4]),(!m||j&1)&&a!==(a=I[0].name+"")&&Pe(o,a),(!m||j&8)&&Pe(u,I[3]),j&68){p=Ie(I[2]);let S;for(S=0;S<p.length;S+=1){const U=ir(I,p,S);v[S]?(v[S].p(U,j),ee(v[S],1)):(v[S]=ar(U),v[S].c(),ee(v[S],1),v[S].m(d,null))}for(Be(),S=p.length;S<v.length;S+=1)L(S);qe()}},i(I){if(!m){for(let j=0;j<p.length;j+=1)ee(v[j]);g&&g.end(1),m=!0}},o(I){v=v.filter(Boolean);for(let j=0;j<v.length;j+=1)le(v[j]);I&&(g=vr(e,Vt,{delay:200})),m=!1},d(I){I&&T(e),fs(v,I),I&&g&&g.end()}}}function oa(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){w(e,"class","icon blur svelte-vlvfda"),Oe(e.src,t="images/challenge-icons/Hidden 3.png")||w(e,"src",t),w(e,"alt","Hidden")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function la(r){let e,t;return{c(){e=O("img"),this.h()},l(s){e=A(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){w(e,"class","icon blur svelte-vlvfda"),Oe(e.src,t="images/challenge-icons/Hidden 4.png")||w(e,"src",t),w(e,"alt","Hidden")},m(s,i){K(s,e,i)},d(s){s&&T(e)}}}function ar(r){let e,t,s,i,n,a;return{c(){e=O("div"),t=O("img"),i=G(),this.h()},l(o){e=A(o,"DIV",{class:!0});var l=M(e);t=A(l,"IMG",{class:!0,src:!0}),i=J(l),l.forEach(T),this.h()},h(){w(t,"class","icon svelte-vlvfda"),Oe(t.src,s="images/interface/Banner "+r[20]+".png")||w(t,"src",s),w(e,"class","completion svelte-vlvfda")},m(o,l){K(o,e,l),b(e,t),b(e,i),a=!0},p(o,l){(!a||l&68&&!Oe(t.src,s="images/interface/Banner "+o[20]+".png"))&&w(t,"src",s)},i(o){a||(o&&Et(()=>{a&&(n||(n=wt(e,Rt,{},!0)),n.run(1))}),a=!0)},o(o){o&&(n||(n=wt(e,Rt,{},!1)),n.run(0)),a=!1},d(o){o&&T(e),o&&n&&n.end()}}}function ca(r){let e,t,s,i,n,a,o,l;const c=[aa,ia],u=[];function h(d,g){return d[1]?0:1}return t=h(r),s=u[t]=c[t](r),{c(){e=O("button"),s.c(),this.h()},l(d){e=A(d,"BUTTON",{class:!0,style:!0});var g=M(e);s.l(g),g.forEach(T),this.h()},h(){w(e,"class","challenge svelte-vlvfda"),he(e,"order",r[0].order),e.disabled=i=!r[5]||!r[1],ge(e,"active",r[1]),ge(e,"gray",r[4]),ge(e,"editable",r[5])},m(d,g){K(d,e,g),u[t].m(e,null),a=!0,o||(l=ye(e,"click",r[11]),o=!0)},p(d,[g]){let m=t;t=h(d),t===m?u[t].p(d,g):(Be(),le(u[m],1,1,()=>{u[m]=null}),qe(),s=u[t],s?s.p(d,g):(s=u[t]=c[t](d),s.c()),ee(s,1),s.m(e,null)),(!a||g&1)&&he(e,"order",d[0].order),(!a||g&34&&i!==(i=!d[5]||!d[1]))&&(e.disabled=i),(!a||g&2)&&ge(e,"active",d[1]),(!a||g&16)&&ge(e,"gray",d[4]),(!a||g&32)&&ge(e,"editable",d[5])},i(d){a||(ee(s),d&&(n||Et(()=>{n=gs(e,Rt,{}),n.start()})),a=!0)},o(d){le(s),a=!1},d(d){d&&T(e),u[t].d(),o=!1,l()}}}const ua=1,ha=2;function da(r,e,t){let s,i,n,a,o,l,c,u,h,d;Q(r,Me,k=>t(5,a=k)),Q(r,at,k=>t(12,o=k)),Q(r,ot,k=>t(13,l=k)),Q(r,yt,k=>t(14,c=k)),Q(r,Ir,k=>t(8,u=k)),Q(r,vt,k=>t(9,h=k)),Q(r,Ge,k=>t(6,d=k));let{challenge:g}=e,{isActive:m=!1}=e;function p(){if(!a)return;const k={tournament:l.id,text:`Completed the challenge ${g.name}`,type:"completion",sender:c.name};s.some(f=>f.team===c.id)?(L(c),j(k)):(v(c),I(k))}async function v(k){if(!a)return;const{error:f}=await de.from("completions").insert({tournament:l.id,challenge:g.id,team:k.id});if(f)return console.error("Error adding challenge",f),{status:500,error:"Could not add challenge"}}async function L(k){if(!a)return;const{error:f}=await de.from("completions").delete().eq("team",k.id).eq("challenge",g.id);if(f)return console.error("Error remove completion",f),{status:500,error:"Could not remove completion"}}async function I(k){if(!a||o.includes(k))return;const{error:f}=await de.from("messages").insert(k);if(f)return console.error("Error adding message",f),{status:500,error:"Could not add message"}}async function j(k){if(!a)return;const{error:f}=await de.from("messages").delete().eq("text",k.text);if(f)return console.error("Error removing message",f),{status:500,error:"Could not remove message"}}const S=(k,f)=>f.id===k.team,U=()=>p();return r.$$set=k=>{"challenge"in k&&t(0,g=k.challenge),"isActive"in k&&t(1,m=k.isActive)},r.$$.update=()=>{r.$$.dirty&513&&t(2,s=h.filter(k=>k.challenge===g.id)),r.$$.dirty&260&&t(4,i=s.length>=u.maxTeams),r.$$.dirty&5&&t(3,n=g.points-(g.type==="main"?Math.min(s.length,ha):0)*ua)},[g,m,s,n,i,a,d,p,u,h,S,U]}class $r extends Ke{constructor(e){super(),We(this,e,da,ca,Je,{challenge:0,isActive:1})}}function fa(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xr={exports:{}};(function(r){(function(e){var t=j(),s=S(),i=U(),n=k(),a={imagePlaceholder:void 0,cacheBust:!1},o={toSvg:l,toPng:u,toJpeg:h,toBlob:d,toPixelData:c,impl:{fontFaces:i,images:n,util:t,inliner:s,options:{}}};r.exports=o;function l(f,y){return y=y||{},g(y),Promise.resolve(f).then(function(R){return p(R,y.filter,!0)}).then(v).then(L).then(_).then(function(R){return I(R,y.width||t.width(f),y.height||t.height(f))});function _(R){return y.bgcolor&&(R.style.backgroundColor=y.bgcolor),y.width&&(R.style.width=y.width+"px"),y.height&&(R.style.height=y.height+"px"),y.style&&Object.keys(y.style).forEach(function(q){R.style[q]=y.style[q]}),R}}function c(f,y){return m(f,y||{}).then(function(_){return _.getContext("2d").getImageData(0,0,t.width(f),t.height(f)).data})}function u(f,y){return m(f,y||{}).then(function(_){return _.toDataURL()})}function h(f,y){return y=y||{},m(f,y).then(function(_){return _.toDataURL("image/jpeg",y.quality||1)})}function d(f,y){return m(f,y||{}).then(t.canvasToBlob)}function g(f){typeof f.imagePlaceholder>"u"?o.impl.options.imagePlaceholder=a.imagePlaceholder:o.impl.options.imagePlaceholder=f.imagePlaceholder,typeof f.cacheBust>"u"?o.impl.options.cacheBust=a.cacheBust:o.impl.options.cacheBust=f.cacheBust}function m(f,y){return l(f,y).then(t.makeImage).then(t.delay(100)).then(function(R){var q=_(f);return q.getContext("2d").drawImage(R,0,0),q});function _(R){var q=document.createElement("canvas");if(q.width=y.width||t.width(R),q.height=y.height||t.height(R),y.bgcolor){var N=q.getContext("2d");N.fillStyle=y.bgcolor,N.fillRect(0,0,q.width,q.height)}return q}}function p(f,y,_){if(!_&&y&&!y(f))return Promise.resolve();return Promise.resolve(f).then(R).then(function($){return q(f,$,y)}).then(function($){return N(f,$)});function R($){return $ instanceof HTMLCanvasElement?t.makeImage($.toDataURL()):$.cloneNode(!1)}function q($,F,C){var D=$.childNodes;if(D.length===0)return Promise.resolve(F);return te(F,t.asArray(D),C).then(function(){return F});function te(ae,ce,E){var P=Promise.resolve();return ce.forEach(function(H){P=P.then(function(){return p(H,E)}).then(function(pe){pe&&ae.appendChild(pe)})}),P}}function N($,F){if(!(F instanceof Element))return F;return Promise.resolve().then(C).then(D).then(te).then(ae).then(function(){return F});function C(){ce(window.getComputedStyle($),F.style);function ce(E,P){E.cssText?P.cssText=E.cssText:H(E,P);function H(pe,ue){t.asArray(pe).forEach(function(x){ue.setProperty(x,pe.getPropertyValue(x),pe.getPropertyPriority(x))})}}}function D(){[":before",":after"].forEach(function(E){ce(E)});function ce(E){var P=window.getComputedStyle($,E),H=P.getPropertyValue("content");if(H===""||H==="none")return;var pe=t.uid();F.className=F.className+" "+pe;var ue=document.createElement("style");ue.appendChild(x(pe,E,P)),F.appendChild(ue);function x(z,Y,V){var ne="."+z+":"+Y,ve=V.cssText?ut(V):Fe(V);return document.createTextNode(ne+"{"+ve+"}");function ut(Te){var _e=Te.getPropertyValue("content");return Te.cssText+" content: "+_e+";"}function Fe(Te){return t.asArray(Te).map(_e).join("; ")+";";function _e(De){return De+": "+Te.getPropertyValue(De)+(Te.getPropertyPriority(De)?" !important":"")}}}}}function te(){$ instanceof HTMLTextAreaElement&&(F.innerHTML=$.value),$ instanceof HTMLInputElement&&F.setAttribute("value",$.value)}function ae(){F instanceof SVGElement&&(F.setAttribute("xmlns","http://www.w3.org/2000/svg"),F instanceof SVGRectElement&&["width","height"].forEach(function(ce){var E=F.getAttribute(ce);E&&F.style.setProperty(ce,E)}))}}}function v(f){return i.resolveAll().then(function(y){var _=document.createElement("style");return f.appendChild(_),_.appendChild(document.createTextNode(y)),f})}function L(f){return n.inlineAll(f).then(function(){return f})}function I(f,y,_){return Promise.resolve(f).then(function(R){return R.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(R)}).then(t.escapeXhtml).then(function(R){return'<foreignObject x="0" y="0" width="100%" height="100%">'+R+"</foreignObject>"}).then(function(R){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+y+'" height="'+_+'">'+R+"</svg>"}).then(function(R){return"data:image/svg+xml;charset=utf-8,"+R})}function j(){return{escape:ae,parseExtension:y,mimeType:_,dataAsUrl:te,isDataUrl:R,canvasToBlob:N,resolveUrl:$,getAndEncode:D,uid:F(),delay:ce,asArray:E,escapeXhtml:P,makeImage:C,width:H,height:pe};function f(){var x="application/font-woff",z="image/jpeg";return{woff:x,woff2:x,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:z,jpeg:z,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function y(x){var z=/\.([^\.\/]*?)$/g.exec(x);return z?z[1]:""}function _(x){var z=y(x).toLowerCase();return f()[z]||""}function R(x){return x.search(/^(data:)/)!==-1}function q(x){return new Promise(function(z){for(var Y=window.atob(x.toDataURL().split(",")[1]),V=Y.length,ne=new Uint8Array(V),ve=0;ve<V;ve++)ne[ve]=Y.charCodeAt(ve);z(new Blob([ne],{type:"image/png"}))})}function N(x){return x.toBlob?new Promise(function(z){x.toBlob(z)}):q(x)}function $(x,z){var Y=document.implementation.createHTMLDocument(),V=Y.createElement("base");Y.head.appendChild(V);var ne=Y.createElement("a");return Y.body.appendChild(ne),V.href=z,ne.href=x,ne.href}function F(){var x=0;return function(){return"u"+z()+x++;function z(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function C(x){return new Promise(function(z,Y){var V=new Image;V.onload=function(){z(V)},V.onerror=Y,V.src=x})}function D(x){var z=3e4;return o.impl.options.cacheBust&&(x+=(/\?/.test(x)?"&":"?")+new Date().getTime()),new Promise(function(Y){var V=new XMLHttpRequest;V.onreadystatechange=ut,V.ontimeout=Fe,V.responseType="blob",V.timeout=z,V.open("GET",x,!0),V.send();var ne;if(o.impl.options.imagePlaceholder){var ve=o.impl.options.imagePlaceholder.split(/,/);ve&&ve[1]&&(ne=ve[1])}function ut(){if(V.readyState===4){if(V.status!==200){ne?Y(ne):Te("cannot fetch resource: "+x+", status: "+V.status);return}var _e=new FileReader;_e.onloadend=function(){var De=_e.result.split(/,/)[1];Y(De)},_e.readAsDataURL(V.response)}}function Fe(){ne?Y(ne):Te("timeout of "+z+"ms occured while fetching resource: "+x)}function Te(_e){console.error(_e),Y("")}})}function te(x,z){return"data:"+z+";base64,"+x}function ae(x){return x.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function ce(x){return function(z){return new Promise(function(Y){setTimeout(function(){Y(z)},x)})}}function E(x){for(var z=[],Y=x.length,V=0;V<Y;V++)z.push(x[V]);return z}function P(x){return x.replace(/#/g,"%23").replace(/\n/g,"%0A")}function H(x){var z=ue(x,"border-left-width"),Y=ue(x,"border-right-width");return x.scrollWidth+z+Y}function pe(x){var z=ue(x,"border-top-width"),Y=ue(x,"border-bottom-width");return x.scrollHeight+z+Y}function ue(x,z){var Y=window.getComputedStyle(x).getPropertyValue(z);return parseFloat(Y.replace("px",""))}}function S(){var f=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:q,shouldProcess:y,impl:{readUrls:_,inline:R}};function y(N){return N.search(f)!==-1}function _(N){for(var $=[],F;(F=f.exec(N))!==null;)$.push(F[1]);return $.filter(function(C){return!t.isDataUrl(C)})}function R(N,$,F,C){return Promise.resolve($).then(function(te){return F?t.resolveUrl(te,F):te}).then(C||t.getAndEncode).then(function(te){return t.dataAsUrl(te,t.mimeType($))}).then(function(te){return N.replace(D($),"$1"+te+"$3")});function D(te){return new RegExp(`(url\\(['"]?)(`+t.escape(te)+`)(['"]?\\))`,"g")}}function q(N,$,F){if(C())return Promise.resolve(N);return Promise.resolve(N).then(_).then(function(D){var te=Promise.resolve(N);return D.forEach(function(ae){te=te.then(function(ce){return R(ce,ae,$,F)})}),te});function C(){return!y(N)}}}function U(){return{resolveAll:f,impl:{readAll:y}};function f(){return y().then(function(_){return Promise.all(_.map(function(R){return R.resolve()}))}).then(function(_){return _.join(`
`)})}function y(){return Promise.resolve(t.asArray(document.styleSheets)).then(R).then(_).then(function(N){return N.map(q)});function _(N){return N.filter(function($){return $.type===CSSRule.FONT_FACE_RULE}).filter(function($){return s.shouldProcess($.style.getPropertyValue("src"))})}function R(N){var $=[];return N.forEach(function(F){try{t.asArray(F.cssRules||[]).forEach($.push.bind($))}catch(C){console.log("Error while reading CSS rules from "+F.href,C.toString())}}),$}function q(N){return{resolve:function(){var F=(N.parentStyleSheet||{}).href;return s.inlineAll(N.cssText,F)},src:function(){return N.style.getPropertyValue("src")}}}}}function k(){return{inlineAll:y,impl:{newImage:f}};function f(_){return{inline:R};function R(q){return t.isDataUrl(_.src)?Promise.resolve():Promise.resolve(_.src).then(q||t.getAndEncode).then(function(N){return t.dataAsUrl(N,t.mimeType(_.src))}).then(function(N){return new Promise(function($,F){_.onload=$,_.onerror=F,_.src=N})})}}function y(_){if(!(_ instanceof Element))return Promise.resolve(_);return R(_).then(function(){return _ instanceof HTMLImageElement?f(_).inline():Promise.all(t.asArray(_.childNodes).map(function(q){return y(q)}))});function R(q){var N=q.style.getPropertyValue("background");return N?s.inlineAll(N).then(function($){q.style.setProperty("background",$,q.style.getPropertyPriority("background"))}).then(function(){return q}):Promise.resolve(q)}}}})()})(xr);var ga=xr.exports;const ma=fa(ga);function or(r,e,t){const s=r.slice();return s[29]=e[t],s}function lr(r,e,t){const s=r.slice();s[29]=e[t];const i=s[2].isRevealed&&(s[9].includes(s[29].order)||s[10].includes(s[29].order)&&s[0]>=hs||s[11].includes(s[29].order)&&s[0]>=ds);return s[32]=i,s}function cr(r,e,t){const s=r.slice();return s[35]=e[t],s}function pa(r){let e,t="Loading...";return{c(){e=O("div"),e.textContent=t,this.h()},l(s){e=A(s,"DIV",{class:!0,"data-svelte-h":!0}),fe(e)!=="svelte-1f5y80z"&&(e.textContent=t),this.h()},h(){w(e,"class","loading svelte-1ycmdqs")},m(s,i){K(s,e,i)},p:$e,i:$e,o:$e,d(s){s&&T(e)}}}function va(r){let e,t,s=r[2].name+"",i,n,a,o,l="TEAMS",c,u,h=[],d=new Map,g,m,p,v=[],L=new Map,I,j,S,U="BONUS",k,f,y=[],_=new Map,R,q,N,$=r[1]&&ur(r),F=Ie(r[5]);const C=E=>E[35].id;for(let E=0;E<F.length;E+=1){let P=cr(r,F,E),H=C(P);d.set(H,h[E]=hr(H,P))}let D=Ie(r[4].filter(gr));const te=E=>E[29].order;for(let E=0;E<D.length;E+=1){let P=lr(r,D,E),H=te(P);L.set(H,v[E]=dr(H,P))}let ae=Ie(r[4].filter(mr));const ce=E=>E[29].order;for(let E=0;E<ae.length;E+=1){let P=or(r,ae,E),H=ce(P);_.set(H,y[E]=fr(H,P))}return q=new na({}),q.$on("snap",r[12]),q.$on("logout",r[13]),{c(){e=O("div"),t=O("h1"),i=Ee(s),n=G(),$&&$.c(),a=G(),o=O("div"),o.textContent=l,c=G(),u=O("div");for(let E=0;E<h.length;E+=1)h[E].c();g=G(),m=O("div"),p=O("div");for(let E=0;E<v.length;E+=1)v[E].c();I=G(),j=O("div"),S=O("div"),S.textContent=U,k=G(),f=O("div");for(let E=0;E<y.length;E+=1)y[E].c();R=G(),Xe(q.$$.fragment),this.h()},l(E){e=A(E,"DIV",{class:!0});var P=M(e);t=A(P,"H1",{class:!0});var H=M(t);i=Se(H,s),H.forEach(T),n=J(P),$&&$.l(P),P.forEach(T),a=J(E),o=A(E,"DIV",{class:!0,"data-svelte-h":!0}),fe(o)!=="svelte-1fdok1o"&&(o.textContent=l),c=J(E),u=A(E,"DIV",{class:!0});var pe=M(u);for(let V=0;V<h.length;V+=1)h[V].l(pe);pe.forEach(T),g=J(E),m=A(E,"DIV",{class:!0});var ue=M(m);p=A(ue,"DIV",{class:!0});var x=M(p);for(let V=0;V<v.length;V+=1)v[V].l(x);x.forEach(T),ue.forEach(T),I=J(E),j=A(E,"DIV",{class:!0});var z=M(j);S=A(z,"DIV",{class:!0,"data-svelte-h":!0}),fe(S)!=="svelte-1j4xxyu"&&(S.textContent=U),k=J(z),f=A(z,"DIV",{class:!0});var Y=M(f);for(let V=0;V<y.length;V+=1)y[V].l(Y);Y.forEach(T),z.forEach(T),R=J(E),Ye(q.$$.fragment,E),this.h()},h(){w(t,"class","title svelte-1ycmdqs"),w(e,"class","titles svelte-1ycmdqs"),w(o,"class","team-name svelte-1ycmdqs"),w(u,"class","teams svelte-1ycmdqs"),w(p,"class","challenges svelte-1ycmdqs"),w(m,"class","challenges-container svelte-1ycmdqs"),w(S,"class","label svelte-1ycmdqs"),w(f,"class","bonus-challenges svelte-1ycmdqs"),w(j,"class","bonus-challenges-container svelte-1ycmdqs")},m(E,P){K(E,e,P),b(e,t),b(t,i),b(e,n),$&&$.m(e,null),K(E,a,P),K(E,o,P),K(E,c,P),K(E,u,P);for(let H=0;H<h.length;H+=1)h[H]&&h[H].m(u,null);K(E,g,P),K(E,m,P),b(m,p);for(let H=0;H<v.length;H+=1)v[H]&&v[H].m(p,null);K(E,I,P),K(E,j,P),b(j,S),b(j,k),b(j,f);for(let H=0;H<y.length;H+=1)y[H]&&y[H].m(f,null);K(E,R,P),Qe(q,E,P),N=!0},p(E,P){(!N||P[0]&4)&&s!==(s=E[2].name+"")&&Pe(i,s),E[1]?$?$.p(E,P):($=ur(E),$.c(),$.m(e,null)):$&&($.d(1),$=null),P[0]&160&&(F=Ie(E[5]),Be(),h=Xt(h,P,C,1,E,F,d,u,Wt,hr,null,cr),qe()),P[0]&3605&&(D=Ie(E[4].filter(gr)),Be(),v=Xt(v,P,te,1,E,D,L,p,Wt,dr,null,lr),qe()),P[0]&20&&(ae=Ie(E[4].filter(mr)),Be(),y=Xt(y,P,ce,1,E,ae,_,f,Wt,fr,null,or),qe())},i(E){if(!N){for(let P=0;P<F.length;P+=1)ee(h[P]);for(let P=0;P<D.length;P+=1)ee(v[P]);for(let P=0;P<ae.length;P+=1)ee(y[P]);ee(q.$$.fragment,E),N=!0}},o(E){for(let P=0;P<h.length;P+=1)le(h[P]);for(let P=0;P<v.length;P+=1)le(v[P]);for(let P=0;P<y.length;P+=1)le(y[P]);le(q.$$.fragment,E),N=!1},d(E){E&&(T(e),T(a),T(o),T(c),T(u),T(g),T(m),T(I),T(j),T(R)),$&&$.d();for(let P=0;P<h.length;P+=1)h[P].d();for(let P=0;P<v.length;P+=1)v[P].d();for(let P=0;P<y.length;P+=1)y[P].d();Ze(q,E)}}}function ur(r){let e,t=r[2].name+"",s;return{c(){e=O("h1"),s=Ee(t),this.h()},l(i){e=A(i,"H1",{class:!0});var n=M(e);s=Se(n,t),n.forEach(T),this.h()},h(){w(e,"class","editing svelte-1ycmdqs")},m(i,n){K(i,e,n),b(e,s)},p(i,n){n[0]&4&&t!==(t=i[2].name+"")&&Pe(s,t)},d(i){i&&T(e)}}}function hr(r,e){let t,s,i;return s=new Ni({props:{team:e[35],maxHealth:e[7]}}),{key:r,first:null,c(){t=bt(),Xe(s.$$.fragment),this.h()},l(n){t=bt(),Ye(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,a){K(n,t,a),Qe(s,n,a),i=!0},p(n,a){e=n;const o={};a[0]&32&&(o.team=e[35]),a[0]&128&&(o.maxHealth=e[7]),s.$set(o)},i(n){i||(ee(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Ze(s,n)}}}function dr(r,e){let t,s,i;return s=new $r({props:{challenge:e[29],isActive:e[32]}}),{key:r,first:null,c(){t=bt(),Xe(s.$$.fragment),this.h()},l(n){t=bt(),Ye(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,a){K(n,t,a),Qe(s,n,a),i=!0},p(n,a){e=n;const o={};a[0]&16&&(o.challenge=e[29]),a[0]&21&&(o.isActive=e[32]),s.$set(o)},i(n){i||(ee(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Ze(s,n)}}}function fr(r,e){let t,s,i;return s=new $r({props:{challenge:e[29],isActive:e[2].isRevealed}}),{key:r,first:null,c(){t=bt(),Xe(s.$$.fragment),this.h()},l(n){t=bt(),Ye(s.$$.fragment,n),this.h()},h(){this.first=t},m(n,a){K(n,t,a),Qe(s,n,a),i=!0},p(n,a){e=n;const o={};a[0]&16&&(o.challenge=e[29]),a[0]&4&&(o.isActive=e[2].isRevealed),s.$set(o)},i(n){i||(ee(s.$$.fragment,n),i=!0)},o(n){le(s.$$.fragment,n),i=!1},d(n){n&&T(t),Ze(s,n)}}}function _a(r){let e,t,s,i;const n=[va,pa],a=[];function o(l,c){return l[2]&&l[5]&&l[4]&&l[8]&&l[3]?0:1}return t=o(r),s=a[t]=n[t](r),{c(){e=O("div"),s.c(),this.h()},l(l){e=A(l,"DIV",{class:!0,style:!0});var c=M(e);s.l(c),c.forEach(T),this.h()},h(){w(e,"class","frame svelte-1ycmdqs"),he(e,"background-image","linear-gradient(to top right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%), url('images/Wide Background.jpg')"),he(e,"cursor","url('images/interface/Scimitar.png'), auto")},m(l,c){K(l,e,c),a[t].m(e,null),r[14](e),i=!0},p(l,c){let u=t;t=o(l),t===u?a[t].p(l,c):(Be(),le(a[u],1,1,()=>{a[u]=null}),qe(),s=a[t],s?s.p(l,c):(s=a[t]=n[t](l),s.c()),ee(s,1),s.m(e,null))},i(l){i||(ee(s),i=!0)},o(l){le(s),i=!1},d(l){l&&T(e),a[t].d(),r[14](null)}}}const hs=8,ds=16;function ya(){const r=document.createElement("style");r.textContent=`
			::-webkit-scrollbar {
				/* height: 12px; */
				width: 16px;
				background: #000;
			}

			::-webkit-scrollbar-thumb {
				background: url('images/interface/Scroll Bar.png');
				border-radius: 4px;
				border: solid black 1px;
				background-size: contain;
				image-rendering: pixelated;
				background-repeat: repeat;
			}

			::-webkit-scrollbar-track {
				background: url('images/interface/Scroll Bar Track.png');
				background-size: contain;
				image-rendering: pixelated;
				background-repeat: repeat;
			}

			::-webkit-scrollbar-button:single-button:vertical:decrement {
				background: url('images/interface/Scroll Bar Up.png');
				width: 16px;
				height: 16px;
				background-size: cover;
				image-rendering: pixelated;
				background-repeat: no-repeat;
			}
			::-webkit-scrollbar-button:single-button:vertical:increment {
				width: 16px;
				height: 16px;
				background: url('images/interface/Scroll Bar Down.png');
				background-size: cover;
				image-rendering: pixelated;
				background-repeat: no-repeat;
			}
		`,document.head.appendChild(r)}const gr=r=>r.type==="main",mr=r=>r.type==="bonus";function ba(r,e,t){let s,i,n,a,o,l,c,u,h;Q(r,Me,C=>t(1,n=C)),Q(r,at,C=>t(8,a=C)),Q(r,ot,C=>t(2,o=C)),Q(r,vt,C=>t(3,l=C)),Q(r,Pt,C=>t(4,c=C)),Q(r,Ge,C=>t(5,u=C)),Q(r,yt,C=>t(15,h=C));const d=[1,2,3,4,5,6,10,11,15,16,20,21,22,23,24,25],g=[7,8,9,12,14,17,18,19],m=[13];let p;Mr(async()=>{v(),L(),I(),j(),S(),await U().then(()=>k()).then(()=>f()).then(()=>y()).then(()=>_()).then(()=>{ya(),JSON.parse(localStorage.getItem("tournKey"))===o.secret?Z(Me,n=!0,n):Z(Me,n=!1,n),a.length<1&&R({tournament:o.id,text:"Welcome to the tournament!",type:"notification",sender:"System"})}).catch(C=>{console.error("An error occurred:",C)})});function v(){de.channel("tournament_channel").on("postgres_changes",{event:"*",schema:"public",table:"tournaments"},C=>{switch(console.log("payload",C),C.eventType){case"UPDATE":Z(ot,o=C.new,o);break}}).subscribe()}function L(){de.channel("teams_channel").on("postgres_changes",{event:"*",schema:"public",table:"teams"},C=>{switch(C.eventType){case"INSERT":console.log("new",C.new),Z(Ge,u=[...u,C.new],u);break;case"DELETE":console.log("old",C.old),Z(Ge,u=u.filter(D=>D.id!==C.old.id),u);break;case"UPDATE":console.log("old",C.old),Z(Ge,u=C.new,u);break}}).subscribe()}function I(){de.channel("challenges_channel").on("postgres_changes",{event:"*",schema:"public",table:"challenges"},C=>{switch(C.eventType){case"INSERT":console.log("new",C.new),Z(Pt,c=[...c,C.new],c);break;case"DELETE":console.log("old",C.old),Z(Pt,c=c.filter(D=>D.id!==C.old.id),c);break}}).subscribe()}function j(){de.channel("completions_channel").on("postgres_changes",{event:"*",schema:"public",table:"completions"},C=>{switch(C.eventType){case"INSERT":Z(vt,l=[...l,C.new],l);break;case"DELETE":Z(vt,l=l.filter(D=>D.id!==C.old.id),l);break}}).subscribe()}function S(){de.channel("messages_channel").on("postgres_changes",{event:"*",schema:"public",table:"messages"},C=>{switch(C.eventType){case"INSERT":Z(at,a=[...a,C.new],a);break;case"DELETE":Z(at,a=a.filter(D=>D.id!==C.old.id),a);break}}).subscribe()}async function U(){const{data:C,error:D}=await de.from("tournaments").select("*").eq("id","f1c04b40-4faa-43f9-b058-bfc1db35d388");if(D)return console.error("Error fetching tournament",D),{status:500,error:"Could not fetch tournament"};Z(ot,o=C[0],o)}async function k(){const{data:C,error:D}=await de.from("teams").select("*").eq("tournament",o.id);if(D)return console.error("Error fetching teams",D),{status:500,error:"Could not fetch teams"};Z(Ge,u=C??[],u)}async function f(){const{data:C,error:D}=await de.from("challenges").select("*").eq("tournament",o.id);if(D)return console.error("Error fetching challenges",D),{status:500,error:"Could not fetch challenges"};Z(Pt,c=C??[],c)}async function y(){const{data:C,error:D}=await de.from("completions").select("*").eq("tournament",o.id);if(D)return console.error("Error fetching completions",D),{status:500,error:"Could not fetch completions"};Z(vt,l=C??[],l)}async function _(){const{data:C,error:D}=await de.from("messages").select("*").eq("tournament",o.id);if(D)return console.error("Error fetching messages",D),{status:500,error:"Could not fetch messages"};Z(at,a=C??[],a)}async function R(C){if(!n||a.find(te=>C.text===te.text))return;const{error:D}=await de.from("messages").insert(C);if(D)return console.error("Error adding message",D),{status:500,error:"Could not add message"}}async function q(C){if(!n)return;const{error:D}=await de.from("messages").delete().eq("text",C.text);if(D)return console.error("Error removing message",D),{status:500,error:"Could not remove message"}}async function N(){ma.toPng(p).then(function(C){let D=document.createElement("a");D.download="my-image-name.png",D.href=C,document.body.appendChild(D),D.click(),document.body.removeChild(D)}).catch(function(C){console.error("oops, something went wrong!",C)})}function $(){Z(Me,n=!1,n),localStorage.removeItem("tournKey")}function F(C){pr[C?"unshift":"push"](()=>{p=C,t(6,p)})}return r.$$.update=()=>{if(r.$$.dirty[0]&16&&t(7,s=c.reduce((C,D)=>C+D.points,0)),r.$$.dirty[0]&24&&t(0,i=c.filter(C=>l.find(D=>D.challenge===C.id)&&C.type==="main").length),r.$$.dirty[0]&5&&o)switch(!0){case i<hs:q({tournament:o.id,text:"Outer Ring Unlocked",type:"notification",sender:"System"}),q({tournament:o.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"});break;case(i>=hs&&i<ds):R({tournament:o.id,text:"Outer Ring Unlocked",type:"notification",sender:"System"}),q({tournament:o.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"});break;case i>=ds:R({tournament:o.id,text:"Inner Ring Unlocked",type:"notification",sender:"System"})}r.$$.dirty[0]&34&&(n?Z(yt,h=u[0],h):Z(yt,h=null,h))},[i,n,o,l,c,u,p,s,a,d,g,m,N,$,F]}class Ca extends Ke{constructor(e){super(),We(this,e,ba,_a,Je,{},null,[-1,-1])}}export{Ca as P,Ta as _,fa as g};
